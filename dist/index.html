<!-- 
============================================================================
JobTracker - Single File Build
Generated: 2025-06-23T16:58:16.123Z
Cache Version: 1750697896123
============================================================================
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>JobTracker - Free Local Job Tracker | No Login, No Tracking, Your Data Stays Private</title>
    <meta name="description" content="100% free job application tracker that works locally in your browser. No login required, no data tracking, no servers. Your job search data stays completely private on your device.">
    <meta name="keywords" content="free job tracker, local job application tracker, private job search, no login job tracker, offline job tracker, privacy-first job applications, no tracking career management, local storage job search">
    <meta name="author" content="JobTracker Team">
    <meta name="robots" content="index, follow">
    <meta name="language" content="en">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="JobTracker - Free Local Job Tracker (No Login Required)">
    <meta property="og:description" content="Track job applications privately in your browser. 100% free, no login, no tracking, your data never leaves your device.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://letanure.github.io/job-tracker-plain/">
    <meta property="og:site_name" content="JobTracker">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="JobTracker - Private Job Application Tracker">
    <meta name="twitter:description" content="Free local job tracker with complete privacy. No login, no tracking, your job search data stays on your device.">
    
    <!-- Canonical URL and Alternate Language Links -->
    <link rel="canonical" href="https://letanure.github.io/job-tracker-plain/">
        <link rel="alternate" hreflang="en" href="https://letanure.github.io/job-tracker-plain/">
    <link rel="alternate" hreflang="pt" href="https://letanure.github.io/job-tracker-plain/?lang=pt">
    <link rel="alternate" hreflang="x-default" href="https://letanure.github.io/job-tracker-plain/">
    
    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#2383e2">
    <meta name="application-name" content="JobTracker">
    <meta name="apple-mobile-web-app-title" content="JobTracker">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- External Resources -->
    <script defer src="https://cloud.umami.is/script.js" data-website-id="33179b8a-4bc4-4489-9a2d-82d5699c3dfb"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    
    <meta name="build-version" content="1750697896123">
    <meta name="build-date" content="2025-06-23T16:58:16.123Z">
    <style>

/* ============================================================================ */
/* SRC/STYLES/BASE.CSS */
/* ============================================================================ */

/* ============================================================================ */
/* BASE STYLES - VARIABLES, COLORS, TYPOGRAPHY, AND RESETS */
/* ============================================================================ */

:root {
	/* ============================================================================ */
	/* BASE COLOR PALETTE */
	/* ============================================================================ */
	/* 
	 * This section defines the core color palette using a systematic approach:
	 * - Each color family has 9 shades (50-900) for maximum flexibility
	 * - 50-100: Very light backgrounds, subtle borders
	 * - 200-300: Light backgrounds, borders  
	 * - 400-500: Medium colors, primary actions (500 is the main color)
	 * - 600-700: Darker variants, hover states
	 * - 800-900: Very dark, text on light backgrounds
	 */

	/* GitHub Base Colors */
	--white: #ffffff;
	--black: #1c2128;
	--modal-backdrop: rgba(1, 4, 9, 0.8);

	/* GitHub Blue */
	--blue-50: #dbeafe;
	--blue-100: #c7d2fe;
	--blue-200: #9bb0ff;
	--blue-300: #6d8bff;
	--blue-400: #4169e1;
	--blue-500: #0969da; /* GitHub primary blue */
	--blue-600: #0550ae;
	--blue-700: #033d8b;
	--blue-800: #0a3069;
	--blue-900: #002155;

	/* GitHub Grays */
	--gray-50: #f6f8fa;
	--gray-100: #eaeef2;
	--gray-200: #d0d7de;
	--gray-300: #afb8c1;
	--gray-400: #8c959f;
	--gray-500: #656d76;
	--gray-600: #424a53;
	--gray-700: #32383f;
	--gray-800: #24292f;
	--gray-900: #1c2128;

	/* GitHub Green */
	--green-50: #dcffe4;
	--green-100: #aff5b4;
	--green-200: #7ee787;
	--green-300: #56d364;
	--green-400: #3fb950;
	--green-500: #238636; /* GitHub green */
	--green-600: #196c2e;
	--green-700: #0f5323;
	--green-800: #033a16;
	--green-900: #04260f;

	/* GitHub Orange/Yellow */
	--orange-50: #fff8c5;
	--orange-100: #fae17d;
	--orange-200: #eac54f;
	--orange-300: #d4a72c;
	--orange-400: #bf8700;
	--orange-500: #9a6700; /* GitHub orange */
	--orange-600: #7d4e00;
	--orange-700: #633c01;
	--orange-800: #4d2d00;
	--orange-900: #3b2300;

	/* GitHub Red */
	--red-50: #ffebe9;
	--red-100: #ffcdc5;
	--red-200: #ffaba8;
	--red-300: #ff8182;
	--red-400: #fa4549;
	--red-500: #cf222e; /* GitHub red */
	--red-600: #a40e26;
	--red-700: #82071e;
	--red-800: #660018;
	--red-900: #4c0519;

	/* GitHub Purple */
	--purple-50: #fbefff;
	--purple-100: #ecd8ff;
	--purple-200: #d2a8ff;
	--purple-300: #bc7eff;
	--purple-400: #a475f9;
	--purple-500: #8250df; /* GitHub purple */
	--purple-600: #6639ba;
	--purple-700: #512a97;
	--purple-800: #3e1f79;
	--purple-900: #2e1065;

	/* GitHub Pink for special status */
	--pink-50: #ffeff7;
	--pink-100: #ffd3ec;
	--pink-200: #ffadda;
	--pink-300: #ff80cc;
	--pink-400: #e85aad;
	--pink-500: #bf4b8a; /* GitHub pink */
	--pink-600: #9e3670;
	--pink-700: #7e2757;
	--pink-800: #661b47;
	--pink-900: #4d1336;

	/* ============================================================================ */
	/* SEMANTIC COLOR SYSTEM */
	/* ============================================================================ */
	/*
	 * This section maps the base colors to semantic meanings.
	 * Use these semantic colors throughout the application instead of 
	 * referencing base colors directly. This allows for easy theming
	 * and consistent color usage across components.
	 */

	/* GitHub Semantic Colors */
	--primary-color: var(--blue-500);
	--primary-hover: var(--blue-600);
	--primary-light: var(--blue-400);
	--primary-bg: var(--blue-50);

	--success-color: var(--green-500);
	--success-hover: var(--green-600);
	--success-light: var(--green-400);
	--success-bg: var(--green-50);

	--warning-color: var(--orange-500);
	--warning-hover: var(--orange-600);
	--warning-light: var(--orange-400);
	--warning-bg: var(--orange-50);

	--error-color: var(--red-500);
	--error-hover: var(--red-600);
	--error-light: var(--red-400);
	--error-bg: var(--red-50);

	--danger-color: var(--red-500);
	--danger-dark: var(--red-600);
	--success-dark: var(--green-600);

	--info-color: var(--primary-color);
	--info-hover: var(--primary-hover);
	--info-light: var(--primary-light);
	--info-bg: var(--primary-bg);

	/* ============================================================================ */
	/* SURFACE & TEXT COLORS */
	/* ============================================================================ */

	/* GitHub Surface Colors */
	--background-color: var(--gray-50);
	--container-background: var(--white);
	--surface-elevated: var(--white);
	--surface-hover: var(--gray-100);

	/* GitHub Borders */
	--border-color: var(--gray-200);
	--border-light: var(--gray-100);
	--border-strong: var(--gray-300);

	/* GitHub Text Hierarchy */
	--text-color: var(--gray-900);
	--text-primary: var(--gray-900);
	--text-secondary: var(--gray-700);
	--text-light: var(--gray-600);
	--text-lighter: var(--gray-500);
	--text-on-primary: var(--white);
	--text-on-dark: var(--white);

	/* ============================================================================ */
	/* APPLICATION-SPECIFIC COLOR MAPPINGS */
	/* ============================================================================ */

	/* Job status colors */
	--status-wishlist-bg: var(--gray-100);
	--status-wishlist-text: var(--text-light);

	--status-applied-bg: var(--blue-100);
	--status-applied-text: var(--primary-color);

	--status-screening-bg: var(--orange-100);
	--status-screening-text: var(--warning-color);

	--status-interview-bg: var(--purple-50);
	--status-interview-text: var(--purple-500);

	--status-final-bg: var(--green-100);
	--status-final-text: var(--success-color);

	--status-offer-bg: var(--teal-100);
	--status-offer-text: var(--teal-500);

	--status-rejected-bg: var(--red-100);
	--status-rejected-text: var(--error-color);

	--status-withdrawn-bg: var(--gray-100);
	--status-withdrawn-text: var(--gray-500);

	/* Priority colors */
	--priority-high: var(--error-color);
	--priority-medium: var(--warning-color);
	--priority-low: var(--success-color);

	/* Task/note specific colors */
	--next-task-bg: var(--warning-bg);
	--next-task-text: var(--warning-color);

	/* ============================================================================ */
	/* ENHANCED COLOR UTILITIES */
	/* ============================================================================ */

	/* Gradient system */
	--gradient-primary: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
	--gradient-success: linear-gradient(135deg, var(--success-color), var(--success-hover));
	--gradient-warning: linear-gradient(135deg, var(--warning-color), var(--warning-hover));
	--gradient-error: linear-gradient(135deg, var(--error-color), var(--error-hover));

	/* Hover states for better interaction feedback */
	--surface-hover: var(--gray-50);
	--surface-active: var(--gray-100);

	/* Status indicator variations */
	--status-positive: var(--success-color);
	--status-neutral: var(--gray-400);
	--status-negative: var(--error-color);
	--status-pending: var(--warning-color);
	--status-info: var(--info-color);

	/* ============================================================================ */
	/* DESIGN SYSTEM BASE VALUES - Change these to scale the entire system       */
	/* ============================================================================ */

	/* SINGLE SOURCE OF TRUTH - Change this one value to scale everything */
	--base-size: 4px; /* Master scale unit - everything derives from this */

	/* Core base values - calculated from master base-size */
	--base-font-size: 1rem; /* Typography base - scales all fonts */
	--base-line-height: 1.5; /* Line height base - scales all line heights */
	--base-letter-spacing: 0.025em; /* Letter spacing base - scales all letter spacing */
	--base-space-unit: var(--base-size); /* Spacing base - scales all spacing/padding/margins */
	--base-radius-unit: calc(var(--base-size) / 2); /* Border radius base - scales all radius values */
	--base-shadow-blur: calc(var(--base-size) / 2); /* Shadow base - scales all shadow blur values */
	--base-border-width: calc(var(--base-size) / 4); /* Border base - scales all border widths */
	--base-icon-size: calc(var(--base-size) * 4); /* Icon base - scales all icon sizes */
	--base-button-height: calc(var(--base-size) * 8); /* Button base - scales all button heights */

	/* GitHub Typography System */
	--font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial,
		sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
	--font-family-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;

	/* Font sizes - calc-based from base */
	--font-size-base: var(--base-font-size);
	--font-size-2xs: calc(var(--base-font-size) * 0.625); /* 10px */
	--font-size-xs: calc(var(--base-font-size) * 0.75); /* 12px */
	--font-size-sm: calc(var(--base-font-size) * 0.875); /* 14px */
	--font-size-lg: calc(var(--base-font-size) * 1.125); /* 18px */
	--font-size-xl: calc(var(--base-font-size) * 1.25); /* 20px */
	--font-size-2xl: calc(var(--base-font-size) * 1.5); /* 24px */
	--font-size-3xl: calc(var(--base-font-size) * 1.875); /* 30px */

	/* Line heights - calc-based from base */
	--line-height-none: 1;
	--line-height-tight: calc(var(--base-line-height) * 0.833); /* 1.25 */
	--line-height-snug: calc(var(--base-line-height) * 0.917); /* 1.375 */
	--line-height-normal: var(--base-line-height); /* 1.5 */
	--line-height-relaxed: calc(var(--base-line-height) * 1.083); /* 1.625 */
	--line-height-loose: calc(var(--base-line-height) * 1.333); /* 2.0 */

	/* Letter spacing - calc-based from base */
	--letter-spacing-tighter: calc(var(--base-letter-spacing) * -2); /* -0.05em */
	--letter-spacing-tight: calc(var(--base-letter-spacing) * -1); /* -0.025em */
	--letter-spacing-normal: 0;
	--letter-spacing-wide: var(--base-letter-spacing); /* 0.025em */
	--letter-spacing-wider: calc(var(--base-letter-spacing) * 2); /* 0.05em */
	--letter-spacing-widest: calc(var(--base-letter-spacing) * 4); /* 0.1em */

	/* Font weights */
	--font-weight-thin: 100;
	--font-weight-light: 300;
	--font-weight-normal: 400;
	--font-weight-medium: 500;
	--font-weight-semibold: 600;
	--font-weight-bold: 700;
	--font-weight-extrabold: 800;

	/* Spacing system - calc-based from base unit */
	--space-1: var(--base-space-unit); /* 4px */
	--space-2: calc(var(--base-space-unit) * 2); /* 8px */
	--space-3: calc(var(--base-space-unit) * 3); /* 12px */
	--space-4: calc(var(--base-space-unit) * 4); /* 16px */
	--space-5: calc(var(--base-space-unit) * 5); /* 20px */
	--space-6: calc(var(--base-space-unit) * 6); /* 24px */
	--space-8: calc(var(--base-space-unit) * 8); /* 32px */
	--space-10: calc(var(--base-space-unit) * 10); /* 40px */
	--space-12: calc(var(--base-space-unit) * 12); /* 48px */
	--space-16: calc(var(--base-space-unit) * 16); /* 64px */
	--space-20: calc(var(--base-space-unit) * 20); /* 80px */
	--space-24: calc(var(--base-space-unit) * 24); /* 96px */

	/* Grid column system - calc-based from base unit Ã— 2 */
	--col-1: calc(var(--base-space-unit) * 2); /* 8px */
	--col-2: calc(var(--base-space-unit) * 4); /* 16px */
	--col-3: calc(var(--base-space-unit) * 6); /* 24px */
	--col-4: calc(var(--base-space-unit) * 8); /* 32px */
	--col-5: calc(var(--base-space-unit) * 10); /* 40px */
	--col-6: calc(var(--base-space-unit) * 12); /* 48px */
	--col-8: calc(var(--base-space-unit) * 16); /* 64px */
	--col-10: calc(var(--base-space-unit) * 20); /* 80px */
	--col-12: calc(var(--base-space-unit) * 24); /* 96px */
	--col-16: calc(var(--base-space-unit) * 32); /* 128px */
	--col-20: calc(var(--base-space-unit) * 40); /* 160px */
	--col-24: calc(var(--base-space-unit) * 48); /* 192px */
	--col-28: calc(var(--base-space-unit) * 56); /* 224px */
	--col-32: calc(var(--base-space-unit) * 64); /* 256px */
	--col-36: calc(var(--base-space-unit) * 72); /* 288px */
	--col-40: calc(var(--base-space-unit) * 80); /* 320px */
	--col-48: calc(var(--base-space-unit) * 96); /* 384px */
	--col-56: calc(var(--base-space-unit) * 112); /* 448px */
	--col-64: calc(var(--base-space-unit) * 128); /* 512px */

	/* Padding system - calc-based combinations */
	--padding-xs: var(--space-1) var(--space-2); /* 4px 8px */
	--padding-sm: calc(var(--space-1) + calc(var(--base-size) / 2)) var(--space-3); /* 6px 12px */
	--padding-md: var(--space-2) var(--space-4); /* 8px 16px */
	--padding-lg: var(--space-3) var(--space-5); /* 12px 20px */
	--padding-xl: var(--space-4) var(--space-6); /* 16px 24px */

	/* Border radius system - calc-based from base */
	--radius-xs: var(--base-radius-unit); /* 2px */
	--radius-sm: calc(var(--base-radius-unit) * 2); /* 4px */
	--radius-md: calc(var(--base-radius-unit) * 3); /* 6px */
	--radius-lg: calc(var(--base-radius-unit) * 4); /* 8px */
	--radius-xl: calc(var(--base-radius-unit) * 6); /* 12px */
	--radius-full: calc(var(--base-size) * 2500); /* 9999px equivalent */

	/* Shadow system - calc-based from base blur */
	--shadow-xs: 0 var(--base-shadow-blur) calc(var(--base-shadow-blur) * 2) rgba(0, 0, 0, 0.04);
	--shadow-sm: 0 var(--base-shadow-blur) calc(var(--base-shadow-blur) * 1) 0 rgba(0, 0, 0, 0.05);
	--shadow-md: 0 calc(var(--base-shadow-blur) * 2) calc(var(--base-shadow-blur) * 3)
		calc(var(--base-shadow-blur) * -0.5) rgba(0, 0, 0, 0.1), 0 var(--base-shadow-blur)
		calc(var(--base-shadow-blur) * 2) calc(var(--base-shadow-blur) * -0.5) rgba(0, 0, 0, 0.06);
	--shadow-lg: 0 calc(var(--base-shadow-blur) * 5) calc(var(--base-shadow-blur) * 7.5)
		calc(var(--base-shadow-blur) * -1.5) rgba(0, 0, 0, 0.1), 0 calc(var(--base-shadow-blur) * 2)
		calc(var(--base-shadow-blur) * 3) calc(var(--base-shadow-blur) * -1) rgba(0, 0, 0, 0.05);
	--shadow-xl: 0 calc(var(--base-shadow-blur) * 10) calc(var(--base-shadow-blur) * 12.5)
		calc(var(--base-shadow-blur) * -2.5) rgba(0, 0, 0, 0.1), 0 calc(var(--base-shadow-blur) * 5)
		calc(var(--base-shadow-blur) * 5) calc(var(--base-shadow-blur) * -2.5) rgba(0, 0, 0, 0.04);

	/* Border system - calc-based from base */
	--border-width: var(--base-border-width); /* 1px */
	--border-width-thick: calc(var(--base-border-width) * 2); /* 2px */
	--border-width-thicker: calc(var(--base-border-width) * 3); /* 3px */

	/* Icon system - calc-based from base */
	--icon-xs: calc(var(--base-icon-size) * 0.75); /* 12px */
	--icon-sm: calc(var(--base-icon-size) * 0.875); /* 14px */
	--icon-md: var(--base-icon-size); /* 16px */
	--icon-lg: calc(var(--base-icon-size) * 1.25); /* 20px */
	--icon-xl: calc(var(--base-icon-size) * 1.5); /* 24px */

	/* Button system - calc-based from base */
	--btn-height-sm: calc(var(--base-button-height) * 0.875); /* 28px */
	--btn-height-md: var(--base-button-height); /* 32px */
	--btn-height-lg: calc(var(--base-button-height) * 1.25); /* 40px */
	--btn-min-width: calc(var(--base-button-height) * 2.5); /* 80px */

	/* Layout constraints - calc-based where possible */
	--max-width-container: calc(var(--base-size) * 300); /* 1200px */
	--max-width-notes: var(--col-32); /* 256px */
	--max-height-table: 75vh;

	/* Animation & Transition */
	--transition-fast: 0.15s ease;
	--transition-normal: 0.3s ease;
	--transition-slow: 0.5s ease;

	/* Focus ring - calc-based from base-size */
	--focus-ring-width: calc(var(--base-size) * 0.75); /* 3px */
	--focus-ring: 0 0 0 var(--focus-ring-width)
		color-mix(in srgb, var(--primary-color) 10%, transparent);
	--focus-ring-error: 0 0 0 var(--focus-ring-width)
		color-mix(in srgb, var(--error-color) 10%, transparent);
	--focus-ring-success: 0 0 0 var(--focus-ring-width)
		color-mix(in srgb, var(--success-color) 10%, transparent);

	/* Focus ring fallbacks for older browsers */
	--focus-ring-fallback: 0 0 0 var(--focus-ring-width) rgba(35, 131, 226, 0.1);
	--focus-ring-error-fallback: 0 0 0 var(--focus-ring-width) rgba(224, 62, 62, 0.1);
	--focus-ring-success-fallback: 0 0 0 var(--focus-ring-width) rgba(15, 123, 15, 0.1);

	/* Z-index scale - calc-based */
	--z-dropdown: calc(var(--base-size) * 25); /* 100 */
	--z-modal: calc(var(--base-size) * 250); /* 1000 */
	--z-tooltip: calc(var(--base-size) * 500); /* 2000 */

	/* Component-specific calc-based values */
	--priority-dot-size: calc(var(--base-size) * 2); /* 8px */
	--counter-height: calc(var(--base-size) * 6); /* 24px - consistent height for badges */
	--action-btn-size: calc(var(--base-size) * 8); /* 32px - consistent size for action buttons */
}

/* ============================================================================ */
/* BASE RESETS AND GLOBAL STYLES */
/* ============================================================================ */

/* Base font size for rem calculations */
html {
	font-size: calc(var(--base-size) * 4); /* 16px - 1rem = 16px */
	height: 100%; /* Essential for full-height flexbox layouts */
}

body {
	font-family: var(--font-family);
	margin: 0;
	padding: var(--space-4);
	background-color: var(--background-color);
	font-size: var(--font-size-sm);
	line-height: var(--line-height-normal);
	color: var(--text-color);
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
	height: 100%; /* Essential for full-height flexbox layouts */
}

/* Remove default margins and padding from common elements */
h1,
h2,
h3,
h4,
h5,
h6,
p,
ul,
ol,
li,
figure,
figcaption,
blockquote,
dl,
dd {
	margin: 0;
	padding: 0;
}

/* Remove list styles from lists without class */
ul:not([class]),
ol:not([class]) {
	list-style: none;
}

/* Box sizing reset */
*,
*::before,
*::after {
	box-sizing: border-box;
}


/* ============================================================================ */
/* SRC/STYLES/LAYOUT.CSS */
/* ============================================================================ */

/* ============================================================================ */
/* LAYOUT STYLES - CONTAINERS, HEADERS, AND BASIC STRUCTURE */
/* ============================================================================ */

.container {
	width: 100%;
	max-width: var(--max-width-container);
	margin: 0 auto;
	background: var(--container-background);
	border-radius: 8px;
	box-shadow: none;
	border: var(--border-width) solid var(--border-color);
	overflow: hidden;
}

.header {
	background: var(--gray-50);
	border-bottom: var(--border-width) solid var(--border-color);
	padding: 16px 24px;
	display: flex;
	align-items: center;
	justify-content: space-between;
}

.header h1 {
	margin: 0;
	font-size: 20px;
	font-weight: 600;
	color: var(--text-color);
	letter-spacing: -0.025em;
	line-height: 1.25;
}

.controls {
	padding: 16px 24px;
	background: var(--white);
	border-bottom: var(--border-width) solid var(--border-color);
	display: flex;
	gap: 12px;
	align-items: center;
}

.table-container {
	overflow-x: auto;
	max-height: calc(100vh - 400px);
	overflow-y: auto;
	background: var(--container-background);
}

.table-actions {
	padding: 16px 0 16px 0;
	background: var(--white);
	border-top: var(--border-width) solid var(--border-color);
	display: flex;
	justify-content: flex-start;
}

/* Stats Section */

.stat-number {
	font-weight: 600;
	color: var(--text-color);
	margin-right: calc(var(--space-1) * 0.5);
	display: inline-block;
}

.stat-label {
	font-size: 12px;
	color: var(--text-lighter);
	text-transform: none;
	letter-spacing: normal;
	margin-top: 4px;
	font-weight: 500;
}

/* GitHub-Style Footer */
.footer {
	background: var(--gray-50);
	padding: 16px 24px;
	text-align: center;
	border-top: var(--border-width) solid var(--border-color);
	color: var(--text-secondary);
	font-size: 12px;
	margin-top: 24px;
}

.footer-content {
	display: flex;
	align-items: center;
	justify-content: space-between;
	max-width: var(--max-width-container);
	margin: 0 auto;
	flex-wrap: wrap;
	gap: 16px;
}

.footer-text {
	margin: 0;
	display: flex;
	align-items: center;
	gap: 4px;
}

.heart {
	color: var(--red-500);
	animation: heartbeat 1.5s ease-in-out infinite;
	display: inline-block;
}

@keyframes heartbeat {
	0% {
		transform: scale(1);
	}
	14% {
		transform: scale(1.1);
	}
	28% {
		transform: scale(1);
	}
	42% {
		transform: scale(1.1);
	}
	70% {
		transform: scale(1);
	}
}

.author-link {
	color: var(--primary-color);
	text-decoration: none;
	font-weight: 500;
}

.author-link:hover {
	text-decoration: underline;
}

.github-link {
	display: flex;
	align-items: center;
	gap: 6px;
	color: var(--text-secondary);
	text-decoration: none;
	font-size: 12px;
	transition: var(--transition-fast);
}

.github-link:hover {
	color: var(--text-color);
}

.github-icon {
	width: 16px;
	height: 16px;
	flex-shrink: 0;
}

/* Make footer stick to bottom on short content */
body {
	min-height: 100vh;
	display: flex;
	flex-direction: column;
}

.container {
	flex: 1;
	display: flex;
	flex-direction: column;
}

/* Tab Content Layout */
.tab-content-container {
	flex: 1;
	display: flex;
	flex-direction: column;
	min-height: 600px;
	width: 100%;
	position: relative;
}

.tab-content {
	display: flex;
	flex-direction: column;
	flex: 1;
	width: 100%;
	opacity: 0;
	visibility: hidden;
	transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out;
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
}

/* Before JS loads, hide all content to prevent flash */
.tab-content-container:not(.tabs-initialized) .tab-content {
	opacity: 0 !important;
	visibility: hidden !important;
}

.tab-content.active {
	opacity: 1;
	visibility: visible;
	position: relative;
}

/* Applications Board Placeholder */
.board-placeholder {
	display: flex;
	align-items: center;
	justify-content: center;
	min-height: 400px;
	flex: 1;
	width: 100%;
	text-align: center;
	color: var(--text-light);
	background: var(--background-color);
	border-radius: var(--radius-lg);
	margin: var(--space-6);
}

.placeholder-content {
	display: flex;
	flex-direction: column;
	align-items: center;
	gap: var(--space-4);
}

.placeholder-icon {
	font-size: var(--font-size-3xl);
	color: var(--text-lighter);
}

.placeholder-content h3 {
	margin: 0;
	font-size: var(--font-size-xl);
	color: var(--text-color);
}

.placeholder-content p {
	margin: 0;
	font-size: var(--font-size-base);
	color: var(--text-light);
}

/* Responsive Design */
@media (max-width: 768px) {
	body {
		padding: var(--space-2);
	}

	.header {
		padding: var(--space-4);
		flex-direction: column;
		gap: var(--space-3);
		align-items: stretch;
	}

	.controls {
		padding: var(--space-4);
		flex-direction: column;
		align-items: stretch;
		gap: var(--space-2);
	}

	.stats {
		grid-template-columns: repeat(auto-fit, minmax(var(--col-12), 1fr));
		gap: var(--space-2);
		padding: var(--space-3) var(--space-4);
	}

	.board-placeholder {
		margin: var(--space-4);
		min-height: 300px;
	}

	.footer-content {
		flex-direction: column;
		gap: 8px;
	}
}

/* Responsive tabs */
@media (max-width: 600px) {
	.tab-navigation {
		flex-direction: column;
	}

	.tab-button {
		width: 100%;
		justify-content: center;
	}
}


/* ============================================================================ */
/* SRC/STYLES/COMPONENTS.CSS */
/* ============================================================================ */

/* ============================================================================ */
/* COMPONENT STYLES - BUTTONS, FORMS, MODALS, AND UI COMPONENTS */
/* ============================================================================ */

/* ============================================================================ */
/* GITHUB-STYLE BUTTONS */
/* ============================================================================ */

button {
	background: var(--gray-50);
	color: var(--text-color);
	border: var(--border-width) solid var(--border-color);
	padding: 5px 16px;
	border-radius: 6px;
	cursor: pointer;
	font-size: var(--font-size-sm);
	font-weight: 500;
	font-family: inherit;
	display: inline-flex;
	align-items: center;
	gap: var(--space-2);
	transition: var(--transition-fast);
	height: 32px;
	min-width: auto;
	position: relative;
	text-decoration: none;
	white-space: nowrap;
	user-select: none;
	box-shadow: 0 1px 0 rgba(27, 31, 35, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.25);
}

button:hover {
	background-color: var(--gray-100);
	border-color: var(--gray-300);
	box-shadow: 0 1px 0 rgba(27, 31, 35, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.03);
	transition-duration: 0.1s;
}

button:active {
	background-color: var(--gray-200);
	border-color: var(--gray-400);
	box-shadow: inset 0 1px 0 rgba(27, 31, 35, 0.04);
}

button:focus {
	outline: 2px solid var(--blue-500);
	outline-offset: -2px;
	box-shadow: none;
}

button:disabled {
	color: var(--gray-500);
	background-color: var(--gray-50);
	border-color: var(--border-color);
	cursor: not-allowed;
}

/* GitHub Primary Button */
.btn-primary {
	color: var(--white);
	background-color: var(--green-500);
	border-color: rgba(27, 31, 35, 0.15);
	box-shadow: 0 1px 0 rgba(27, 31, 35, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.03);
}

.btn-primary:hover {
	background-color: var(--green-600);
}

.btn-primary:active {
	background-color: var(--green-700);
	box-shadow: inset 0 1px 0 rgba(27, 31, 35, 0.15);
}

/* GitHub-style subtle action buttons */
.action-btn {
	padding: 4px;
	min-width: 24px;
	height: 24px;
	border-radius: 6px;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	transition: var(--transition-fast);
	box-shadow: none;
	border: 1px solid transparent;
	background: transparent;
	color: var(--gray-500);
}

.action-btn .material-symbols-outlined {
	font-size: 16px;
	font-weight: 400;
}

.edit-btn:hover {
	background: var(--blue-50);
	color: var(--blue-600);
}

.delete-btn:hover {
	background: var(--red-50);
	color: var(--red-600);
}

.save-btn:hover {
	background: var(--green-50);
	color: var(--green-600);
}

.cancel-btn:hover {
	background: var(--gray-100);
	color: var(--gray-700);
}

/* ============================================================================ */
/* GITHUB-STYLE FORMS AND INPUTS */
/* ============================================================================ */

input,
select,
textarea {
	padding: 5px 12px;
	border: var(--border-width) solid var(--border-color);
	border-radius: 6px;
	font-size: var(--font-size-sm);
	font-family: inherit;
	background: var(--white);
	color: var(--text-color);
	transition: var(--transition-fast);
	min-height: 32px;
	box-shadow: inset 0 1px 0 rgba(27, 31, 35, 0.075);
}
.contact-field-input {
	border: none;
	box-shadow: none;
}

input:focus,
select:focus,
textarea:focus {
	outline: 2px solid var(--blue-500);
	outline-offset: -2px;
	border-color: var(--blue-500);
	box-shadow: none;
}

input:hover,
select:hover,
textarea:hover {
	border-color: var(--gray-300);
}

input::placeholder,
textarea::placeholder {
	color: var(--text-lighter);
}

.filter-select {
	padding: var(--padding-xs);
	border: var(--border-width) solid var(--border-color);
	border-radius: var(--radius-md);
	font-size: var(--font-size-base);
	background: var(--container-background);
	color: var(--text-color);
}

/* Note: Main inline-edit styles are in table.css */

/* Common textarea styles */
textarea {
	resize: vertical;
	min-height: 80px;
	line-height: var(--line-height-normal);
	field-sizing: content;
}

/* Modal form layouts */
.add-contact-row {
	margin-top: 12px;
	padding: 12px;
	background: var(--gray-50);
	border: 1px solid var(--border-color);
	border-radius: 6px;
}

.add-contact-title {
	margin: 0 0 8px 0;
	font-size: var(--font-size-xs);
	font-weight: 600;
	color: var(--text-color);
}

.contact-form-row {
	display: grid;
	grid-template-columns: 1fr 1fr;
	gap: 8px;
	margin-bottom: 0;
}

.add-contact-name,
.add-contact-email,
.add-contact-phone,
.add-contact-company {
	width: 100%;
	padding: 6px 8px;
	border: 1px solid var(--border-color);
	border-radius: 6px;
	font-size: var(--font-size-xs);
	background: var(--white);
	min-height: 28px;
	transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.add-contact-name:focus,
.add-contact-email:focus,
.add-contact-phone:focus,
.add-contact-company:focus {
	border-color: var(--blue-500);
	box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.12);
	outline: none;
}

/* GitHub-style add forms */
.add-note-section,
.add-task-section {
	margin-top: 12px;
	padding: 12px;
	background: var(--gray-50);
	border: 1px solid var(--border-color);
	border-radius: 6px;
}

.add-note-title,
.add-task-title {
	margin: 0 0 8px 0;
	font-size: var(--font-size-xs);
	font-weight: 600;
	color: var(--text-color);
}

.add-note-textarea {
	width: 100%;
	resize: vertical;
	min-height: 60px;
	padding: 8px;
	border: 1px solid var(--border-color);
	border-radius: 6px;
	font-size: var(--font-size-xs);
	font-family: inherit;
	background: var(--white);
	line-height: 1.4;
	transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.add-note-textarea:focus {
	border-color: var(--blue-500);
	box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.12);
	outline: none;
}

.add-task-form,
.add-note-form,
.add-contact-form {
	display: flex;
	flex-direction: column;
	gap: 12px;
}

.add-task-textarea {
	width: 100%;
	resize: vertical;
	min-height: 60px;
	padding: 8px;
	border: 1px solid var(--border-color);
	border-radius: 6px;
	font-size: var(--font-size-xs);
	font-family: inherit;
	background: var(--white);
	line-height: 1.4;
	transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.add-task-textarea:focus {
	border-color: var(--blue-500);
	box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.12);
	outline: none;
}

.add-task-form-row {
	display: grid;
	grid-template-columns: 1fr 1fr 1fr 1fr;
	gap: 8px;
	margin-bottom: 8px;
}

.add-task-field {
	display: flex;
	flex-direction: column;
	gap: 2px;
}

.add-task-field label {
	font-size: var(--font-size-xs);
	font-weight: 500;
	color: var(--text-color);
}

.add-task-status,
.add-task-priority,
.add-task-due-date,
.add-task-duration {
	width: 100%;
	padding: 6px 8px;
	border: 1px solid var(--border-color);
	border-radius: 6px;
	font-size: var(--font-size-xs);
	background: var(--white);
	min-height: 28px;
	transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.add-task-status:focus,
.add-task-priority:focus,
.add-task-due-date:focus,
.add-task-duration:focus {
	border-color: var(--blue-500);
	box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.12);
	outline: none;
}

/* Form action buttons */
.add-task-form-actions,
.add-note-form-actions,
.add-contact-form-actions {
	display: flex;
	gap: 8px;
	justify-content: flex-end;
	margin-top: 8px;
	padding-top: 8px;
	border-top: 1px solid var(--border-light);
}

.add-task-duration {
	font-family: var(--font-mono);
}

/* Task table styles */
.tasks-table {
	width: 100%;
	border-collapse: collapse;
	margin-bottom: 16px;
}

.tasks-table th,
.tasks-table td {
	padding: 8px 12px;
	text-align: left;
	border-bottom: 1px solid var(--border-color);
}

.tasks-table th {
	background: var(--gray-50);
	font-weight: 600;
	font-size: 12px;
	text-transform: uppercase;
	color: var(--gray-600);
}

.task-text-cell {
	cursor: pointer;
	padding: 12px;
	background: var(--gray-50);
	border-bottom: 1px solid var(--border-color);
}

.task-text-cell:hover {
	background: var(--gray-100);
}

/* Task field displays */
.task-status-display,
.task-priority-display,
.task-due-date-display,
.task-duration-display {
	display: block;
	padding: 8px 12px;
	border: 1px solid transparent;
	border-radius: 6px;
	background: transparent;
	min-height: 18px;
	line-height: 18px;
}

/* Excel-like inline editing for tasks */
.task-status-edit,
.task-priority-edit {
	display: block;
	padding: 0;
	border: none;
	border-radius: 0;
	background: transparent;
	font-size: 11px;
	width: 100%;
	height: 32px;
	box-sizing: border-box;
	appearance: none;
	outline: none;
	box-shadow: none;
}

.task-status-edit:focus,
.task-priority-edit:focus {
	outline: 2px solid var(--primary-color);
	outline-offset: -2px;
}

.task-due-date-edit,
.task-duration-edit {
	display: block;
	padding: 0;
	border: none;
	border-radius: 0;
	background: transparent;
	font-size: 12px;
	font-family: var(--font-mono, monospace);
	width: 100%;
	height: 32px;
	box-sizing: border-box;
	outline: none;
}

.task-due-date-edit:focus,
.task-duration-edit:focus {
	outline: 2px solid var(--primary-color);
	outline-offset: -2px;
}

.task-text-edit {
	display: block;
	padding: 0;
	border: none;
	border-radius: 0;
	background: transparent;
	font-size: 13px;
	font-style: italic;
	color: var(--gray-600);
	width: 100%;
	height: 32px;
	box-sizing: border-box;
	resize: none;
	outline: none;
}

.task-text-edit:focus {
	outline: 2px solid var(--primary-color);
	outline-offset: -2px;
}

/* Archived tasks section */
.archived-tasks-section {
	margin-top: 24px;
	padding-top: 24px;
	border-top: 1px solid var(--border-color);
}

.tasks-archived-header {
	display: flex;
	align-items: center;
	gap: 8px;
	cursor: pointer;
	margin: 0 0 16px 0;
	font-size: 16px;
	font-weight: 600;
	color: var(--text-color);
}

.tasks-archived-header:hover {
	color: var(--blue-600);
}

.expand-icon {
	font-size: 20px !important;
	transition: transform 0.2s ease;
}

.archived-task-text-cell {
	padding: 8px 12px;
	border-bottom: 1px solid var(--border-color);
}

/* Remove hover effect from archived task text cells */
.archived-task-text-cell:hover {
	background: transparent;
}

.inline-edit-textarea,
.inline-edit-date,
.inline-edit-duration {
	width: 100%;
	padding: 4px 8px;
	border: 1px solid var(--blue-500);
	border-radius: 4px;
	font-size: 14px;
	background: var(--white);
}

.inline-edit-textarea {
	resize: vertical;
	min-height: 60px;
}

.inline-edit-duration {
	font-family: var(--font-mono);
}

/* ============================================================================ */
/* CONTACTS VIEW */
/* ============================================================================ */

.contacts-container {
	padding: 24px;
	display: flex;
	flex-direction: column;
	flex: 1;
}

.contacts-header {
	display: flex;
	align-items: center;
	justify-content: space-between;
	margin-bottom: 20px;
}

.contacts-title {
	margin: 0;
	font-size: 20px;
	font-weight: 600;
	color: var(--text-color);
}

/* Field validation */
.contact-cell.has-error .contact-field-input {
	background: var(--red-50);
	box-shadow: inset 2px 0 0 var(--red-500);
}

.field-error {
	position: absolute;
	bottom: -20px;
	left: 12px;
	font-size: 12px;
	color: var(--red-600);
	background: var(--white);
	padding: 2px 6px;
	border-radius: 4px;
	border: 1px solid var(--red-200);
	z-index: 10;
	white-space: nowrap;
}

/* Validation error for forms */
.validation-error {
	display: flex;
	align-items: center;
	gap: 6px;
	margin-top: 6px;
	padding: 8px 12px;
	background: var(--red-50);
	border: 1px solid var(--red-200);
	border-radius: 6px;
	font-size: 13px;
	color: var(--red-700);
}

.validation-error .material-symbols-outlined {
	font-size: 16px;
	color: var(--red-600);
}

/* Table actions */
.contacts-actions {
	margin-top: 16px;
}

/* Empty state */
.contacts-empty {
	padding: 40px 20px;
	text-align: center;
}

.contacts-empty-message {
	color: var(--gray-500);
	font-size: 16px;
	margin: 0;
}

/* Add contact form */
.add-contact-form {
	display: flex;
	flex-direction: column;
	gap: 16px;
}

.contact-form-row {
	display: grid;
	grid-template-columns: 1fr 1fr;
	gap: 16px;
}

.contact-form-field {
	display: flex;
	flex-direction: column;
	gap: 4px;
}

.contact-form-field.full-width {
	grid-column: span 2;
}

.contact-form-field label {
	font-size: 14px;
	font-weight: 500;
	color: var(--text-color);
}

.contact-form-field input,
.contact-form-field select {
	width: 100%;
	padding: 8px 12px;
	border: var(--border-width) solid var(--border-color);
	border-radius: 6px;
	font-size: 14px;
	background: var(--white);
	color: var(--text-color);
	font-family: inherit;
}

.contact-form-field input:focus,
.contact-form-field select:focus {
	outline: 2px solid var(--blue-500);
	outline-offset: -2px;
	border-color: var(--blue-500);
}

/* Responsive */
@media (max-width: 768px) {
	.contacts-container {
		padding: 16px;
	}

	.contacts-header {
		flex-direction: column;
		align-items: flex-start;
		gap: 12px;
	}

	.contacts-title {
		font-size: 18px;
	}

	.contact-form-row {
		grid-template-columns: 1fr;
	}

	.contact-form-field.full-width {
		grid-column: span 1;
	}
}

@media (max-width: 640px) {
	.contact-form-row {
		grid-template-columns: 1fr;
	}
}

/* ============================================================================ */
/* DROPDOWNS */
/* ============================================================================ */

.header-with-filter {
	position: relative;
	display: flex;
	align-items: center;
	gap: var(--space-1);
}

.filter-dropdown-icon {
	cursor: pointer;
	font-size: 12px;
	color: var(--gray-500);
	user-select: none;
	padding: 2px;
	border-radius: 3px;
	transition: var(--transition-fast);
	display: inline-flex;
	align-items: center;
}

.filter-dropdown-icon:hover {
	color: var(--gray-700);
	background: var(--gray-100);
}

.filter-dropdown-icon .material-symbols-outlined {
	font-size: 14px;
}

.filter-dropdown {
	display: none;
	position: absolute;
	top: 100%;
	left: 0;
	background: var(--white);
	border: var(--border-width) solid var(--border-color);
	border-radius: 6px;
	box-shadow: 0 8px 24px rgba(140, 149, 159, 0.2);
	z-index: 1500;
	min-width: 120px;
	margin-top: 4px;
}

.dropdown-option {
	padding: 6px 12px;
	cursor: pointer;
	font-size: 12px;
	font-weight: normal;
}

.dropdown-option:hover {
	background: var(--background-color);
}

.dropdown-option:first-child {
	border-top-left-radius: var(--radius-md);
	border-top-right-radius: var(--radius-md);
}

.dropdown-option:last-child {
	border-bottom-left-radius: var(--radius-md);
	border-bottom-right-radius: var(--radius-md);
}

/* ============================================================================ */
/* GITHUB-STYLE MODALS */
/* ============================================================================ */

.modal-overlay {
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background: var(--modal-backdrop);
	display: flex;
	align-items: flex-start;
	justify-content: center;
	z-index: 2000;
	padding: 40px 16px 16px;
	overflow-y: auto;
}

.modal {
	background: var(--white);
	border-radius: 12px;
	box-shadow: 0 8px 24px rgba(140, 149, 159, 0.2);
	border: var(--border-width) solid var(--border-color);
	max-width: 800px;
	width: 100%;
	max-height: calc(100vh - 80px);
	overflow: hidden;
	display: flex;
	flex-direction: column;
	position: relative;
}

.modal-header {
	padding: 16px 24px;
	border-bottom: var(--border-width) solid var(--border-color);
	display: flex;
	align-items: center;
	justify-content: space-between;
	background: var(--gray-50);
	border-radius: 12px 12px 0 0;
}

.modal-title {
	margin: 0;
	font-size: var(--font-size-xs);
	font-weight: 600;
	color: var(--text-color);
	line-height: 1.25;
}

.modal-close {
	background: none;
	border: none;
	font-size: var(--font-size-xs);
	cursor: pointer;
	color: var(--gray-500);
	min-width: auto;
	height: auto;
	padding: 4px;
	border-radius: 6px;
	box-shadow: none;
}

.modal-close:hover {
	color: var(--gray-700);
	background: var(--gray-100);
	transform: none;
	box-shadow: none;
}

.modal-body {
	padding: 24px;
	overflow-y: auto;
	flex: 1;
	background: var(--white);
}

.modal-footer {
	padding: 16px 24px;
	border-top: var(--border-width) solid var(--border-color);
	background: var(--gray-50);
	display: flex;
	gap: 8px;
	justify-content: flex-end;
	border-radius: 0 0 12px 12px;
}

/* Modal content font size standardization */
.modal-body,
.modal-body p,
.modal-empty-message {
	font-size: var(--font-size-xs);
}

.modal-empty-message {
	text-align: center;
	color: var(--gray-600);
	font-style: italic;
	margin: 24px 0;
}

/* ============================================================================ */
/* GITHUB-STYLE COUNTERS AND BADGES */
/* ============================================================================ */

/* Count badges in table cells (not stats) */
td .notes-count,
td .tasks-count,
td .contacts-count {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	min-width: 20px;
	height: 20px;
	padding: 0 6px;
	background: var(--gray-200);
	color: var(--gray-700);
	border-radius: 10px;
	font-size: 12px;
	font-weight: 500;
	cursor: pointer;
	transition: var(--transition-fast);
	user-select: none;
	border: none;
}

td .zero-count {
	background: var(--gray-100);
	color: var(--gray-500);
	cursor: default;
	border-color: var(--gray-200);
}

td .zero-count:hover {
	background: var(--gray-100);
	color: var(--gray-500);
	border-color: var(--gray-200);
}

/* Priority indicators */
.priority {
	display: inline-block;
	width: var(--priority-dot-size);
	height: var(--priority-dot-size);
	border-radius: var(--radius-full);
	margin-right: var(--space-2);
}

.priority-high {
	background: var(--priority-high);
}

.priority-medium {
	background: var(--priority-medium);
}

.priority-low {
	background: var(--priority-low);
}

/* ============================================================================ */
/* GITHUB-STYLE STATUS BADGES */
/* ============================================================================ */

.status {
	padding: 4px 8px;
	border-radius: 12px;
	font-size: 12px;
	font-weight: 500;
	text-align: center;
	white-space: nowrap;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	min-width: 60px;
	height: 22px;
	text-transform: none;
	letter-spacing: normal;
	border: 1px solid transparent;
}

.status-wishlist {
	background: var(--status-wishlist-bg);
	color: var(--status-wishlist-text);
}

.status-applied {
	background: var(--status-applied-bg);
	color: var(--status-applied-text);
}

.status-phone_screening {
	background: var(--status-screening-bg);
	color: var(--status-screening-text);
}

.status-interview {
	background: var(--status-interview-bg);
	color: var(--status-interview-text);
}

.status-final_round {
	background: var(--status-final-bg);
	color: var(--status-final-text);
}

.status-offer {
	background: var(--status-offer-bg);
	color: var(--status-offer-text);
}

.status-rejected {
	background: var(--status-rejected-bg);
	color: var(--status-rejected-text);
}

.status-withdrawn {
	background: var(--status-withdrawn-bg);
	color: var(--status-withdrawn-text);
}

/* ============================================================================ */
/* GITHUB-STYLE LANGUAGE SWITCHER */
/* ============================================================================ */

.language-switcher {
	display: flex;
	align-items: center;
	gap: 8px;
	position: relative;
}

.language-selector {
	position: relative;
	display: inline-block;
}

.language-button {
	display: flex;
	align-items: center;
	gap: 6px;
	padding: 5px 12px;
	background: var(--gray-50);
	border: var(--border-width) solid var(--border-color);
	border-radius: 6px;
	color: var(--text-color);
	text-decoration: none;
	font-size: 14px;
	font-weight: 500;
	transition: var(--transition-fast);
	cursor: pointer;
	box-shadow: 0 1px 0 rgba(27, 31, 35, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.25);
	height: 32px;
}

.language-button:hover {
	background-color: var(--gray-100);
	border-color: var(--gray-300);
	box-shadow: 0 1px 0 rgba(27, 31, 35, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.03);
}

.language-button.active {
	background: var(--primary-color);
	border-color: var(--primary-color);
	color: var(--text-on-primary);
}

.language-flag {
	font-size: 16px;
	line-height: 1;
}

.language-dropdown {
	position: absolute;
	top: 100%;
	left: 0;
	right: 0;
	background: var(--white);
	border: var(--border-width) solid var(--border-color);
	border-radius: 6px;
	box-shadow: 0 8px 24px rgba(140, 149, 159, 0.2);
	z-index: 1500;
	min-width: 120px;
	margin-top: 4px;
}

.language-option {
	padding: 8px 12px;
	cursor: pointer;
	font-size: 14px;
	font-weight: normal;
	display: flex;
	align-items: center;
	gap: 8px;
	transition: var(--transition-fast);
}

.language-option:hover {
	background: var(--gray-50);
}

.language-option:first-child {
	border-top-left-radius: 6px;
	border-top-right-radius: 6px;
}

.language-option:last-child {
	border-bottom-left-radius: 6px;
	border-bottom-right-radius: 6px;
}

.language-arrow {
	font-size: 16px;
	color: var(--gray-500);
	transition: var(--transition-fast);
}

.language-button:hover .language-arrow {
	color: var(--gray-700);
}

/* ============================================================================ */
/* GITHUB-STYLE TAB NAVIGATION */
/* ============================================================================ */

.tab-navigation {
	display: flex;
	background: var(--white);
	border-bottom: var(--border-width) solid var(--border-color);
	gap: 0;
	padding: 0 24px;
}

.tab-button {
	display: flex;
	align-items: center;
	gap: 8px;
	padding: 8px 16px;
	background: transparent;
	border: none;
	border-bottom: 2px solid transparent;
	color: var(--gray-600);
	text-decoration: none;
	font-size: 14px;
	font-weight: 500;
	transition: var(--transition-fast);
	cursor: pointer;
	min-width: auto;
	height: auto;
	box-shadow: none;
	position: relative;
	border-radius: 0;
}

.tab-button:hover {
	background: transparent;
	color: var(--text-color);
	border-bottom-color: var(--gray-300);
	transform: none;
	box-shadow: none;
}

.tab-button.active {
	color: var(--text-color);
	border-bottom-color: #fd8c73;
	background: transparent;
	/* Use a slightly bolder weight that's closer to the normal weight */
	font-weight: 600;
	/* Compensate for the slight width increase with negative letter-spacing */
	letter-spacing: -0.01em;
}

.tab-icon {
	font-size: var(--icon-lg);
}

.tab-text {
	font-weight: inherit;
}

/* ============================================================================ */
/* GITHUB-STYLE KANBAN BOARD */
/* ============================================================================ */

.kanban-container {
	padding: 24px;
	display: flex;
	flex-direction: column;
	flex: 1;
}

.kanban-header {
	display: flex;
	align-items: center;
	justify-content: space-between;
	margin-bottom: 24px;
	padding-bottom: 16px;
	border-bottom: var(--border-width) solid var(--border-color);
}

.kanban-title {
	font-size: 24px;
	font-weight: 600;
	color: var(--text-color);
	margin: 0;
}

.kanban-board {
	display: flex !important;
	flex-direction: row !important;
	flex-wrap: nowrap !important;
	gap: 16px;
	overflow-x: auto;
	padding: 8px 0;
	flex: 1;
	align-items: stretch;
}

.kanban-column {
	min-width: 280px;
	width: 280px;
	background: var(--gray-50);
	border-radius: 12px;
	border: var(--border-width) solid var(--border-color);
	display: flex;
	flex-direction: column;
	height: 100%;
	transition: var(--transition-fast);
}

.kanban-column.drag-active {
	border-color: var(--blue-300);
}

.kanban-column.drag-over {
	background: var(--blue-50);
	border-color: var(--blue-500);
	transform: scale(1.02);
}

.kanban-column-header {
	padding: 16px;
	border-bottom: var(--border-width) solid var(--border-color);
	background: var(--white);
	border-radius: 12px 12px 0 0;
}

.kanban-column-title {
	display: flex;
	align-items: center;
	justify-content: space-between;
}

.kanban-column-name {
	font-size: 14px;
	font-weight: 600;
	color: var(--text-color);
}

.kanban-column-actions {
	display: flex;
	align-items: center;
	gap: 6px;
}

.kanban-column-count {
	background: var(--gray-200);
	color: var(--gray-700);
	padding: 2px 8px;
	border-radius: 12px;
	font-size: 12px;
	font-weight: 500;
	min-width: 20px;
	text-align: center;
}

.kanban-add-job-btn {
	background: var(--gray-50);
	color: var(--text-color);
	border: var(--border-width) solid var(--border-color);
	padding: 2px 6px;
	border-radius: 6px;
	font-size: 12px;
	font-weight: 500;
	display: inline-flex;
	align-items: center;
	gap: 2px;
	cursor: pointer;
	transition: var(--transition-fast);
	height: 20px;
	box-shadow: 0 1px 0 rgba(27, 31, 35, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.25);
}

.kanban-add-job-btn:hover {
	background-color: var(--gray-100);
	border-color: var(--gray-300);
	box-shadow: 0 1px 0 rgba(27, 31, 35, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.03);
}

.kanban-add-job-btn .material-symbols-outlined {
	font-size: 12px;
	font-weight: 400;
}

.kanban-column-body {
	padding: 12px;
	flex: 1;
	overflow-y: auto;
	display: flex;
	flex-direction: column;
	gap: 8px;
}

.kanban-job-card {
	background: var(--white);
	border: var(--border-width) solid var(--border-color);
	border-radius: 8px;
	padding: 12px;
	cursor: pointer;
	transition: var(--transition-fast);
	position: relative;
	box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.kanban-job-card:hover {
	border-color: var(--blue-300);
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
	transform: translateY(-1px);
}

.kanban-job-card.dragging {
	opacity: 0.5;
	transform: rotate(5deg);
}

.kanban-priority-dot {
	position: absolute;
	top: 8px;
	right: 8px;
	width: 8px;
	height: 8px;
	border-radius: 50%;
}

.kanban-priority-dot.priority-high {
	background: var(--red-500);
}

.kanban-priority-dot.priority-medium {
	background: var(--orange-500);
}

.kanban-priority-dot.priority-low {
	background: var(--green-500);
}

.kanban-job-header {
	display: flex;
	align-items: center;
	gap: 6px;
	margin-bottom: 8px;
}

.kanban-job-icon {
	font-size: 14px;
	flex-shrink: 0;
	color: var(--gray-600);
}

.kanban-job-title {
	display: flex;
	flex-direction: column;
	gap: 2px;
	flex: 1;
}

.kanban-job-company {
	font-size: 14px;
	font-weight: 600;
	color: var(--text-color);
	line-height: 1.3;
	word-break: break-word;
}

.kanban-job-position {
	font-size: 13px;
	font-weight: 400;
	color: var(--gray-600);
	line-height: 1.3;
	word-break: break-word;
}

/* Source link inherits kanban-icon-btn styles but as an anchor */
a.kanban-source-link {
	text-decoration: none;
	color: inherit;
}

.kanban-phase-section {
	margin-bottom: 8px;
}

.kanban-phase-header {
	display: flex;
	align-items: center;
	gap: 4px;
	margin-bottom: 4px;
}

.kanban-phase-icon {
	font-size: 12px;
	color: var(--gray-500);
}

.kanban-phase-text {
	font-size: 11px;
	font-weight: 500;
	color: var(--gray-600);
}

.kanban-substeps-list {
	display: flex;
	flex-direction: column;
	gap: 2px;
	margin-left: 16px;
}

.kanban-substep-item {
	display: flex;
	align-items: center;
	gap: 4px;
	padding: 2px 0;
}

.kanban-substep-icon {
	font-size: 10px;
	width: 12px;
	flex-shrink: 0;
}

.kanban-substep-text {
	font-size: 10px;
	line-height: 1.2;
}

.kanban-substep-item.completed .kanban-substep-text {
	color: var(--green-600);
}

.kanban-substep-item.completed .kanban-substep-icon {
	color: var(--green-600);
}

.kanban-substep-item.current .kanban-substep-text {
	color: var(--orange-600);
	font-weight: 500;
}

.kanban-substep-item.current .kanban-substep-icon {
	color: var(--orange-600);
}

.kanban-substep-item.pending .kanban-substep-text {
	color: var(--gray-500);
}

.kanban-substep-item.pending .kanban-substep-icon {
	color: var(--gray-400);
}

.kanban-action-icons {
	display: flex;
	gap: 4px;
	justify-content: flex-end;
	margin-top: 8px;
	padding-top: 8px;
	border-top: 1px solid var(--gray-200);
}

.kanban-icon-btn {
	display: flex;
	align-items: center;
	justify-content: center;
	width: 24px;
	height: 24px;
	background: transparent;
	border: 1px solid transparent;
	border-radius: 4px;
	color: var(--gray-500);
	cursor: pointer;
	transition: var(--transition-fast);
	padding: 0;
	min-width: auto;
	box-shadow: none;
	position: relative;
}

.kanban-icon-btn:hover {
	background: var(--gray-100);
	color: var(--gray-700);
	border-color: var(--gray-300);
	transform: none;
	box-shadow: none;
}

.kanban-icon-btn .material-symbols-outlined {
	font-size: 14px;
}

.kanban-count-badge {
	position: absolute;
	top: -4px;
	right: -4px;
	background: var(--gray-200);
	color: var(--gray-700);
	font-size: 10px;
	font-weight: 500;
	min-width: 16px;
	height: 16px;
	border-radius: 8px;
	display: flex;
	align-items: center;
	justify-content: center;
	padding: 0 4px;
	border: 1px solid var(--gray-300);
	z-index: 1;
}

.kanban-job-metadata {
	display: flex;
	flex-direction: column;
	gap: 3px;
	margin-bottom: 8px;
}

.kanban-metadata-item {
	display: flex;
	align-items: center;
	gap: 4px;
}

.kanban-metadata-icon {
	font-size: 10px;
	width: 12px;
	flex-shrink: 0;
	color: var(--gray-500);
}

.kanban-metadata-text {
	font-size: 10px;
	color: var(--gray-600);
	line-height: 1.2;
}

/* ============================================================================ */
/* TASKS BOARD */
/* ============================================================================ */

.tasks-container {
	padding: 24px;
	display: flex;
	flex-direction: column;
	flex: 1;
}

.tasks-header {
	display: flex;
	align-items: center;
	justify-content: space-between;
	margin-bottom: 24px;
	padding-bottom: 16px;
	border-bottom: var(--border-width) solid var(--border-color);
}

.tasks-title {
	font-size: 24px;
	font-weight: 600;
	color: var(--text-color);
	margin: 0;
}

.tasks-board {
	display: flex !important;
	flex-direction: row !important;
	flex-wrap: nowrap !important;
	gap: 16px;
	overflow-x: auto;
	padding: 8px 0;
	flex: 1;
	align-items: stretch;
}

.tasks-column {
	flex: 1;
	min-width: 0;
	background: var(--gray-50);
	border-radius: 12px;
	border: var(--border-width) solid var(--border-color);
	display: flex;
	flex-direction: column;
	height: 100%;
	transition: var(--transition-fast);
}

.tasks-column.drag-active {
	border-color: var(--blue-300);
}

.tasks-column.drag-over {
	background: var(--blue-50);
	border-color: var(--blue-500);
	transform: scale(1.02);
}

.tasks-column-header {
	padding: 16px;
	border-bottom: var(--border-width) solid var(--border-color);
	background: var(--white);
	border-radius: 12px 12px 0 0;
}

.tasks-column-title {
	display: flex;
	align-items: center;
	justify-content: space-between;
}

.tasks-column-name {
	font-size: 14px;
	font-weight: 600;
	color: var(--text-color);
}

.tasks-column-count {
	background: var(--gray-200);
	color: var(--gray-700);
	padding: 2px 8px;
	border-radius: 12px;
	font-size: 12px;
	font-weight: 500;
	min-width: 20px;
	text-align: center;
}

.tasks-column-body {
	padding: 12px;
	flex: 1;
	overflow-y: auto;
	display: flex;
	flex-direction: column;
	gap: 8px;
}

.tasks-task-card {
	background: var(--white);
	border: var(--border-width) solid var(--border-color);
	border-radius: 8px;
	padding: 12px;
	cursor: pointer;
	transition: var(--transition-fast);
	position: relative;
	box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.tasks-task-card:hover {
	border-color: var(--blue-300);
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
	transform: translateY(-1px);
}

.tasks-task-card.dragging {
	opacity: 0.5;
	transform: rotate(5deg);
}

.tasks-priority-dot {
	position: absolute;
	top: 8px;
	right: 8px;
	width: 8px;
	height: 8px;
	border-radius: 50%;
}

.tasks-priority-dot.priority-high {
	background: var(--red-500);
}

.tasks-priority-dot.priority-medium {
	background: var(--orange-500);
}

.tasks-priority-dot.priority-low {
	background: var(--green-500);
}

.tasks-task-content {
	margin-bottom: 12px;
	padding-right: 16px;
}

.tasks-task-text {
	font-size: 14px;
	font-weight: 500;
	color: var(--text-color);
	line-height: 1.4;
	word-wrap: break-word;
}

.tasks-job-context {
	display: flex;
	flex-direction: column;
	gap: 4px;
	margin-bottom: 12px;
}

.tasks-job-info,
.tasks-job-phase {
	display: flex;
	align-items: center;
	gap: 4px;
}

.tasks-job-icon,
.tasks-phase-icon {
	font-size: 12px;
	color: var(--gray-500);
	flex-shrink: 0;
}

.tasks-job-text,
.tasks-phase-text {
	font-size: 11px;
	color: var(--gray-600);
	line-height: 1.2;
}

.tasks-action-icons {
	display: flex;
	gap: 4px;
	justify-content: flex-end;
	padding-top: 8px;
	border-top: 1px solid var(--gray-200);
}

.tasks-icon-btn {
	display: flex;
	align-items: center;
	justify-content: center;
	width: 24px;
	height: 24px;
	background: transparent;
	border: 1px solid transparent;
	border-radius: 4px;
	color: var(--gray-500);
	cursor: pointer;
	transition: var(--transition-fast);
	padding: 0;
	min-width: auto;
	box-shadow: none;
	position: relative;
}

.tasks-icon-btn:hover {
	background: var(--gray-100);
	color: var(--gray-700);
	border-color: var(--gray-300);
	transform: none;
	box-shadow: none;
}

.tasks-icon-btn .material-symbols-outlined {
	font-size: 14px;
}

/* Responsive tasks board */
@media (max-width: 768px) {
	.tasks-container {
		padding: 16px;
	}

	.tasks-board {
		gap: 12px;
	}

	.tasks-column {
		min-width: 200px;
	}

	.tasks-task-card {
		padding: 10px;
	}
}

/* ============================================================================ */
/* KANBAN JOB EDIT MODAL */
/* ============================================================================ */

.job-edit-modal {
	max-width: 600px;
	width: 100%;
}

.job-edit-form {
	display: flex;
	flex-direction: column;
	gap: 16px;
}

.form-row {
	display: grid;
	grid-template-columns: 1fr 1fr;
	gap: 16px;
}

.form-field {
	display: flex;
	flex-direction: column;
	gap: 4px;
}

.form-field.full-width {
	grid-column: span 2;
}

.form-field label {
	font-size: 14px;
	font-weight: 500;
	color: var(--text-color);
}

.form-field input,
.form-field select {
	width: 100%;
	padding: 8px 12px;
	border: var(--border-width) solid var(--border-color);
	border-radius: 6px;
	font-size: 14px;
	font-family: inherit;
	background: var(--white);
	color: var(--text-color);
	transition: var(--transition-fast);
}

.form-field input:focus,
.form-field select:focus {
	outline: 2px solid var(--blue-500);
	outline-offset: -2px;
	border-color: var(--blue-500);
}

.btn-secondary {
	background: var(--gray-50);
	color: var(--text-color);
	border: var(--border-width) solid var(--border-color);
}

.btn-secondary:hover {
	background: var(--gray-100);
	border-color: var(--gray-300);
}

.btn-primary {
	background: var(--green-500);
	color: var(--white);
	border: var(--border-width) solid var(--green-500);
}

.btn-primary:hover {
	background: var(--green-600);
	border-color: var(--green-600);
}

/* Responsive form */
@media (max-width: 640px) {
	.form-row {
		grid-template-columns: 1fr;
	}

	.form-field.full-width {
		grid-column: span 1;
	}
}

/* Responsive kanban board */
@media (max-width: 768px) {
	.kanban-container {
		padding: 16px;
	}

	.kanban-board {
		gap: 12px;
	}

	.kanban-column {
		min-width: 240px;
		width: 240px;
	}

	.kanban-job-card {
		padding: 10px;
	}
}

/* ============================================================================ */
/* CALENDAR VIEW */
/* ============================================================================ */

.calendar-container {
	padding: 24px;
	display: flex;
	flex-direction: column;
	flex: 1;
	background: var(--white);
}

.calendar-header {
	display: flex;
	align-items: center;
	justify-content: space-between;
	margin-bottom: 24px;
	padding-bottom: 16px;
	border-bottom: var(--border-width) solid var(--border-color);
}

.calendar-title {
	font-size: 24px;
	font-weight: 600;
	color: var(--text-color);
	margin: 0;
}

.calendar-controls {
	display: flex;
	align-items: center;
	gap: 24px;
}

.calendar-view-selector {
	display: flex;
	background: var(--gray-100);
	border-radius: 6px;
	padding: 2px;
}

.view-btn {
	padding: 6px 16px;
	background: transparent;
	border: none;
	border-radius: 4px;
	color: var(--gray-600);
	font-size: 14px;
	font-weight: 500;
	cursor: pointer;
	transition: var(--transition-fast);
}

.view-btn:hover {
	color: var(--text-color);
}

.view-btn.active {
	background: var(--white);
	color: var(--text-color);
	box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.calendar-nav {
	display: flex;
	align-items: center;
	gap: 8px;
}

.nav-btn {
	padding: 6px 12px;
	background: var(--white);
	border: var(--border-width) solid var(--border-color);
	border-radius: 6px;
	color: var(--text-color);
	font-size: 14px;
	font-weight: 500;
	cursor: pointer;
	transition: var(--transition-fast);
	display: flex;
	align-items: center;
	gap: 4px;
}

.nav-btn:hover {
	background: var(--gray-50);
	border-color: var(--gray-300);
}

.nav-btn .material-symbols-outlined {
	font-size: 18px;
}

.today-btn {
	padding: 6px 16px;
}

.calendar-period {
	margin-bottom: 24px;
}

.calendar-period-text {
	font-size: 20px;
	font-weight: 500;
	color: var(--text-color);
	margin: 0;
}

.calendar-body {
	flex: 1;
	overflow: auto;
}

/* Month View */
.calendar-month {
	width: 100%;
}

.calendar-weekdays {
	display: grid;
	grid-template-columns: repeat(7, minmax(0, 1fr));
	gap: 1px;
	background: var(--border-color);
	border: var(--border-width) solid var(--border-color);
	border-bottom: none;
	border-radius: 6px 6px 0 0;
}

.calendar-weekday {
	background: var(--gray-50);
	padding: 12px 8px;
	text-align: center;
	font-size: 13px;
	font-weight: 600;
	color: var(--gray-600);
	text-transform: uppercase;
	letter-spacing: 0.5px;
	user-select: none; /* Prevent text selection */
}

.calendar-days {
	display: grid;
	grid-template-columns: repeat(7, minmax(0, 1fr));
	gap: 1px;
	background: var(--border-color);
	border: var(--border-width) solid var(--border-color);
	border-radius: 0 0 6px 6px;
}

.calendar-day {
	background: var(--white);
	min-height: 120px;
	padding: 6px;
	cursor: pointer;
	transition: var(--transition-fast);
	position: relative;
	display: flex;
	flex-direction: column;
	overflow: hidden;
	min-width: 0;
	user-select: none; /* Prevent text selection */
}

.calendar-day:hover {
	background: var(--gray-50);
}

.calendar-day.other-month {
	background: var(--gray-50);
	color: var(--gray-500);
}

.calendar-day.other-month:hover {
	background: var(--gray-100);
}

.calendar-day.today {
	background: var(--blue-50);
}

.calendar-day.today .calendar-day-number {
	background: var(--blue-500);
	color: var(--white);
	width: 28px;
	height: 28px;
	border-radius: 50%;
	display: flex;
	align-items: center;
	justify-content: center;
	font-weight: 600;
}

.calendar-day-number {
	font-size: 14px;
	font-weight: 500;
	margin-bottom: 8px;
}

.calendar-day-events {
	display: flex;
	flex-direction: column;
	gap: 2px;
	margin-top: 4px;
}

.calendar-day-event-mini {
	font-size: 10px;
	padding: 2px 4px;
	border-radius: 2px;
	cursor: pointer;
	transition: var(--transition-fast);
	max-width: 100%;
	overflow: hidden;
}

.calendar-day-event-mini:hover {
	opacity: 0.8;
	transform: scale(1.02);
}

.calendar-event-mini-text {
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
	line-height: 1.2;
	font-weight: 500;
}

.calendar-event-more {
	font-size: 9px;
	color: var(--gray-600);
	cursor: pointer;
	padding: 1px 2px;
	text-align: center;
	font-weight: 500;
}

.calendar-event-more:hover {
	color: var(--text-color);
}

/* Color-specific text colors for better readability */
.calendar-event-task .calendar-event-mini-text {
	color: var(--blue-700);
}

.calendar-event-applied .calendar-event-mini-text {
	color: var(--green-700);
}

.calendar-event-interview .calendar-event-mini-text {
	color: var(--orange-700);
}

.calendar-event-followup .calendar-event-mini-text {
	color: var(--purple-700);
}

/* Drag and Drop Styles */
.calendar-day-event-mini[draggable="true"] {
	cursor: grab;
}

.calendar-day-event-mini[draggable="true"]:active {
	cursor: grabbing;
}

.calendar-day-event-mini.dragging {
	opacity: 0.5;
	transform: scale(0.95);
	z-index: 1000;
}

.calendar-day.drag-over {
	background-color: var(--blue-50) !important;
	border: 2px dashed var(--blue-400) !important;
	transform: scale(1.02);
}

.calendar-day.drag-over .calendar-day-number {
	color: var(--blue-600);
	font-weight: 600;
}

/* Week View */
.calendar-week {
	display: grid;
	grid-template-columns: 60px repeat(7, minmax(0, 1fr));
	gap: 1px;
	background: var(--border-color);
	border: var(--border-width) solid var(--border-color);
	border-radius: 6px;
	height: 600px;
	overflow: hidden;
}

.calendar-week-times {
	background: var(--gray-50);
	display: flex;
	flex-direction: column;
}

.calendar-week-time-header {
	height: 60px;
	border-bottom: var(--border-width) solid var(--border-color);
	background: var(--gray-50);
}

.calendar-time-slot {
	height: 60px;
	padding: 4px 8px;
	font-size: 11px;
	color: var(--gray-600);
	text-align: right;
	border-bottom: 1px solid var(--gray-200);
	user-select: none; /* Prevent text selection */
}

.calendar-week-day {
	background: var(--white);
	display: flex;
	flex-direction: column;
}

.calendar-week-day.today {
	background: var(--blue-50);
}

.calendar-week-day-header {
	padding: 12px;
	text-align: center;
	border-bottom: var(--border-width) solid var(--border-color);
	background: var(--gray-50);
	user-select: none; /* Prevent text selection */
}

.calendar-week-day-name {
	font-size: 12px;
	font-weight: 600;
	color: var(--gray-600);
	text-transform: uppercase;
}

.calendar-week-day-number {
	font-size: 16px;
	font-weight: 500;
	color: var(--text-color);
	margin-top: 4px;
}

.calendar-week-day-events {
	flex: 1;
	padding: 8px;
	overflow-y: auto;
}

.calendar-week-event {
	padding: 6px 8px;
	margin-bottom: 4px;
	border-radius: 4px;
	font-size: 12px;
	cursor: pointer;
	transition: var(--transition-fast);
}

.calendar-week-event:hover {
	transform: translateY(-1px);
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.calendar-event-time {
	font-size: 11px;
	margin-bottom: 2px;
	display: flex;
	align-items: center;
	gap: 4px;
}

.calendar-event-time .material-symbols-outlined {
	font-size: 14px;
}

.calendar-event-title {
	font-weight: 500;
	line-height: 1.3;
}

/* Day View */
.calendar-day-view {
	display: grid;
	grid-template-columns: 60px minmax(0, 1fr);
	gap: 1px;
	background: var(--border-color);
	border: var(--border-width) solid var(--border-color);
	border-radius: 6px;
	height: 600px;
	overflow: hidden;
}

.calendar-day-times {
	background: var(--gray-50);
	display: flex;
	flex-direction: column;
}

.calendar-day-events-column {
	background: var(--white);
	padding: 16px;
	overflow-y: auto;
}

.calendar-no-events {
	text-align: center;
	color: var(--gray-500);
	padding: 40px;
	font-style: italic;
}

.calendar-day-event {
	padding: 12px;
	margin-bottom: 12px;
	border-radius: 6px;
	cursor: pointer;
	transition: var(--transition-fast);
}

.calendar-day-event:hover {
	transform: translateY(-1px);
	box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.calendar-event-header {
	display: flex;
	align-items: center;
	justify-content: space-between;
	margin-bottom: 8px;
}

.calendar-event-priority {
	width: 8px;
	height: 8px;
	border-radius: 50%;
}

.calendar-event-priority.priority-high {
	background: var(--red-500);
}

.calendar-event-priority.priority-medium {
	background: var(--orange-500);
}

.calendar-event-priority.priority-low {
	background: var(--green-500);
}

.calendar-event-subtitle {
	font-size: 12px;
	color: var(--gray-600);
	margin-top: 4px;
}

/* Event Cards */
.calendar-events-modal {
	max-width: 500px;
}

.calendar-events-list {
	display: flex;
	flex-direction: column;
	gap: 12px;
}

.calendar-event-card {
	padding: 16px;
	border: var(--border-width) solid var(--border-color);
	border-radius: 8px;
	cursor: pointer;
	transition: var(--transition-fast);
}

.calendar-event-card:hover {
	border-color: var(--blue-300);
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.calendar-event-card-header {
	display: flex;
	align-items: center;
	justify-content: space-between;
	margin-bottom: 8px;
}

.calendar-event-type-badge {
	padding: 4px 8px;
	border-radius: 4px;
	font-size: 11px;
	font-weight: 600;
	text-transform: uppercase;
}

.priority-badge {
	padding: 2px 8px;
	border-radius: 12px;
	font-size: 11px;
	font-weight: 500;
}

.priority-badge.priority-high {
	background: var(--red-100);
	color: var(--red-700);
}

.priority-badge.priority-medium {
	background: var(--orange-100);
	color: var(--orange-700);
}

.priority-badge.priority-low {
	background: var(--green-100);
	color: var(--green-700);
}

.calendar-event-card-title {
	font-size: 14px;
	font-weight: 600;
	color: var(--text-color);
	margin-bottom: 4px;
}

.calendar-event-card-subtitle {
	font-size: 12px;
	color: var(--gray-600);
}

/* Event Details Modal */
.calendar-event-details-modal {
	max-width: 500px;
}

.event-details {
	display: flex;
	flex-direction: column;
	gap: 12px;
}

.event-detail-row {
	display: flex;
	align-items: center;
	gap: 8px;
}

.event-detail-row strong {
	min-width: 80px;
	font-weight: 600;
	color: var(--text-color);
}

.event-type-badge {
	padding: 4px 8px;
	border-radius: 4px;
	font-size: 12px;
	font-weight: 600;
	text-transform: capitalize;
}

/* Responsive Calendar */
@media (max-width: 768px) {
	.calendar-container {
		padding: 16px;
	}

	.calendar-header {
		flex-direction: column;
		gap: 16px;
		align-items: stretch;
	}

	.calendar-controls {
		flex-direction: column;
		gap: 12px;
	}

	.calendar-view-selector,
	.calendar-nav {
		width: 100%;
		justify-content: center;
	}

	.calendar-day {
		min-height: 80px;
		padding: 6px;
	}

	.calendar-week,
	.calendar-day-view {
		height: 400px;
	}

	.calendar-week-times,
	.calendar-day-times {
		display: none;
	}

	.calendar-week {
		grid-template-columns: repeat(7, 1fr);
	}

	.calendar-day-view {
		grid-template-columns: 1fr;
	}
}

/* ============================================================================ */
/* UNIFIED TAB HEADERS */
/* ============================================================================ */

.tab-header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: var(--space-4);
	padding-bottom: var(--space-3);
	border-bottom: var(--border-width) solid var(--border-color);
}

.tab-title {
	font-size: var(--font-size-xl);
	font-weight: 600;
	color: var(--text-color);
	margin: 0;
	line-height: var(--line-height-tight);
}

/* Jobs container styling */
.jobs-container {
	padding: 24px;
	display: flex;
	flex-direction: column;
	flex: 1;
}

/* Jobs specific header styling */
.jobs-header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: var(--space-4);
	padding-bottom: var(--space-3);
	border-bottom: var(--border-width) solid var(--border-color);
}

.jobs-title {
	font-size: var(--font-size-xl);
	font-weight: 600;
	color: var(--text-color);
	margin: 0;
	line-height: var(--line-height-tight);
}

.tab-stats {
	display: flex;
	background: var(--gray-100);
	border-radius: 6px;
	padding: 1px;
}

.tab-stats .stat-item {
	padding: 6px 16px;
	background: transparent;
	border: none;
	border-radius: 4px;
	color: var(--gray-600);
	font-size: 14px;
	font-weight: 500;
	cursor: pointer;
	transition: var(--transition-fast);
	display: flex;
	align-items: center;
	gap: 2px;
	white-space: nowrap;
}

.tab-stats .stat-item:hover {
	color: var(--text-color);
}

.jobs-stats,
.kanban-stats,
.tasks-stats,
.contacts-stats {
	display: flex;
	background: var(--gray-100);
	border-radius: 6px;
	padding: 2px;
}

.jobs-stats .stat-item,
.kanban-stats .kanban-total-jobs,
.tasks-stats .tasks-total-count,
.contacts-stats .contacts-count {
	padding: 6px 16px;
	background: transparent;
	border: none;
	border-radius: 4px;
	color: var(--gray-600);
	font-size: 14px;
	font-weight: 500;
	cursor: pointer;
	transition: var(--transition-fast);
	display: flex;
	align-items: center;
	gap: 2px;
	white-space: nowrap;
}

.jobs-stats .stat-item:hover,
.kanban-stats .kanban-total-jobs:hover,
.tasks-stats .tasks-total-count:hover,
.contacts-stats .contacts-count:hover {
	color: var(--text-color);
}

.jobs-stats .stat-item.active,
.kanban-stats .kanban-total-jobs.active,
.tasks-stats .tasks-total-count.active,
.contacts-stats .contacts-count.active {
	background: var(--white);
	color: var(--text-color);
	box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

/* Responsive headers */
@media (max-width: 768px) {
	.tab-header,
	.jobs-header {
		flex-direction: column;
		align-items: stretch;
		gap: var(--space-3);
	}

	.tab-title,
	.jobs-title {
		text-align: center;
	}

	.jobs-container {
		padding: 16px;
	}

	.jobs-stats,
	.kanban-stats,
	.tasks-stats,
	.contacts-stats,
	.tab-stats {
		flex-wrap: wrap;
	}
}

@media (max-width: 480px) {
	.jobs-stats .stat-item,
	.kanban-stats .kanban-total-jobs,
	.tasks-stats .tasks-total-count,
	.contacts-stats .contacts-count,
	.tab-stats .stat-item {
		padding: 4px 8px;
		font-size: 12px;
	}
}

/* ============================================================================ */
/* CUSTOM DIALOG SYSTEM */
/* ============================================================================ */

/* Dialog specific modal overlay with higher z-index */
.modal-overlay.custom-dialog {
	z-index: 10000; /* Higher than regular modals */
	background-color: rgba(0, 0, 0, 0.6); /* Slightly darker backdrop */
	animation: fadeIn 0.15s ease-out;
}

@keyframes fadeIn {
	from {
		opacity: 0;
	}
	to {
		opacity: 1;
	}
}

/* Dialog modal styling */
.custom-dialog-modal {
	max-width: 400px;
	width: 90%;
	transition: opacity 0.15s ease-out, transform 0.15s ease-out;
	will-change: opacity, transform;
}

/* Dialog body spacing */
.custom-dialog-body {
	padding: var(--space-4);
	text-align: center;
}

/* Dialog message styling */
.dialog-message {
	margin-bottom: var(--space-4);
	font-size: var(--font-size-base);
	line-height: 1.5;
	color: var(--text-color);
}

/* Dialog input container */
.dialog-input-container {
	margin-top: var(--space-4);
	margin-bottom: var(--space-2);
}

/* Dialog input field */
.dialog-input {
	width: 100%;
	padding: var(--space-3);
	border: var(--border-width) solid var(--border-color);
	border-radius: var(--border-radius);
	font-size: var(--font-size-base);
	background: var(--white);
	color: var(--text-color);
	box-sizing: border-box;
}

.dialog-input:focus {
	outline: none;
	border-color: var(--primary-color);
	box-shadow: 0 0 0 3px var(--primary-bg);
}

/* Dialog footer - GitHub style */
.dialog-footer {
	display: flex;
	justify-content: flex-end;
	gap: var(--space-2);
	padding: var(--space-4);
	border-top: var(--border-width) solid var(--border-color);
	background: var(--gray-50);
}

/* Dialog buttons inherit the same styling as main app buttons */
.custom-dialog .action-btn {
	min-height: 32px;
	padding: 5px 16px;
	font-size: var(--font-size-sm);
	font-weight: 500;
}

/* Dialog type specific styling - Keep headers neutral like GitHub */
.custom-dialog-modal .modal-header {
	background: var(--white);
	color: var(--text-color);
	border-bottom: var(--border-width) solid var(--border-color);
}

/* Dialog icons (optional - can be added later) */
.dialog-icon {
	display: inline-block;
	width: 24px;
	height: 24px;
	margin-right: var(--space-2);
	vertical-align: middle;
}

/* Responsive dialog */
@media (max-width: 480px) {
	.custom-dialog-modal {
		max-width: 95%;
		margin: var(--space-4);
	}

	.dialog-footer {
		flex-direction: column;
	}

	.dialog-footer .action-btn {
		width: 100%;
		justify-content: center;
	}
}


/* ============================================================================ */
/* SRC/STYLES/TABLE.CSS */
/* ============================================================================ */

/* ============================================================================ */
/* TABLE STYLES - TABLE LAYOUT, INLINE EDITING, AND DATA DISPLAY */
/* ============================================================================ */

/* ============================================================================ */
/* TABLE STRUCTURE */
/* ============================================================================ */

table {
	width: 100%;
	border-collapse: separate;
	border-spacing: 0;
	font-size: 14px;
	line-height: 1.45;
	table-layout: fixed;
}

th {
	background: var(--gray-50);
	position: sticky;
	top: 0;
	z-index: 100;
	padding: 8px 16px;
	text-align: left;
	font-weight: 600;
	border-bottom: var(--border-width) solid var(--border-color);
	white-space: nowrap;
	color: var(--text-color);
	text-transform: none;
	letter-spacing: normal;
	font-size: 12px;
}

td {
	padding: 8px 16px;
	border-bottom: var(--border-width) solid var(--border-light);
	vertical-align: middle;
	background: var(--white);
	font-weight: 400;
	color: var(--text-color);
	font-size: 14px;
	height: 64px;
	max-height: 64px;
	box-sizing: border-box;
	overflow: hidden;
}

tr {
	transition: var(--transition-fast);
}

tr:hover td {
	background-color: var(--gray-50);
}

tbody tr {
	transition: background-color 0.1s ease;
}

/* ============================================================================ */
/* TABLE CELL TYPES */
/* ============================================================================ */

.priority-cell {
	text-align: left;
	width: 60px;
	padding: 8px 16px;
	white-space: nowrap;
}

.company-name {
	font-weight: var(--font-weight-medium);
	color: var(--text-color);
	white-space: nowrap;
	overflow: visible;
	width: 200px;
}

#companyHeader,
#positionHeader {
	width: 200px;
}

.position-name {
	font-weight: var(--font-weight-medium);
	white-space: nowrap;
	overflow: visible;
	width: 200px;
}

.current-phase {
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
	max-width: 120px;
}

.phase-display {
	display: flex;
	flex-direction: column;
	gap: var(--space-1);
}

.phase-main {
	font-weight: 600;
	color: var(--text-primary);
}

.phase-substep {
	font-size: var(--font-size-xs);
	color: var(--text-secondary);
	opacity: 0.8;
}

.salary {
	color: var(--text-color);
	font-weight: 400;
	max-width: 120px;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
	font-size: 14px;
}

.location {
	color: var(--text-light);
	font-size: 14px;
	max-width: 120px;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
}

.contact {
	text-align: center;
	width: var(--col-8);
}

.notes {
	text-align: center;
	width: var(--col-8);
}

.tasks {
	text-align: center;
	width: var(--col-8);
}

.actions-cell {
	text-align: center;
	width: var(--col-16);
	padding: var(--space-2);
}

.source-url {
	text-align: center;
	width: var(--col-6);
	padding: var(--space-2);
}

/* Source URL link styling - like action buttons */
.source-link {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	width: 24px;
	height: 24px;
	border-radius: 6px;
	background: transparent;
	color: var(--gray-500);
	text-decoration: none;
	transition: var(--transition-fast);
	border: 1px solid transparent;
}

.source-link:hover {
	background: var(--blue-50);
	color: var(--blue-600);
}

.source-link .material-symbols-outlined {
	font-size: 16px;
	font-weight: 400;
}

/* ============================================================================ */
/* INLINE EDITING */
/* ============================================================================ */

/* Row in editing mode */
tr.editing {
	background-color: var(--primary-bg) !important;
	box-shadow: 0 0 0 var(--border-width-thick) var(--primary-light);
}

tr.editing td {
	background-color: transparent;
	padding: 0;
	height: 64px;
}

/* Phase cell for editing */
.phase-cell {
	height: 64px;
	max-height: 64px;
	padding: 0;
	overflow: hidden;
	box-sizing: border-box;
}

.phase-cell .inline-edit {
	height: 30px;
	padding: 4px 8px;
	border: none;
	border-radius: 0;
	font-size: var(--font-size-xs);
	margin: 0;
	box-sizing: border-box;
	width: 100%;
	background: transparent;
	color: var(--text-color);
	display: block;
}

.phase-cell .inline-edit:first-child {
	border-bottom: 1px solid var(--border-light);
}

.phase-cell .inline-edit:focus {
	outline: 2px solid var(--primary-color);
	outline-offset: -2px;
}

/* General inline edit styling */
.inline-edit {
	width: 100%;
	padding: 12px;
	border: none;
	border-radius: 0;
	font-size: var(--font-size-xs);
	background: transparent;
	color: var(--text-color);
	transition: var(--transition-fast);
	height: 64px;
	box-sizing: border-box;
}

.inline-edit:focus {
	outline: 2px solid var(--primary-color);
	outline-offset: -2px;
}

/* Priority select specific styling */
.priority-select {
	text-align: center;
	width: 100%;
	height: 64px;
	padding: 12px;
	border: none;
	border-radius: 0;
	font-size: var(--font-size-xs);
	background: transparent;
	color: var(--text-color);
	box-sizing: border-box;
}

.priority-select:focus {
	outline: 2px solid var(--primary-color);
	outline-offset: -2px;
}

/* Actions cell in edit mode */
tr.editing .actions-cell {
	display: flex;
	gap: var(--space-1);
	align-items: center;
	justify-content: center;
	padding: var(--space-1);
}

tr.editing .actions-cell button {
	min-width: var(--action-btn-size);
	height: var(--action-btn-size);
	padding: 0;
	border-radius: var(--radius-sm);
	display: flex;
	align-items: center;
	justify-content: center;
}

/* ============================================================================ */
/* CONTACT, NOTES, AND TASKS DISPLAY */
/* ============================================================================ */

/* Legacy contact form grid (keep for backward compatibility) */
.contact-form {
	display: grid;
	grid-template-columns: 1fr 1fr;
	gap: var(--space-2);
	margin-bottom: var(--space-3);
}

.contact-form input {
	padding: var(--space-2);
	border: var(--border-width) solid var(--border-color);
	border-radius: var(--radius-sm);
	font-size: var(--font-size-sm);
}

/* Unified table layouts - GitHub style */
.notes-table,
.tasks-table,
.contacts-table {
	width: 100%;
	border-collapse: separate;
	border-spacing: 0;
	margin-bottom: 16px;
	background: var(--white);
	border: 1px solid var(--border-color);
	border-radius: 8px;
	overflow: hidden;
	font-size: var(--font-size-xs);
}

.notes-table th,
.tasks-table th,
.contacts-table th {
	background: var(--gray-50);
	padding: 8px 12px;
	text-align: left;
	font-weight: 600;
	font-size: var(--font-size-xs);
	color: var(--gray-700);
	border-bottom: 1px solid var(--border-color);
	position: sticky;
	top: 0;
	white-space: nowrap;
}

.notes-table td,
.tasks-table td,
.contacts-table td {
	padding: 8px 12px;
	border-bottom: 1px solid var(--border-light);
	vertical-align: middle;
	background: var(--white);
	font-size: var(--font-size-xs);
	height: 44px;
}

.notes-table tr:last-child td,
.tasks-table tr:last-child td,
.contacts-table tr:last-child td {
	border-bottom: none;
}

.notes-table tr:hover,
.tasks-table tr:hover,
.contacts-table tr:hover {
	background: var(--background-color);
}

/* Ensure all notes table cells have consistent height behavior */
.notes-table td {
	vertical-align: top;
	height: auto;
	min-height: 44px;
}

.notes-table .note-text-cell {
	word-wrap: break-word;
	white-space: normal;
	max-width: 300px;
	line-height: 1.4;
}

/* Fixed column widths for notes table */
.notes-table th:nth-child(1),
.notes-table td:nth-child(1) {
	width: 100px;
	min-width: 100px;
	max-width: 100px;
}

.notes-table th:nth-child(2),
.notes-table td:nth-child(2) {
	width: 100px;
	min-width: 100px;
	max-width: 100px;
}

.notes-table th:nth-child(3),
.notes-table td:nth-child(3) {
	width: auto;
	min-width: 200px;
}

.notes-table th:nth-child(4),
.notes-table td:nth-child(4) {
	width: 80px;
	min-width: 80px;
	max-width: 80px;
}

/* Prevent line breaking in specific columns */
.notes-table td:nth-child(2),
.tasks-table td:nth-child(2) {
	white-space: nowrap;
	width: 120px;
}

.notes-table td:nth-child(4),
.tasks-table td:nth-child(4) {
	white-space: nowrap;
	width: 80px;
}

.notes-table-actions,
.tasks-table-actions,
.contacts-table-actions {
	white-space: nowrap;
	width: auto;
	min-width: fit-content;
	display: flex;
	align-items: center;
	gap: 4px;
	justify-content: center;
	flex-wrap: nowrap;
	height: 100%;
	vertical-align: top;
}

.notes-table-actions .action-btn,
.tasks-table-actions .action-btn,
.contacts-table-actions .action-btn {
	flex-shrink: 0;
	min-width: 24px;
	width: 24px;
	height: 24px;
}

/* Task two-row layout - GitHub style */
.tasks-table .task-info-row {
	height: 32px;
}

.tasks-table .task-info-row td {
	height: 32px;
	padding: 4px 8px;
	border-bottom: none;
}

.tasks-table .task-text-row {
	border-top: none;
}

.tasks-table .task-text-row td {
	height: 32px;
	padding: 4px 8px;
	border-bottom: 1px solid var(--border-light);
	color: var(--gray-600);
	font-size: 13px;
	font-style: italic;
}

/* Task status/priority badges - GitHub style */
.task-status-display,
.task-priority-display {
	display: inline-block;
	padding: 2px 8px;
	border-radius: 12px;
	font-size: var(--font-size-xs);
	font-weight: 500;
	border: none;
	cursor: default;
	min-width: 60px;
	text-align: center;
}

/* Fixed column widths to prevent shifting during edit mode */
.tasks-table th:nth-child(1),
.tasks-table td:nth-child(1) {
	width: 80px;
	min-width: 80px;
	max-width: 80px;
}

.tasks-table th:nth-child(2),
.tasks-table td:nth-child(2) {
	width: 80px;
	min-width: 80px;
	max-width: 80px;
}

.tasks-table th:nth-child(3),
.tasks-table td:nth-child(3) {
	width: 100px;
	min-width: 100px;
	max-width: 100px;
}

.tasks-table th:nth-child(4),
.tasks-table td:nth-child(4) {
	width: 80px;
	min-width: 80px;
	max-width: 80px;
}

.tasks-table th:nth-child(5),
.tasks-table td:nth-child(5) {
	width: 80px;
	min-width: 80px;
	max-width: 80px;
}

.task-status-display {
	background: var(--gray-100);
	color: var(--gray-700);
}

.task-priority-display {
	background: var(--gray-100);
	color: var(--gray-700);
}

.task-status-display.status-done {
	background: var(--green-100);
	color: var(--green-700);
}

.task-status-display.status-in-progress {
	background: var(--blue-100);
	color: var(--blue-700);
}

.task-priority-display.priority-high {
	background: var(--red-100);
	color: var(--red-700);
}

.task-priority-display.priority-medium {
	background: var(--orange-100);
	color: var(--orange-700);
}

.task-priority-display.priority-low {
	background: var(--green-100);
	color: var(--green-700);
}

/* Task date and duration styling */
.task-due-date-display,
.task-duration-display {
	font-family: inherit;
	font-size: 14px;
	color: var(--text-color);
}

/* Task text row styling */
.task-text-row {
	border-top: none;
}

.task-text-row td {
	padding-top: 4px;
	padding-bottom: 12px;
	border-bottom: var(--border-width) solid var(--border-light);
	font-style: italic;
	color: var(--gray-600);
}

.task-info-row + .task-text-row td {
	border-top: none;
}

/* Excel-like inline editing for tasks and notes tables */
.notes-table tr.editing,
.tasks-table tr.editing {
	background-color: var(--blue-50) !important;
}

.notes-table tr.editing td,
.tasks-table tr.editing td {
	background-color: transparent;
	padding: 0;
}

.notes-table .inline-edit,
.tasks-table .inline-edit {
	width: 100%;
	padding: 8px 12px;
	border: none;
	border-radius: 0;
	font-size: 14px;
	background: transparent;
	color: var(--text-color);
	transition: var(--transition-fast);
	height: 32px;
	min-height: 32px;
	box-sizing: border-box;
}

/* Ensure edit inputs maintain column widths */
.tasks-table .task-status-edit,
.tasks-table .task-priority-edit,
.tasks-table .task-due-date-edit,
.tasks-table .task-duration-edit {
	width: 100%;
	padding: 4px 8px;
	border: none;
	border-radius: 0;
	background: transparent;
	font-size: 14px;
	box-sizing: border-box;
	height: 32px;
}

.contacts-table .inline-edit-input {
	width: 100%;
	padding: 8px 12px;
	border: none;
	border-radius: 0;
	font-size: 14px;
	background: transparent;
	color: var(--text-color);
	transition: var(--transition-fast);
	height: 44px;
	box-sizing: border-box;
}

.notes-table .inline-edit:focus,
.tasks-table .inline-edit:focus {
	outline: 2px solid var(--blue-500);
	outline-offset: -2px;
	background: var(--white);
}

/* Task select styling for 32px minimum height */
.tasks-table select.inline-edit {
	appearance: none;
	background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
	background-position: right 8px center;
	background-repeat: no-repeat;
	background-size: 16px;
	padding-right: 32px;
	cursor: pointer;
}

/* Notes textarea specific styling */
.notes-table textarea.inline-edit {
	resize: vertical;
	height: auto;
	min-height: 44px;
	line-height: 1.4;
	overflow: hidden;
	rows: 2;
}

/* Task description textarea in second row */
.tasks-table .task-text-row textarea.inline-edit,
.tasks-table .task-text-edit {
	height: auto;
	min-height: 44px;
	font-style: italic;
	color: var(--gray-600);
	padding: 8px;
	rows: 2;
	line-height: 1.4;
	resize: vertical;
}

/* Contacts table specific styles */
.contacts-table td a {
	color: var(--text-color);
}

/* Contacts table inline editing */
.contacts-table .editable-cell {
	cursor: pointer;
	transition: background-color 0.15s ease;
}

.contacts-table .editable-cell:hover {
	background: var(--gray-50);
}

.contacts-table tr.editing {
	background-color: var(--blue-50) !important;
}

.contacts-table tr.editing td {
	background-color: transparent;
	padding: 0;
}

.contacts-table .inline-edit-input {
	width: 100%;
	padding: 8px 12px;
	border: none;
	border-radius: 0;
	font-size: 14px;
	background: transparent;
	color: var(--text-color);
	transition: var(--transition-fast);
	height: 44px;
	box-sizing: border-box;
	box-shadow: none;
}

.contacts-table .inline-edit-input:focus {
	outline: 2px solid var(--blue-500);
	outline-offset: -2px;
	background: var(--white);
}

.contacts-table .contact-name {
	font-weight: 500;
	color: var(--text-color);
}

.contacts-table .contact-link {
	color: var(--blue-600);
	text-decoration: none;
}

.contacts-table .contact-link:hover {
	text-decoration: underline;
}

.contacts-table .contact-phone {
	font-family: var(--font-mono, monospace);
}

.contacts-table .contact-company {
	color: var(--gray-600);
	font-style: italic;
}

/* Fixed column widths for contacts table */
.contacts-table th:nth-child(1),
.contacts-table td:nth-child(1) {
	width: 180px;
	min-width: 180px;
	max-width: 180px;
}

.contacts-table th:nth-child(2),
.contacts-table td:nth-child(2) {
	width: 180px;
	min-width: 180px;
	max-width: 180px;
}

.contacts-table th:nth-child(3),
.contacts-table td:nth-child(3) {
	width: 140px;
	min-width: 140px;
	max-width: 140px;
}

.contacts-table th:nth-child(4),
.contacts-table td:nth-child(4) {
	width: 140px;
	min-width: 140px;
	max-width: 140px;
}

.contacts-table th:nth-child(5),
.contacts-table td:nth-child(5) {
	width: 80px;
	min-width: 80px;
	max-width: 80px;
}

/* Archived contacts section */
.archived-contacts-section {
	margin-top: 16px;
}

.contacts-archived-header {
	display: flex;
	align-items: center;
	gap: 8px;
	margin: 0 0 8px 0;
	font-size: 14px;
	font-weight: 600;
	color: var(--gray-600);
	cursor: pointer;
	padding: 8px;
	border-radius: 6px;
	transition: background-color 0.15s ease;
}

.contacts-archived-header:hover {
	background: var(--gray-50);
}

.contacts-archived-header .expand-icon {
	font-size: 16px;
	color: var(--gray-500);
}

/* ============================================================================ */
/* RESPONSIVE TABLE */
/* ============================================================================ */

@media (max-width: 1024px) {
	table {
		font-size: var(--font-size-xs);
	}

	th,
	td {
		padding: var(--space-2) var(--space-1);
	}

	.current-phase {
		max-width: var(--col-12);
	}
}

@media (max-width: 768px) {
	.table-container {
		max-height: 60vh;
	}

	th,
	td {
		padding: var(--space-1);
	}

	.current-phase {
		max-width: var(--col-10);
	}

	.salary,
	.location {
		font-size: var(--font-size-2xs);
	}
}

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="appTitle">...</h1>
            <div class="language-switcher-container">
                <div id="languageSwitcher"></div>
            </div>
        </div>
        
        <!-- Tab Navigation -->
        <div id="tabNavigation"></div>
        
        <!-- Tab Content Area -->
        <div class="tab-content-container">
            <!-- Jobs Tab -->
            <div class="tab-content active" data-tab="jobs">
                <div class="jobs-container">
                    <!-- Jobs header -->
                    <div class="jobs-header">
                        <h2 class="jobs-title" id="jobsTitle">...</h2>
                        <div class="jobs-stats">
                            <div class="stat-item">
                                <div class="stat-number" id="totalApps">0</div>
                                <div class="stat-label" id="totalAppsLabel">...</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="activeApps">0</div>
                                <div class="stat-label" id="activeAppsLabel">...</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="interviews">0</div>
                                <div class="stat-label" id="interviewsLabel">...</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="offers">0</div>
                                <div class="stat-label" id="offersLabel">...</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="rejections">0</div>
                                <div class="stat-label" id="rejectionsLabel">...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="jobTable">
                            <thead>
                                <tr>
                                    <th>
                                        <div class="header-with-filter">
                                            <span id="priorityHeader">...</span>
                                            <span class="filter-dropdown-icon" onclick="toggleDropdown('priorityDropdown')">
                                                <span class="material-symbols-outlined">expand_more</span>
                                            </span>
                                            <div class="filter-dropdown" id="priorityDropdown"></div>
                                        </div>
                                    </th>
                                    <th id="companyHeader">...</th>
                                    <th id="positionHeader">...</th>
                                    <th>
                                        <div class="header-with-filter">
                                            <span id="currentPhaseHeader">...</span>
                                            <span class="filter-dropdown-icon" onclick="toggleDropdown('phaseDropdown')">
                                                <span class="material-symbols-outlined">expand_more</span>
                                            </span>
                                            <div class="filter-dropdown" id="phaseDropdown"></div>
                                        </div>
                                    </th>
                                    <th id="salaryRangeHeader">...</th>
                                    <th id="locationHeader">...</th>
                                    <th id="sourceUrlHeader">...</th>
                                    <th id="contactsHeader">...</th>
                                    <th id="notesHeader">...</th>
                                    <th id="tasksHeader">...</th>
                                    <th id="actionsHeader">...</th>
                                </tr>
                            </thead>
                            <tbody id="jobTableBody">
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="table-actions">
                        <button id="addAppBtn" onclick="addRow()">...</button>
                    </div>
                </div>
            </div>
            
            <!-- Applications Board Tab -->
            <div class="tab-content" data-tab="applications">
                <!-- Content will be dynamically generated -->
            </div>
            
            <!-- Tasks Board Tab -->
            <div class="tab-content" data-tab="tasks">
                <!-- Content will be dynamically generated -->
            </div>
            
            <!-- Calendar View Tab -->
            <div class="tab-content" data-tab="calendar">
                <!-- Content will be dynamically generated -->
            </div>
            
            <!-- Contacts View Tab -->
            <div class="tab-content" data-tab="contacts">
                <!-- Content will be dynamically generated -->
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <p class="footer-text">
                <span id="footerMadeWith">Made with</span> 
                <span class="heart">â¤ï¸</span> 
                <span id="footerBy">by</span> 
                <a href="https://github.com/letanure" target="_blank" rel="noopener noreferrer" class="author-link">letanure</a>
            </p>
            <a href="https://github.com/letanure/JobTracker" target="_blank" rel="noopener noreferrer" class="github-link">
                <svg class="github-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
                <span class="github-text">View on GitHub</span>
            </a>
        </div>
    </footer>

    
    <script>
// Build version for cache busting
window.BUILD_VERSION = '1750697896123';
window.BUILD_DATE = '2025-06-23T16:58:16.123Z';

// ============================================================================
// JobTracker - Built from modular source files
// Generated: 2025-06-23T16:58:16.117Z
// ============================================================================

// Show build info in console
console.log("JobTracker - Built at: 2025-06-23T16:58:16.117Z");


// ============================================================================
// SRC/LIB/DOM.JS
// ============================================================================

// ============================================================================
// MINI DOM UTILITY LIBRARY (jQuery-style)
// ============================================================================

// jQuery-style DOM wrapper class
class DOMElement {
	constructor(element) {
		this.element = element;
	}

	// Chainable text method
	text(content) {
		if (content === undefined) {
			return this.element.textContent;
		}
		this.element.textContent = content;
		return this;
	}

	// Chainable html method
	html(content) {
		if (content === undefined) {
			return this.element.innerHTML;
		}
		this.element.innerHTML = content;
		return this;
	}

	// Chainable show/hide methods
	show() {
		this.element.style.display = "block";
		return this;
	}

	hide() {
		this.element.style.display = "none";
		return this;
	}

	toggle() {
		const isVisible = this.element.style.display === "block";
		this.element.style.display = isVisible ? "none" : "block";
		return this;
	}

	// Chainable event method
	on(event, handler) {
		this.element.addEventListener(event, handler);
		return this;
	}

	// Chainable addClass/removeClass
	addClass(className) {
		this.element.classList.add(className);
		return this;
	}

	removeClass(className) {
		this.element.classList.remove(className);
		return this;
	}

	// Chainable attr method
	attr(name, value) {
		if (value === undefined) {
			return this.element.getAttribute(name);
		}
		this.element.setAttribute(name, value);
		return this;
	}

	// Chainable css method
	css(property, value) {
		if (typeof property === "object") {
			Object.assign(this.element.style, property);
		} else if (value === undefined) {
			return getComputedStyle(this.element)[property];
		} else {
			this.element.style[property] = value;
		}
		return this;
	}

	// Append child
	append(child) {
		if (typeof child === "string") {
			this.element.appendChild(document.createTextNode(child));
		} else {
			this.element.appendChild(child);
		}
		return this;
	}

	// Get the raw DOM element
	get() {
		return this.element;
	}
}

// Enhanced $ function with jQuery-style API
const $ = (selector) => {
	if (typeof selector === "string") {
		if (selector.startsWith("#")) {
			// ID selector
			const element = document.getElementById(selector.slice(1));
			return element ? new DOMElement(element) : null;
		}
		// CSS selector
		const element = document.querySelector(selector);
		return element ? new DOMElement(element) : null;
	}
	if (selector instanceof Element) {
		// Wrap existing element
		return new DOMElement(selector);
	}
	return null;
};

// Static methods for backwards compatibility and utility
Object.assign($, {
	// Get element by ID (returns raw element)
	id: (id) => document.getElementById(id),

	// Query selector (single element)
	qs: (selector) => document.querySelector(selector),

	// Query selector all (multiple elements)
	qsa: (selector) => document.querySelectorAll(selector),

	// Create element with optional class and text
	create: (tag, className, textContent) => {
		const element = document.createElement(tag);
		if (className) element.className = className;
		if (textContent) element.textContent = textContent;
		return element;
	},

	// Add event listener (static)
	on: (element, event, handler) => element.addEventListener(event, handler),
	// Set innerHTML (static)
	html: (element, html) => {
		element.innerHTML = html;
	},

	// Set textContent (static)
	text: (element, text) => {
		element.textContent = text;
	},
	// Show/hide element (static)
	show: (element) => {
		element.style.display = "block";
	},
	hide: (element) => {
		element.style.display = "none";
	},

	// Toggle display (static)
	toggle: (element) => {
		const isVisible = element.style.display === "block";
		element.style.display = isVisible ? "none" : "block";
	},
});

// React-like h function for creating elements
const h = (tag, props = {}, ...children) => {
	const element = document.createElement(tag);

	// Set properties
	for (const [key, value] of Object.entries(props)) {
		if (key === "className") {
			element.className = value;
		} else if (key === "style" && typeof value === "object") {
			Object.assign(element.style, value);
		} else if (key === "innerHTML") {
			element.innerHTML = value;
		} else if (key === "textContent") {
			element.textContent = value;
		} else if (key.startsWith("on") && typeof value === "function") {
			const eventType = key.slice(2).toLowerCase();
			element.addEventListener(eventType, value);
		} else if (key.startsWith("data-")) {
			element.setAttribute(key, value);
		} else {
			element.setAttribute(key, value);
		}
	}

	// Add children
	for (const child of children) {
		if (child !== null && child !== undefined) {
			if (typeof child === "string" || typeof child === "number") {
				element.appendChild(document.createTextNode(child.toString()));
			} else if (child instanceof Node) {
				element.appendChild(child);
			}
		}
	}

	return element;
};


// ============================================================================
// SRC/LIB/STORAGE.JS
// ============================================================================

// ============================================================================
// MINI DATA PERSISTENCE LIBRARY
// ============================================================================

const DataStore = {
	// Storage key for job tracker data
	STORAGE_KEY: "jobTrackerData",

	// Save data to storage
	save: (data) => {
		try {
			localStorage.setItem(DataStore.STORAGE_KEY, JSON.stringify(data));
			return true;
		} catch (error) {
			console.error("Error saving data:", error);
			return false;
		}
	},

	// Load data from storage
	load: () => {
		try {
			const savedData = localStorage.getItem(DataStore.STORAGE_KEY);
			return savedData ? JSON.parse(savedData) : null;
		} catch (error) {
			console.error("Error loading data:", error);
			return null;
		}
	},

	// Check if data exists in storage
	exists: () => {
		return localStorage.getItem(DataStore.STORAGE_KEY) !== null;
	},

	// Clear all data from storage
	clear: () => {
		try {
			localStorage.removeItem(DataStore.STORAGE_KEY);
			return true;
		} catch (error) {
			console.error("Error clearing data:", error);
			return false;
		}
	},
};


// ============================================================================
// SRC/LIB/I18N/EN.JS
// ============================================================================

// ============================================================================
// ENGLISH TRANSLATIONS
// ============================================================================

const EN_TRANSLATIONS = {
	app: {
		title: "JobTracker",
	},
	buttons: {
		addApplication: "+ Add Application",
	},
	tabs: {
		jobs: "Jobs",
		applications: "Applications Board",
		tasks: "Tasks Board",
		calendar: "Calendar",
		contacts: "Contacts",
		profile: "Profile",
	},
	headers: {
		jobs: "Job Applications",
		applications: "Applications Board",
		tasks: "Tasks Board",
		calendar: "Calendar View",
		contacts: "All Contacts",
	},
	kanban: {
		title: "Applications Board",
		totalJobs: "{count} total applications",
		editJob: "Edit Job",
		addJob: "Add Job",
	},
	table: {
		headers: {
			priority: "Priority",
			company: "Company",
			position: "Position",
			currentPhase: "Stage",
			substep: "Substep",
			salaryRange: "Salary Range",
			location: "Location",
			sourceUrl: "Source",
			contacts: "Contacts",
			notes: "Notes",
			tasks: "Tasks",
			actions: "Actions",
		},
		filters: {
			allPriorities: "All Priorities",
			allPhases: "All Phases",
		},
		placeholders: {
			company: "Company Name",
			position: "Position Title",

			salaryRange: "Salary Range",
			location: "Location",
			sourceUrl: "Job Posting URL",
		},
	},
	priorities: {
		high: "High",
		medium: "Medium",
		low: "Low",
	},
	phases: {
		wishlist: "Wishlist",
		applied: "Applied",
		interview: "Interview",
		offer: "Offer",
		rejected_withdrawn: "Rejected / Withdrawn",
	},
	substeps: {
		none: "No substep",
		wishlist: "Wishlist",
		applied: "Applied",
		interview: "Interview",
		offer: "Offer",
		rejected_withdrawn: "Rejected / Withdrawn",
		application_review: "Application Review",
		initial_screening: "Initial Screening",
		hr_phone_screen: "HR Phone Screen",
		recruiter_call: "Recruiter Call",
		phone_screening: "Phone Screening",
		technical_phone_screen: "Technical Phone Screen",
		coding_challenge: "Coding Challenge",
		take_home_assignment: "Take-home Assignment",
		technical_interview: "Technical Interview",
		system_design_interview: "System Design Interview",
		behavioral_interview: "Behavioral Interview",
		team_interview: "Team Interview",
		hiring_manager_interview: "Hiring Manager Interview",
		panel_interview: "Panel Interview",
		final_round: "Final Round",
		reference_check: "Reference Check",
		background_check: "Background Check",
		offer_discussion: "Offer Discussion",
		salary_negotiation: "Salary Negotiation",
	},
	stats: {
		totalApplications: "Total Applications",
		active: "Active",
		interviews: "Interviews",
		offers: "Offers",
		rejections: "Rejections",
	},
	messages: {
		welcome:
			"Welcome to JobTracker!\n\nWould you like to see 2 example job applications to understand how the tracker works?",
		welcomeConfirm: "Yes, add examples",
		welcomeCancel: "No, leave empty",
		confirmDelete: "Are you sure you want to delete the application for {position} at {company}?",
	},
	demo: {
		notes1: "Great culture fit. Need to research their microservices architecture.",
		notes2: "Early stage startup. High growth potential but risky.",
	},
	seo: {
		title: "JobTracker - Free Local Job Tracker | No Login, No Tracking, Your Data Stays Private",
		description:
			"100% free job application tracker that works locally in your browser. No login required, no data tracking, no servers. Your job search data stays completely private on your device.",
		keywords:
			"free job tracker, local job application tracker, private job search, no login job tracker, offline job tracker, privacy-first job applications, no tracking career management, local storage job search",
		author: "JobTracker Team",
		ogTitle: "JobTracker - Free Local Job Tracker (No Login Required)",
		ogDescription:
			"Track job applications privately in your browser. 100% free, no login, no tracking, your data never leaves your device.",
		twitterTitle: "JobTracker - Private Job Application Tracker",
		twitterDescription:
			"Free local job tracker with complete privacy. No login, no tracking, your job search data stays on your device.",
	},
	modals: {
		notes: {
			title: "Notes for {position} at {company}",
			activeSection: "Active Notes",
			archivedSection: "Archived Notes ({count})",
			emptyState: "No notes yet. Add your first note below.",
			addSection: "Add New Note",
			placeholder: "Enter your note here...",
			editTitle: "Edit note",
			archiveTitle: "Archive note",
			unarchiveTitle: "Unarchive note",
			addButton: "Add Note",
		},
		tasks: {
			title: "Tasks for {position} at {company}",
			activeSection: "Active Tasks",
			archivedSection: "Archived Tasks ({count})",
			emptyState: "No tasks yet. Add your first task below.",
			addSection: "Add New Task",
			placeholder: "Enter your task here...",
			editTitle: "Edit task",
			archiveTitle: "Archive task",
			unarchiveTitle: "Unarchive task",
			addButton: "Add Task",
			status: "Status",
			priority: "Priority",
			dueDate: "Due Date",
			duration: "Duration",
			statusTodo: "To Do",
			statusInProgress: "In Progress",
			statusDone: "Done",
			priorityLow: "Low",
			priorityMedium: "Medium",
			priorityHigh: "High",
		},
		contacts: {
			title: "Contacts for {position} at {company}",
			activeSection: "Active Contacts",
			archivedSection: "Archived Contacts ({count})",
			emptyState: "No contacts yet. Add your first contact below.",
			addSection: "Add New Contact",
			editTitle: "Edit contact",
			archiveTitle: "Archive contact",
			unarchiveTitle: "Unarchive contact",
			addButton: "Add Contact",
			placeholderName: "Name",
			placeholderEmail: "Email",
			placeholderPhone: "Phone",
			placeholderCompany: "Company",
			noContacts: "No contacts",
			defaultContact: "Contact",
			validation: {
				nameRequired: "Name is required",
				emailRequired: "Email is required",
			},
		},
		common: {
			save: "Save",
			cancel: "Cancel",
			close: "Close",
			ok: "OK",
			yes: "Yes",
			no: "No",
		},
		dialogs: {
			alert: "Alert",
			confirm: "Confirm",
			prompt: "Input Required",
		},
	},
	forms: {
		saveChangesTitle: "Save changes",
		cancelEditingTitle: "Cancel editing",
		noDueDate: "No due date",
		placeholderNameEmail: "Name\nEmail",
	},
	footer: {
		madeWith: "Made with",
		by: "by",
	},
	calendar: {
		title: "Calendar View",
		today: "Today",
		month: "Month",
		week: "Week",
		day: "Day",
		previous: "Previous",
		next: "Next",
		noEvents: "No events scheduled",
		events: "events",
		applied: "Applied",
		task: "Task",
		interview: "Interview",
		followUp: "Follow-up",
		months: [
			"January",
			"February",
			"March",
			"April",
			"May",
			"June",
			"July",
			"August",
			"September",
			"October",
			"November",
			"December",
		],
		weekdays: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
		weekdaysFull: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
	},
	contactsView: {
		title: "All Contacts",
		totalContacts: "{count} total contacts",
		emptyState: "No contacts found. Add contacts to your jobs to see them here.",
		nameHeader: "Name",
		emailHeader: "Email",
		phoneHeader: "Phone",
		roleHeader: "Role",
		companyHeader: "Company",
		jobHeader: "Position",
		actionsHeader: "Actions",
		namePlaceholder: "Contact name",
		emailPlaceholder: "email@example.com",
		phonePlaceholder: "+1 (555) 123-4567",
		rolePlaceholder: "Role/Title",
		addContact: "Add Contact",
		addContactTitle: "Add New Contact",
		selectJob: "Select a job...",
		noJobsAvailable: "No jobs available. Please create a job first.",
		deleteTitle: "Delete contact",
		deleteConfirmation: "Are you sure you want to delete {name}?",
		validation: {
			nameRequired: "Name is required",
			jobRequired: "Please select a job",
		},
	},
};


// ============================================================================
// SRC/LIB/I18N/PT.JS
// ============================================================================

// ============================================================================
// PORTUGUESE TRANSLATIONS
// ============================================================================

const PT_TRANSLATIONS = {
	app: {
		title: "JobTracker",
	},
	buttons: {
		addApplication: "+ Adicionar Candidatura",
	},
	tabs: {
		jobs: "Empregos",
		applications: "Quadro de Candidaturas",
		tasks: "Quadro de Tarefas",
		calendar: "CalendÃ¡rio",
		contacts: "Contatos",
		profile: "Perfil",
	},
	headers: {
		jobs: "Candidaturas a Empregos",
		applications: "Quadro de Candidaturas",
		tasks: "Quadro de Tarefas",
		calendar: "Vista do CalendÃ¡rio",
		contacts: "Todos os Contatos",
	},
	kanban: {
		title: "Quadro de Candidaturas",
		totalJobs: "{count} candidaturas no total",
		editJob: "Editar Vaga",
		addJob: "Adicionar Vaga",
	},
	table: {
		headers: {
			priority: "Prioridade",
			company: "Empresa",
			position: "Cargo",
			currentPhase: "Fase Atual",
			substep: "Subetapa",

			salaryRange: "Salario",
			sourceUrl: "Link",
			location: "LocalizaÃ§Ã£o",
			contacts: "Contatos",
			notes: "Notas",
			tasks: "Tarefas",
			actions: "AÃ§Ãµes",
		},
		filters: {
			allPriorities: "Todas as Prioridades",
			allPhases: "Todas as Fases",
		},
		placeholders: {
			company: "Nome da Empresa",
			position: "Cargo",

			salaryRange: "Faixa Salarial",
			location: "LocalizaÃ§Ã£o",
			sourceUrl: "URL da Vaga",
		},
	},
	priorities: {
		high: "Alta",
		medium: "MÃ©dia",
		low: "Baixa",
	},
	phases: {
		wishlist: "Lista de Desejos",
		applied: "Candidatura Enviada",
		interview: "Entrevista",
		offer: "Oferta",
		rejected_withdrawn: "Rejeitado / Retirado",
	},
	substeps: {
		none: "Nenhuma subetapa",
		wishlist: "Lista de Desejos",
		applied: "Candidatura Enviada",
		interview: "Entrevista",
		offer: "Oferta",
		rejected_withdrawn: "Rejeitado / Retirado",
		application_review: "AnÃ¡lise da Candidatura",
		initial_screening: "Triagem Inicial",
		hr_phone_screen: "Triagem por Telefone - RH",
		recruiter_call: "LigaÃ§Ã£o do Recrutador",
		phone_screening: "Triagem por Telefone",
		technical_phone_screen: "Triagem TÃ©cnica por Telefone",
		coding_challenge: "Desafio de ProgramaÃ§Ã£o",
		take_home_assignment: "Tarefa para Casa",
		technical_interview: "Entrevista TÃ©cnica",
		system_design_interview: "Entrevista de Design de Sistema",
		behavioral_interview: "Entrevista Comportamental",
		team_interview: "Entrevista com a Equipe",
		hiring_manager_interview: "Entrevista com Gerente de ContrataÃ§Ã£o",
		panel_interview: "Entrevista em Painel",
		final_round: "Etapa Final",
		reference_check: "VerificaÃ§Ã£o de ReferÃªncias",
		background_check: "VerificaÃ§Ã£o de Antecedentes",
		offer_discussion: "DiscussÃ£o da Oferta",
		salary_negotiation: "NegociaÃ§Ã£o Salarial",
	},
	stats: {
		totalApplications: "Total de Candidaturas",
		active: "Ativas",
		interviews: "Entrevistas",
		offers: "Ofertas",
		rejections: "RejeiÃ§Ãµes",
	},
	messages: {
		welcome:
			"Bem-vindo ao JobTracker!\n\nGostaria de ver 2 exemplos de candidaturas para entender como o rastreador funciona?",
		welcomeConfirm: "Sim, adicionar exemplos",
		welcomeCancel: "NÃ£o, deixar vazio",
		confirmDelete: "Tem certeza de que deseja excluir a candidatura para {position} na {company}?",
	},
	demo: {
		notes1: "Ã“timo encaixe cultural. Preciso pesquisar sua arquitetura de microsserviÃ§os.",
		notes2: "Startup em estÃ¡gio inicial. Alto potencial de crescimento, mas arriscado.",
	},
	seo: {
		title: "JobTracker - Rastreador Local Gratuito | Sem Login, Sem Rastreamento, Dados Privados",
		description:
			"Rastreador de candidaturas 100% gratuito que funciona localmente no seu navegador. Sem login necessÃ¡rio, sem rastreamento de dados, sem servidores. Seus dados de busca de emprego ficam completamente privados no seu dispositivo.",
		keywords:
			"rastreador gratuito de empregos, rastreador local de candidaturas, busca de emprego privada, rastreador sem login, rastreador offline de empregos, candidaturas com privacidade, gestÃ£o de carreira sem rastreamento, busca de emprego local",
		author: "Equipe JobTracker",
		ogTitle: "JobTracker - Rastreador Local Gratuito (Sem Login NecessÃ¡rio)",
		ogDescription:
			"Acompanhe candidaturas de forma privada no seu navegador. 100% gratuito, sem login, sem rastreamento, seus dados nunca saem do seu dispositivo.",
		twitterTitle: "JobTracker - Rastreador Privado de Candidaturas",
		twitterDescription:
			"Rastreador local gratuito com total privacidade. Sem login, sem rastreamento, seus dados de busca de emprego ficam no seu dispositivo.",
	},
	modals: {
		notes: {
			title: "Notas para {position} na {company}",
			activeSection: "Notas Ativas",
			archivedSection: "Notas Arquivadas ({count})",
			emptyState: "Sem notas ainda. Adicione sua primeira nota abaixo.",
			addSection: "Adicionar Nova Nota",
			placeholder: "Digite sua nota aqui...",
			editTitle: "Editar nota",
			archiveTitle: "Arquivar nota",
			unarchiveTitle: "Desarquivar nota",
			addButton: "Adicionar Nota",
		},
		tasks: {
			title: "Tarefas para {position} na {company}",
			activeSection: "Tarefas Ativas",
			archivedSection: "Tarefas Arquivadas ({count})",
			emptyState: "Sem tarefas ainda. Adicione sua primeira tarefa abaixo.",
			addSection: "Adicionar Nova Tarefa",
			placeholder: "Digite sua tarefa aqui...",
			editTitle: "Editar tarefa",
			archiveTitle: "Arquivar tarefa",
			unarchiveTitle: "Desarquivar tarefa",
			addButton: "Adicionar Tarefa",
			status: "Status",
			priority: "Prioridade",
			dueDate: "Data de Vencimento",
			duration: "DuraÃ§Ã£o",
			statusTodo: "A Fazer",
			statusInProgress: "Em Progresso",
			statusDone: "ConcluÃ­da",
			priorityLow: "Baixa",
			priorityMedium: "MÃ©dia",
			priorityHigh: "Alta",
		},
		contacts: {
			title: "Contatos para {position} na {company}",
			activeSection: "Contatos Ativos",
			archivedSection: "Contatos Arquivados ({count})",
			emptyState: "Sem contatos ainda. Adicione seu primeiro contato abaixo.",
			addSection: "Adicionar Novo Contato",
			editTitle: "Editar contato",
			archiveTitle: "Arquivar contato",
			unarchiveTitle: "Desarquivar contato",
			addButton: "Adicionar Contato",
			placeholderName: "Nome",
			placeholderEmail: "Email",
			placeholderPhone: "Telefone",
			placeholderCompany: "Empresa",
			noContacts: "Sem contatos",
			defaultContact: "Contato",
			validation: {
				nameRequired: "Nome Ã© obrigatÃ³rio",
				emailRequired: "Email Ã© obrigatÃ³rio",
			},
		},
		common: {
			save: "Salvar",
			cancel: "Cancelar",
			close: "Fechar",
			ok: "OK",
			yes: "Sim",
			no: "NÃ£o",
		},
		dialogs: {
			alert: "Alerta",
			confirm: "Confirmar",
			prompt: "Entrada NecessÃ¡ria",
		},
	},
	forms: {
		saveChangesTitle: "Salvar alteraÃ§Ãµes",
		cancelEditingTitle: "Cancelar ediÃ§Ã£o",
		noDueDate: "Sem data de vencimento",
		placeholderNameEmail: "Nome\nEmail",
	},
	footer: {
		madeWith: "Feito com",
		by: "por",
	},
	calendar: {
		title: "VisualizaÃ§Ã£o de CalendÃ¡rio",
		today: "Hoje",
		month: "MÃªs",
		week: "Semana",
		day: "Dia",
		previous: "Anterior",
		next: "PrÃ³ximo",
		noEvents: "Nenhum evento agendado",
		events: "eventos",
		applied: "Candidatou-se",
		task: "Tarefa",
		interview: "Entrevista",
		followUp: "Acompanhamento",
		months: [
			"Janeiro",
			"Fevereiro",
			"MarÃ§o",
			"Abril",
			"Maio",
			"Junho",
			"Julho",
			"Agosto",
			"Setembro",
			"Outubro",
			"Novembro",
			"Dezembro",
		],
		weekdays: ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "SÃ¡b"],
		weekdaysFull: ["Domingo", "Segunda", "TerÃ§a", "Quarta", "Quinta", "Sexta", "SÃ¡bado"],
	},
	contactsView: {
		title: "Todos os Contatos",
		totalContacts: "{count} contatos no total",
		emptyState: "Nenhum contato encontrado. Adicione contatos Ã s suas vagas para vÃª-los aqui.",
		nameHeader: "Nome",
		emailHeader: "Email",
		phoneHeader: "Telefone",
		roleHeader: "Cargo",
		companyHeader: "Empresa",
		jobHeader: "PosiÃ§Ã£o",
		actionsHeader: "AÃ§Ãµes",
		namePlaceholder: "Nome do contato",
		emailPlaceholder: "email@exemplo.com",
		phonePlaceholder: "+55 (11) 99999-9999",
		rolePlaceholder: "Cargo/TÃ­tulo",
		addContact: "Adicionar Contato",
		addContactTitle: "Adicionar Novo Contato",
		selectJob: "Selecione uma vaga...",
		noJobsAvailable: "Nenhuma vaga disponÃ­vel. Crie uma vaga primeiro.",
		deleteTitle: "Deletar contato",
		deleteConfirmation: "Tem certeza que deseja deletar {name}?",
		validation: {
			nameRequired: "Nome Ã© obrigatÃ³rio",
			jobRequired: "Por favor selecione uma vaga",
		},
	},
};


// ============================================================================
// SRC/LIB/I18N.JS
// ============================================================================

// ============================================================================
// MINI I18N LIBRARY
// ============================================================================

const I18n = {
	// Current language
	currentLanguage: "en",

	// Language detection from browser
	detectLanguage: () => {
		const browserLang = navigator.language || navigator.userLanguage;
		const langCode = browserLang.split("-")[0];
		return I18n.translations[langCode] ? langCode : "en";
	},

	// Get language from URL parameter
	getLanguageFromURL: () => {
		const urlParams = new URLSearchParams(window.location.search);
		const langParam = urlParams.get("lang");
		return langParam && I18n.translations[langParam] ? langParam : null;
	},

	// Set language in URL parameter
	setLanguageInURL: (lang) => {
		const url = new URL(window.location);
		if (lang && lang !== "en") {
			url.searchParams.set("lang", lang);
		} else {
			url.searchParams.delete("lang");
		}
		window.history.replaceState({}, "", url);
	},

	// Set current language
	setLanguage: (lang) => {
		if (I18n.translations[lang]) {
			I18n.currentLanguage = lang;
			I18n.setLanguageInURL(lang);
			DataStore.save({ ...DataStore.load(), language: lang });
			return true;
		}
		return false;
	},

	// Get translated text
	t: (key, params = {}) => {
		const keys = key.split(".");
		let translation = I18n.translations[I18n.currentLanguage];

		for (const k of keys) {
			translation = translation?.[k];
		}

		if (!translation) {
			console.warn(`Translation missing for key: ${key} in language: ${I18n.currentLanguage}`);
			return key;
		}

		// If translation is not a string (e.g., array or object), return as is
		if (typeof translation !== "string") {
			return translation;
		}

		// Replace parameters in translation
		return translation.replace(/\{(\w+)\}/g, (match, param) => {
			return params[param] !== undefined ? params[param] : match;
		});
	},

	// Get available languages
	getLanguages: () => Object.keys(I18n.translations),

	// Initialize language from storage or browser
	init: () => {
		// Priority: URL parameter > saved language > browser language > default (en)
		const urlLang = I18n.getLanguageFromURL();
		const savedData = DataStore.load();
		const savedLanguage = savedData?.language;

		I18n.currentLanguage = urlLang || savedLanguage || I18n.detectLanguage();

		// Update URL to reflect current language
		I18n.setLanguageInURL(I18n.currentLanguage);
	},
};

// Translation constants
I18n.translations = {
	en: EN_TRANSLATIONS,
	pt: PT_TRANSLATIONS,
};


// ============================================================================
// SRC/UTILS/CONSTANTS.JS
// ============================================================================

// ============================================================================
// CONFIGURATION
// ============================================================================

const CONFIG = {
	dateFormat: "DD/MM/YY HH:MM", // Options: 'DD/MM/YY', 'MM/DD/YY', 'YYYY-MM-DD', 'DD/MM/YY HH:MM'
	showTimeInNotes: true, // Set to true to include time in notes
	// Language configuration
	languages: [
		{ code: "en", name: "English", flag: "ðŸ‡ºðŸ‡¸" },
		{ code: "pt", name: "PortuguÃªs", flag: "ðŸ‡§ðŸ‡·" },
	],
	// Default tab to show on application load
	defaultTab: "jobs",
};

// ============================================================================
// CONSTANTS AND DATA
// ============================================================================

const PRIORITIES = ["high", "medium", "low"];

// Task statuses for task management
const TASK_STATUSES = ["todo", "in-progress", "done"];

// Basic phases for main workflow
const PHASES = ["wishlist", "applied", "interview", "offer", "rejected_withdrawn"];

// Sub-steps that can be used within phases
const PHASE_SUBSTEPS = {
	applied: ["application_review", "initial_screening", "hr_phone_screen", "recruiter_call"],
	interview: [
		"phone_screening",
		"technical_phone_screen",
		"coding_challenge",
		"take_home_assignment",
		"technical_interview",
		"system_design_interview",
		"behavioral_interview",
		"team_interview",
		"hiring_manager_interview",
		"panel_interview",
		"final_round",
	],
	offer: ["reference_check", "background_check", "offer_discussion", "salary_negotiation"],
};

// Helper functions to get translated values
const getPriorityText = (priorityKey) => I18n.t(`priorities.${priorityKey}`);
const getPhaseText = (phaseKey) => I18n.t(`phases.${phaseKey}`);
const getSubstepText = (substepKey) => I18n.t(`substeps.${substepKey}`);

// Helper function to get all substeps for a phase
const getSubstepsForPhase = (phaseKey) => PHASE_SUBSTEPS[phaseKey] || [];

// Global state variables
// biome-ignore lint/style/useConst: global jobs data
let jobsData = [];
// biome-ignore lint/style/useConst: global original data
let originalData = [];


// ============================================================================
// SRC/UTILS/SEED-DATA.JS
// ============================================================================

// ============================================================================
// SEED DATA - DEMO DATA FOR FIRST-TIME USERS
// ============================================================================

// Demo data for first-time users
const DEMO_DATA = [
	{
		id: 1,
		priority: "high",
		company: "TechCorp Inc",
		position: "Senior Software Engineer",
		appliedDate: "2025-06-15T10:00:00.000Z",
		currentPhase: "interview",
		currentSubstep: "technical_interview",
		completedSubsteps: ["phone_screening"],
		salaryRange: "$120k - $150k",
		location: "San Francisco, CA",
		notes: "demo.notes1",
		tasks: [
			{
				id: "1",
				text: "Prepare system design presentation",
				status: "todo",
				priority: "high",
				createdAt: "2025-06-15T10:00:00.000Z",
				completedAt: null,
				dueDate: "2025-06-25T10:00:00.000Z",
				duration: "2h",
			},
			{
				id: "2",
				text: "Review company tech stack",
				status: "done",
				priority: "medium",
				createdAt: "2025-06-14T09:00:00.000Z",
				completedAt: "2025-06-16T14:30:00.000Z",
				dueDate: null,
				duration: "1h",
			},
			{
				id: "3",
				text: "Complete coding assessment",
				status: "todo",
				priority: "high",
				createdAt: "2025-06-20T10:00:00.000Z",
				completedAt: null,
				dueDate: "2025-06-28T23:59:00.000Z",
				duration: "3h",
			},
			{
				id: "4",
				text: "Research team members on LinkedIn",
				status: "todo",
				priority: "low",
				createdAt: "2025-06-21T10:00:00.000Z",
				completedAt: null,
				dueDate: "2025-07-02T10:00:00.000Z",
				duration: null,
			},
		],
		contacts: [
			{
				id: "1",
				name: "Sarah Johnson",
				email: "sarah.johnson@techcorp.com",
				phone: "+1 (555) 123-4567",
				company: "TechCorp Inc",
				role: "Technical Recruiter",
				createdAt: "2025-06-15T10:00:00.000Z",
				archived: false,
			},
			{
				id: "2",
				name: "Mike Chen",
				email: "mike.chen@techcorp.com",
				phone: "+1 (555) 234-5678",
				company: "TechCorp Inc",
				role: "Engineering Manager",
				createdAt: "2025-06-16T14:00:00.000Z",
				archived: false,
			},
		],
	},
	{
		id: 2,
		priority: "medium",
		company: "StartupXYZ",
		position: "Full Stack Developer",
		appliedDate: "2025-06-12T09:00:00.000Z",
		currentPhase: "applied",
		currentSubstep: "hr_phone_screen",
		completedSubsteps: ["application_review"],

		salaryRange: "$90k - $110k + equity",
		location: "Remote",
		notes: "demo.notes2",
		tasks: [
			{
				id: "5",
				text: "Follow up on application",
				status: "in-progress",
				priority: "medium",
				createdAt: "2025-06-12T15:00:00.000Z",
				completedAt: null,
				dueDate: "2025-06-26T17:00:00.000Z",
				duration: "30min",
			},
			{
				id: "6",
				text: "Prepare portfolio projects showcase",
				status: "todo",
				priority: "high",
				createdAt: "2025-06-18T10:00:00.000Z",
				completedAt: null,
				dueDate: "2025-06-30T17:00:00.000Z",
				duration: "1h30",
			},
			{
				id: "7",
				text: "Write thank you note after interview",
				status: "todo",
				priority: "medium",
				createdAt: "2025-06-22T10:00:00.000Z",
				completedAt: null,
				dueDate: null,
				duration: "15min",
			},
			{
				id: "8",
				text: "Review equity compensation guide",
				status: "todo",
				priority: "low",
				createdAt: "2025-06-23T10:00:00.000Z",
				completedAt: null,
				dueDate: "2025-07-10T10:00:00.000Z",
				duration: null,
			},
		],
		contacts: [
			{
				id: "3",
				name: "Alex Rivera",
				email: "alex@startupxyz.com",
				phone: null,
				company: "StartupXYZ",
				role: "CTO",
				createdAt: "2025-06-12T09:00:00.000Z",
				archived: false,
			},
		],
	},
];

// Helper function to get demo data with translations
const getDemoData = () => {
	return DEMO_DATA.map((job) => ({
		...job,

		notes: job.notes.startsWith("demo.")
			? [
					{
						id: Date.now() + Math.random(),
						date: job.appliedDate || new Date().toISOString(),
						phase: job.currentPhase || "applied",
						text: I18n.t(job.notes),
					},
				]
			: Array.isArray(job.notes)
				? job.notes
				: [],
	}));
};


// ============================================================================
// SRC/UTILS/HELPERS.JS
// ============================================================================

// ============================================================================
// UTILITY FUNCTIONS
// ============================================================================

// Format date for display
const formatDate = (dateString) => {
	const date = new Date(dateString);

	// Use CONFIG.dateFormat to determine format
	switch (CONFIG.dateFormat) {
		case "DD/MM/YY":
			return date.toLocaleDateString("en-GB", {
				year: "2-digit",
				month: "2-digit",
				day: "2-digit",
			});
		case "MM/DD/YY":
			return date.toLocaleDateString("en-US", {
				year: "2-digit",
				month: "2-digit",
				day: "2-digit",
			});
		case "YYYY-MM-DD":
			return date.toISOString().split("T")[0];
		case "DD/MM/YY HH:MM":
			return `${date.toLocaleDateString("en-GB", {
				year: "2-digit",
				month: "2-digit",
				day: "2-digit",
			})} ${date.toLocaleTimeString("en-GB", {
				hour: "2-digit",
				minute: "2-digit",
				hour12: false,
			})}`;
		default:
			// Default to DD/MM/YY format
			return date.toLocaleDateString("en-GB", {
				year: "2-digit",
				month: "2-digit",
				day: "2-digit",
			});
	}
};

function getPhaseClass(phase) {
	return phase.toLowerCase().replace(/\s+/g, "_");
}

function getUniqueValues(array, property) {
	return [...new Set(array.map((item) => item[property]))];
}

function createElement(tag, className, textContent) {
	return $.create(tag, className, textContent);
}

function createOption(value, text, selected = false) {
	const option = createElement("option");
	option.value = value;
	option.textContent = text;
	if (selected) option.selected = true;
	return option;
}

// Helper function for task status text
const getTaskStatusText = (statusKey) => {
	const statusMap = {
		todo: I18n.t("modals.tasks.statusTodo"),
		"in-progress": I18n.t("modals.tasks.statusInProgress"),
		done: I18n.t("modals.tasks.statusDone"),
	};
	return statusMap[statusKey] || statusKey;
};

function updateStaticTexts() {
	// Update header
	$("#appTitle").text(I18n.t("app.title"));

	// Update jobs header title
	$("#jobsTitle").text(I18n.t("headers.jobs"));

	// Update button
	$("#addAppBtn").text(I18n.t("buttons.addApplication"));

	// Update table headers
	$("#priorityHeader").text(I18n.t("table.headers.priority"));
	$("#companyHeader").text(I18n.t("table.headers.company"));
	$("#positionHeader").text(I18n.t("table.headers.position"));
	$("#currentPhaseHeader").text(I18n.t("table.headers.currentPhase"));
	$("#salaryRangeHeader").text(I18n.t("table.headers.salaryRange"));
	$("#locationHeader").text(I18n.t("table.headers.location"));
	$("#sourceUrlHeader").text(I18n.t("table.headers.sourceUrl"));
	$("#contactsHeader").text(I18n.t("table.headers.contacts"));
	$("#notesHeader").text(I18n.t("table.headers.notes"));
	$("#tasksHeader").text(I18n.t("table.headers.tasks"));
	$("#actionsHeader").text(I18n.t("table.headers.actions"));

	// Update stats labels
	$("#totalAppsLabel").text(I18n.t("stats.totalApplications"));
	$("#activeAppsLabel").text(I18n.t("stats.active"));
	$("#interviewsLabel").text(I18n.t("stats.interviews"));
	$("#offersLabel").text(I18n.t("stats.offers"));
	$("#rejectionsLabel").text(I18n.t("stats.rejections"));

	// Update footer text
	$("#footerMadeWith").text(I18n.t("footer.madeWith"));
	$("#footerBy").text(I18n.t("footer.by"));
}

// Initialize language switcher
function initializeLanguageSwitcher() {
	const container = $("#languageSwitcher");

	if (container) {
		const switcher = LanguageSwitcher.create();
		container.get().innerHTML = "";
		container.get().appendChild(switcher);
		LanguageSwitcher.init();
	}
}

// Initialize tab navigation
function initializeTabNavigation() {
	const container = $("#tabNavigation");

	if (container) {
		const tabNav = TabNavigation.create();
		container.get().innerHTML = "";
		container.get().appendChild(tabNav);
		TabNavigation.init();
	}
}

// Update meta tags for current language
function updateMetaTags() {
	const lang = I18n.currentLanguage;
	const translations = I18n.translations[lang];

	if (!translations || !translations.seo) return;

	const seo = translations.seo;
	const ogLocale = lang === "pt" ? "pt_BR" : "en_US";
	const baseUrl = "http://jobtracker.cv/";
	const currentUrl = lang === "en" ? baseUrl : `${baseUrl}?lang=${lang}`;

	// Update title
	document.title = seo.title;

	// Update meta tags
	updateMetaTag("name", "description", seo.description);
	updateMetaTag("name", "keywords", seo.keywords);
	updateMetaTag("name", "author", seo.author);
	updateMetaTag("name", "language", lang);

	// Update Open Graph tags
	updateMetaTag("property", "og:title", seo.ogTitle);
	updateMetaTag("property", "og:description", seo.ogDescription);
	updateMetaTag("property", "og:url", currentUrl);
	updateMetaTag("property", "og:locale", ogLocale);

	// Update Twitter Card tags
	updateMetaTag("name", "twitter:title", seo.twitterTitle);
	updateMetaTag("name", "twitter:description", seo.twitterDescription);

	// Update canonical URL
	updateCanonicalUrl(currentUrl);

	// Update hreflang links
	updateHreflangLinks(baseUrl);
}

// Helper function to update a meta tag
function updateMetaTag(attribute, name, content) {
	let meta = document.querySelector(`meta[${attribute}="${name}"]`);
	if (!meta) {
		meta = document.createElement("meta");
		meta.setAttribute(attribute, name);
		document.head.appendChild(meta);
	}
	meta.setAttribute("content", content);
}

// Helper function to update canonical URL
function updateCanonicalUrl(url) {
	let canonical = document.querySelector('link[rel="canonical"]');
	if (!canonical) {
		canonical = document.createElement("link");
		canonical.setAttribute("rel", "canonical");
		document.head.appendChild(canonical);
	}
	canonical.setAttribute("href", url);
}

// Helper function to update hreflang links
function updateHreflangLinks(baseUrl) {
	// Remove existing hreflang links
	document.querySelectorAll("link[hreflang]").forEach((link) => link.remove());

	// Add hreflang links for each language
	CONFIG.languages.forEach((language) => {
		const link = document.createElement("link");
		link.setAttribute("rel", "alternate");
		link.setAttribute("hreflang", language.code);

		if (language.code === "en") {
			link.setAttribute("href", baseUrl);
		} else {
			link.setAttribute("href", `${baseUrl}?lang=${language.code}`);
		}

		document.head.appendChild(link);
	});

	// Add x-default hreflang (English as default)
	const defaultLink = document.createElement("link");
	defaultLink.setAttribute("rel", "alternate");
	defaultLink.setAttribute("hreflang", "x-default");
	defaultLink.setAttribute("href", baseUrl);
	document.head.appendChild(defaultLink);
}

// Global function to update UI language - called when language changes
function updateUILanguage() {
	// Update all static texts
	updateStaticTexts();

	// Update meta tags for SEO
	updateMetaTags();

	// Update language switcher
	if (typeof LanguageSwitcher !== "undefined") {
		LanguageSwitcher.updateUI();
	}

	// Update tab navigation language
	if (typeof TabNavigation !== "undefined") {
		TabNavigation.updateLanguage();
	}

	// Update filter dropdowns with new language
	if (typeof setupFilters === "function") {
		setupFilters();
	}

	// Re-render the table to update all dynamic content
	if (typeof refreshInterface === "function") {
		refreshInterface();
	}
}


// ============================================================================
// SRC/UTILS/DATA.JS
// ============================================================================

// ============================================================================
// DATA PERSISTENCE
// ============================================================================

// Save to localStorage
const saveToLocalStorage = () => {
	DataStore.save({
		jobs: jobsData,
		language: I18n.currentLanguage,
	});
};

// Load from localStorage
const loadFromLocalStorage = () => {
	const savedData = DataStore.load();

	if (savedData) {
		// Set language first
		if (savedData.language) {
			I18n.setLanguage(savedData.language);
		}

		// Load jobs data directly without migration
		if (savedData.jobs && Array.isArray(savedData.jobs)) {
			return savedData.jobs;
		}
	}

	return null;
};


// ============================================================================
// SRC/COMPONENTS/DIALOGS.JS
// ============================================================================

// ============================================================================
// CUSTOM DIALOG SYSTEM
// ============================================================================

const CustomDialogs = {
	// Store active dialog reference
	activeDialog: null,

	// Show custom alert dialog
	alert: (message, title = null) => {
		return new Promise((resolve) => {
			const modal = CustomDialogs.createModal({
				title: title || I18n.t("modals.dialogs.alert") || "Alert",
				message,
				buttons: [
					{
						text: I18n.t("modals.common.ok") || "OK",
						className: "btn-primary",
						onClick: () => {
							CustomDialogs.closeDialog();
							resolve(true);
						},
					},
				],
				type: "alert",
			});

			CustomDialogs.showDialog(modal);
		});
	},

	// Show custom confirm dialog
	confirm: (message, options = {}) => {
		return new Promise((resolve) => {
			const {
				title = null,
				confirmText = I18n.t("modals.common.ok") || "OK",
				cancelText = I18n.t("modals.common.cancel") || "Cancel",
				focusConfirm = false,
			} = options;

			const modal = CustomDialogs.createModal({
				title: title || I18n.t("modals.dialogs.confirm") || "Confirm",
				message,
				buttons: [
					{
						text: cancelText,
						className: focusConfirm ? "btn-secondary" : "btn-primary",
						onClick: () => {
							CustomDialogs.closeDialog();
							resolve(false);
						},
					},
					{
						text: confirmText,
						className: focusConfirm ? "btn-primary" : "btn-secondary",
						onClick: () => {
							CustomDialogs.closeDialog();
							resolve(true);
						},
					},
				],
				type: "confirm",
				focusConfirm,
			});

			CustomDialogs.showDialog(modal, focusConfirm);
		});
	},

	// Show custom prompt dialog
	prompt: (message, defaultValue = "", title = null) => {
		return new Promise((resolve) => {
			let inputValue = defaultValue;

			const modal = CustomDialogs.createModal({
				title: title || I18n.t("modals.dialogs.prompt") || "Input Required",
				message,
				input: {
					type: "text",
					value: defaultValue,
					placeholder: message,
					onChange: (value) => {
						inputValue = value;
					},
				},
				buttons: [
					{
						text: I18n.t("modals.common.cancel") || "Cancel",
						className: "btn-secondary",
						onClick: () => {
							CustomDialogs.closeDialog();
							resolve(null);
						},
					},
					{
						text: I18n.t("modals.common.ok") || "OK",
						className: "btn-primary",
						onClick: () => {
							CustomDialogs.closeDialog();
							resolve(inputValue);
						},
					},
				],
				type: "prompt",
			});

			CustomDialogs.showDialog(modal);
		});
	},

	// Create modal structure
	createModal: ({ title, message, buttons, input, type, focusConfirm = false }) => {
		const modal = h(
			"div",
			{
				className: "modal-overlay custom-dialog",
				onclick: (e) => {
					if (e.target.className.includes("modal-overlay")) {
						// Don't auto-close on backdrop click for dialogs
						// User must explicitly choose an option
					}
				},
			},
			h(
				"div",
				{
					className: `modal custom-dialog-modal dialog-${type}`,
					onclick: (e) => e.stopPropagation(),
				},
				// Header
				h(
					"div",
					{ className: "modal-header" },
					h("h3", { className: "modal-title" }, title)
					// No close button - force user to choose an option
				),

				// Body
				h(
					"div",
					{ className: "modal-body custom-dialog-body" },
					h("div", { className: "dialog-message" }, message),

					// Input field for prompt
					input
						? h(
								"div",
								{ className: "dialog-input-container" },
								h("input", {
									type: input.type,
									value: input.value,
									placeholder: input.placeholder,
									className: "dialog-input",
									oninput: (e) => input.onChange(e.target.value),
									onkeydown: (e) => {
										if (e.key === "Enter") {
											// Trigger the primary button (last button)
											const primaryBtn = modal.querySelector(".btn-primary");
											if (primaryBtn) primaryBtn.click();
										}
										if (e.key === "Escape") {
											// Trigger the secondary button (first button)
											const secondaryBtn = modal.querySelector(".btn-secondary");
											if (secondaryBtn) secondaryBtn.click();
										}
									},
								})
							)
						: null
				),

				// Footer with buttons
				h(
					"div",
					{ className: "modal-footer dialog-footer" },
					...buttons.map((button) =>
						h(
							"button",
							{
								className: `action-btn ${button.className}`,
								onclick: button.onClick,
							},
							button.text
						)
					)
				)
			)
		);

		return modal;
	},

	// Show dialog
	showDialog: (modal, focusConfirm = false) => {
		// Close any existing dialog
		CustomDialogs.closeDialog();

		// Optimize rendering to reduce flickering
		modal.style.opacity = "0";
		modal.style.transform = "translate(-50%, -60%) scale(0.95)";

		CustomDialogs.activeDialog = modal;
		document.body.appendChild(modal);

		// Force browser to calculate layout before showing
		modal.offsetHeight;

		// Trigger the animation
		requestAnimationFrame(() => {
			modal.style.opacity = "";
			modal.style.transform = "";

			// Focus handling after animation starts
			setTimeout(() => {
				const input = modal.querySelector(".dialog-input");
				if (input) {
					input.focus();
				} else if (focusConfirm) {
					// Focus the confirm button (primary in this case)
					const confirmBtn = modal.querySelector(".btn-primary");
					if (confirmBtn) confirmBtn.focus();
				} else {
					// Focus the first button (usually cancel)
					const firstBtn = modal.querySelector(".action-btn");
					if (firstBtn) firstBtn.focus();
				}
			}, 50);
		});

		// Add keyboard event listener for ESC key
		const handleKeydown = (e) => {
			if (e.key === "Escape") {
				// Trigger cancel/close button
				const cancelBtn = modal.querySelector(".btn-secondary");
				if (cancelBtn) {
					cancelBtn.click();
				} else {
					// If no cancel button, trigger the primary button
					const primaryBtn = modal.querySelector(".btn-primary");
					if (primaryBtn) primaryBtn.click();
				}
			}
		};

		document.addEventListener("keydown", handleKeydown);
		modal.dataset.keydownHandler = "true";
	},

	// Close active dialog
	closeDialog: () => {
		if (CustomDialogs.activeDialog) {
			// Remove keyboard event listener
			if (CustomDialogs.activeDialog.dataset.keydownHandler) {
				document.removeEventListener("keydown", CustomDialogs.handleKeydown);
			}

			if (CustomDialogs.activeDialog.parentNode) {
				CustomDialogs.activeDialog.parentNode.removeChild(CustomDialogs.activeDialog);
			}
			CustomDialogs.activeDialog = null;
		}
	},
};

// Helper for simple confirm dialogs with custom buttons
CustomDialogs.confirmCustom = (
	message,
	confirmText,
	cancelText,
	focusConfirm = false,
	title = null
) => {
	return CustomDialogs.confirm(message, {
		title,
		confirmText,
		cancelText,
		focusConfirm,
	});
};

// Override native dialogs globally
window.customAlert = CustomDialogs.alert;
window.customConfirm = CustomDialogs.confirm;
window.customConfirmCustom = CustomDialogs.confirmCustom;
window.customPrompt = CustomDialogs.prompt;

// For testing - you can restore native dialogs with these
window.nativeAlert = window.alert;
window.nativeConfirm = window.confirm;
window.nativePrompt = window.prompt;

// Replace native dialogs
window.alert = CustomDialogs.alert;
window.confirm = CustomDialogs.confirm;
window.prompt = CustomDialogs.prompt;


// ============================================================================
// SRC/COMPONENTS/NOTES.JS
// ============================================================================

// ============================================================================
// NOTES SYSTEM COMPONENTS
// ============================================================================

// Notes count display component
const NotesCount = ({ notes = [], onClick }) => {
	const activeNotes = notes.filter((note) => !note.archived);
	const count = activeNotes.length;
	const className = count === 0 ? "notes-count zero" : "notes-count";

	return h("span", {
		className,
		onclick: onClick, // Always allow clicks to open modal
		textContent: count.toString(),
		title: `${count} active note${count !== 1 ? "s" : ""}${notes.length !== count ? ` (${notes.length - count} archived)` : ""}`,
	});
};

// Individual note item component
const NoteItem = ({ note, job }) => {
	const isArchived = note.archived || false;

	const handleArchiveToggle = () => {
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		const noteIndex = jobsData[jobIndex].notes.findIndex((n) => n.id === note.id);
		if (noteIndex === -1) return;

		jobsData[jobIndex].notes[noteIndex].archived = !isArchived;
		saveToLocalStorage();

		// Update the note element in place
		const noteElement = document.querySelector(`[data-note-id="${note.id}"]`);
		if (noteElement) {
			const newArchiveStatus = !isArchived;
			noteElement.style.opacity = newArchiveStatus ? "0.6" : "1";
			noteElement.style.filter = newArchiveStatus ? "grayscale(0.5)" : "none";
			noteElement.className = `note-item ${newArchiveStatus ? "archived" : ""}`;

			// Update archive button
			const archiveBtn = noteElement.querySelector(".archive-btn");
			if (archiveBtn) {
				archiveBtn.innerHTML = `<span class="material-symbols-outlined icon-14">${newArchiveStatus ? "unarchive" : "archive"}</span>`;
			}
		}

		// Update interface
		refreshInterface();
	};

	const handleEdit = () => {
		const noteTextElement = document.querySelector(`[data-note-id="${note.id}"] .note-text`);
		if (!noteTextElement) return;

		const currentText = note.text;
		const textarea = h("textarea", {
			className: "note-edit-textarea",
			textContent: currentText,
		});

		const saveBtn = h("button", {
			className: "action-btn edit-btn edit-save-btn",
			textContent: I18n.t("modals.common.save"),
			onclick: () => {
				const newText = textarea.value.trim();
				if (!newText) return;

				const jobIndex = jobsData.findIndex((j) => j.id === job.id);
				if (jobIndex === -1) return;

				const noteIndex = jobsData[jobIndex].notes.findIndex((n) => n.id === note.id);
				if (noteIndex === -1) return;

				jobsData[jobIndex].notes[noteIndex].text = newText;
				saveToLocalStorage();

				// Update in place - replace textarea with new text
				noteTextElement.innerHTML = "";
				noteTextElement.textContent = newText;

				// Update interface
				refreshInterface();
			},
		});

		const cancelBtn = h("button", {
			className: "action-btn cancel-btn edit-cancel-btn",
			textContent: I18n.t("modals.common.cancel"),
			onclick: () => {
				// Cancel editing - restore original text
				noteTextElement.innerHTML = "";
				noteTextElement.textContent = note.text;
			},
		});

		noteTextElement.innerHTML = "";
		noteTextElement.appendChild(textarea);
		noteTextElement.appendChild(h("div", {}, saveBtn, cancelBtn));
		textarea.focus();
	};

	return h(
		"div",
		{
			className: `note-item ${isArchived ? "archived" : ""}`,
			"data-note-id": note.id,
		},
		h(
			"div",
			{
				className: "note-header",
			},
			h(
				"div",
				{ className: "modal-header-content" },
				h("span", { className: "note-phase" }, getPhaseText(note.phase)),
				h("span", { className: "note-date" }, formatDate(note.date))
			),
			h(
				"div",
				{ className: "note-actions modal-actions-row" },
				h("button", {
					className: "action-btn edit-note-btn icon-btn-transparent",
					title: I18n.t("modals.notes.editTitle"),
					innerHTML: '<span class="material-symbols-outlined icon-14">edit</span>',
					onclick: handleEdit,
				}),
				h("button", {
					className: "action-btn archive-btn icon-btn-transparent",
					title: isArchived
						? I18n.t("modals.notes.unarchiveTitle")
						: I18n.t("modals.notes.archiveTitle"),
					innerHTML: `<span class="material-symbols-outlined icon-14">${isArchived ? "unarchive" : "archive"}</span>`,
					onclick: handleArchiveToggle,
				})
			)
		),
		h(
			"div",
			{
				className: "note-text",
			},
			note.text
		)
	);
};

// Unified modal component for viewing and adding notes
const NotesModal = ({ job, onClose }) => {
	const notes = job.notes || [];
	const activeNotes = notes.filter((note) => !note.archived);
	const archivedNotes = notes.filter((note) => note.archived);
	const sortedActiveNotes = [...activeNotes].sort((a, b) => new Date(a.date) - new Date(b.date));
	const sortedArchivedNotes = [...archivedNotes].sort(
		(a, b) => new Date(a.date) - new Date(b.date)
	);

	const handleAddNote = () => {
		const textarea = document.querySelector(".add-note-textarea");
		const noteText = textarea.value.trim();

		if (!noteText) {
			// Show error message instead of alert
			showValidationError(textarea, "Note text is required");
			return;
		}

		const newNote = {
			id: Date.now(),
			date: new Date().toISOString(),
			phase: job.currentPhase,
			text: noteText,
		};

		// Add note to job data
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		if (!jobsData[jobIndex].notes) {
			jobsData[jobIndex].notes = [];
		}

		jobsData[jobIndex].notes.push(newNote);
		saveToLocalStorage();

		// Update the job object for this modal
		job.notes = jobsData[jobIndex].notes;

		// Refresh modal without flicker
		refreshNotesModal(job);

		// Clear the textarea
		textarea.value = "";

		// Focus back to the textarea
		setTimeout(() => {
			const newTextarea = document.querySelector(".add-note-textarea");
			if (newTextarea) newTextarea.focus();
		}, 100);

		// Update the notes count in the table (refresh interface for count update)
		refreshInterface();
	};



	const archiveNote = (note, job) => {
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		const noteIndex = jobsData[jobIndex].notes.findIndex((n) => n.id === note.id);
		if (noteIndex === -1) return;

		jobsData[jobIndex].notes[noteIndex].archived = !note.archived;
		saveToLocalStorage();

		// Refresh modal without flicker
		refreshNotesModal(job);

		// Update interface
		refreshInterface();
	};

	const refreshNotesModal = (job) => {
		const modalBody = document.querySelector(".modal-body");
		if (!modalBody) return;

		// Get updated data
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		job.notes = jobsData[jobIndex].notes || [];
		const notes = job.notes;
		const activeNotes = notes.filter((note) => !note.archived);
		const archivedNotes = notes.filter((note) => note.archived);
		const sortedActiveNotes = [...activeNotes].sort((a, b) => new Date(a.date) - new Date(b.date));
		const sortedArchivedNotes = [...archivedNotes].sort(
			(a, b) => new Date(a.date) - new Date(b.date)
		);

		// Recreate modal body content
		modalBody.innerHTML = "";
		modalBody.appendChild(createNotesContent(job, sortedActiveNotes, sortedArchivedNotes));
	};

	const createNotesContent = (job, sortedActiveNotes, sortedArchivedNotes) => {
		return h(
			"div",
			{},
			// Active notes table
			sortedActiveNotes.length > 0
				? h(
						"div",
						{ className: "notes-table-container" },
						h(
							"table",
							{ className: "notes-table" },
							h(
								"thead",
								{},
								h(
									"tr",
									{},
									h("th", {}, "Phase"),
									h("th", {}, "Date"),
									h("th", {}, "Note"),
									h("th", {}, "Actions")
								)
							),
							h(
								"tbody",
								{},
								...sortedActiveNotes.map((note) =>
									h(
										"tr",
										{ key: note.id, "data-note-id": note.id },
										h("td", { className: "note-phase-cell" }, getPhaseText(note.phase)),
										h("td", { className: "note-date-cell" }, formatDate(note.date)),
										h("td", { className: "note-text-cell" }, note.text),
										h(
											"td",
											{ className: "notes-table-actions" },
											h("button", {
												className: "action-btn edit-note-btn icon-btn-transparent",
												title: I18n.t("modals.notes.editTitle"),
												innerHTML: '<span class="material-symbols-outlined icon-14">edit</span>',
												onclick: () => enableNoteEditing(note, job),
											}),
											h("button", {
												className: "action-btn archive-btn icon-btn-transparent",
												title: I18n.t("modals.notes.archiveTitle"),
												innerHTML: '<span class="material-symbols-outlined icon-14">archive</span>',
												onclick: () => archiveNote(note, job),
											})
										)
									)
								)
							)
						)
					)
				: h("p", { className: "modal-empty-message" }, I18n.t("modals.notes.emptyState")),

			// Archived notes section
			sortedArchivedNotes.length > 0
				? h(
						"div",
						{ className: "archived-notes-section" },
						h(
							"h4",
							{
								className: "notes-archived-header",
								onclick: () => {
									const archivedTable = document.getElementById("archived-notes-table");
									const expandIcon = document.getElementById("archived-notes-icon");
									if (archivedTable.style.display === "none") {
										archivedTable.style.display = "table";
										expandIcon.textContent = "expand_less";
									} else {
										archivedTable.style.display = "none";
										expandIcon.textContent = "expand_more";
									}
								},
							},
							h(
								"span",
								{ className: "material-symbols-outlined expand-icon", id: "archived-notes-icon" },
								"expand_more"
							),
							I18n.t("modals.notes.archivedSection", { count: sortedArchivedNotes.length })
						),
						h(
							"table",
							{
								id: "archived-notes-table",
								className: "notes-table archived",
								style: "display: none",
							},
							h(
								"thead",
								{},
								h(
									"tr",
									{},
									h("th", {}, "Phase"),
									h("th", {}, "Date"),
									h("th", {}, "Note"),
									h("th", {}, "Actions")
								)
							),
							h(
								"tbody",
								{},
								...sortedArchivedNotes.map((note) =>
									h(
										"tr",
										{ key: note.id },
										h("td", {}, getPhaseText(note.phase)),
										h("td", {}, formatDate(note.date)),
										h("td", { className: "note-text-cell" }, note.text),
										h(
											"td",
											{ className: "notes-table-actions" },
											h("button", {
												className: "action-btn archive-btn icon-btn-transparent",
												title: I18n.t("modals.notes.unarchiveTitle"),
												innerHTML:
													'<span class="material-symbols-outlined icon-14">unarchive</span>',
												onclick: () => archiveNote(note, job),
											})
										)
									)
								)
							)
						)
					)
				: null,

			// Add note form section
			h(
				"div",
				{ className: "add-note-section" },
				h("h4", { className: "add-note-title" }, I18n.t("modals.notes.addSection")),
				h(
					"form",
					{
						className: "add-note-form",
						onsubmit: (e) => {
							e.preventDefault();
							handleAddNote();
						}
					},
					h("textarea", {
						className: "add-note-textarea",
						placeholder: I18n.t("modals.notes.placeholder"),
						rows: 2,
						onkeydown: (e) => {
							if (e.key === "Enter" && e.shiftKey) {
								e.preventDefault();
								handleAddNote();
							}
						},
					}),
					h(
						"div",
						{ className: "add-note-form-actions" },
						h(
							"button",
							{
								type: "submit",
								className: "action-btn primary-btn",
							},
							I18n.t("modals.notes.addButton")
						)
					)
				)
			)
		);
	};

	const showValidationError = (element, message) => {
		// Remove existing error
		const existingError = element.parentNode.querySelector(".validation-error");
		if (existingError) {
			existingError.remove();
		}

		// Add error message
		const errorElement = h(
			"div",
			{
				className: "validation-error",
			},
			message
		);

		element.parentNode.appendChild(errorElement);
		element.focus();

		// Remove error after 3 seconds
		setTimeout(() => {
			if (errorElement.parentNode) {
				errorElement.remove();
			}
		}, 3000);
	};

	return h(
		"div",
		{
			className: "modal-overlay",
			onclick: (e) => e.target === e.currentTarget && onClose(),
		},
		h(
			"div",
			{ className: "modal" },
			h(
				"div",
				{ className: "modal-header" },
				h(
					"h3",
					{ className: "modal-title" },
					I18n.t("modals.notes.title", { position: job.position, company: job.company })
				),
				h("button", { className: "modal-close", onclick: onClose }, "Ã—")
			),
			h(
				"div",
				{ className: "modal-body" },
				createNotesContent(job, sortedActiveNotes, sortedArchivedNotes)
			)
		)
	);
};

// ============================================================================
// NOTES MANAGEMENT FUNCTIONS  
// ============================================================================

// Simple note editing system
const enableNoteEditing = (note, job) => {
	const noteRow = document.querySelector(`[data-note-id="${note.id}"]`);
	if (!noteRow) return;

	// Replace entire row with editing structure
	noteRow.innerHTML = `
		<td class="note-date-cell">${formatDate(note.date)}</td>
		<td class="note-phase-cell">${I18n.t("phases." + note.phase)}</td>
		<td class="note-text-cell">
			<textarea class="note-edit-textarea" rows="2" placeholder="${I18n.t('modals.notes.placeholder')}">${note.text || ''}</textarea>
		</td>
		<td class="notes-table-actions">
			<button class="action-btn save-note-btn icon-btn-transparent" title="${I18n.t('modals.common.save')}">
				<span class="material-symbols-outlined icon-14">check</span>
			</button>
			<button class="action-btn cancel-note-btn icon-btn-transparent" title="${I18n.t('modals.common.cancel')}">
				<span class="material-symbols-outlined icon-14">close</span>
			</button>
		</td>
	`;

	// Add event listeners
	const saveBtn = noteRow.querySelector('.save-note-btn');
	const cancelBtn = noteRow.querySelector('.cancel-note-btn');
	const textarea = noteRow.querySelector('.note-edit-textarea');

	saveBtn.onclick = () => saveNoteEdits(note, job);
	cancelBtn.onclick = () => cancelNoteEdits(note, job);

	// Add Shift+Enter support
	textarea.onkeydown = (e) => {
		if (e.key === "Enter" && e.shiftKey) {
			e.preventDefault();
			saveNoteEdits(note, job);
		}
	};

	// Focus textarea
	textarea.focus();
	textarea.select();
};

const saveNoteEdits = (note, job) => {
	const noteRow = document.querySelector(`[data-note-id="${note.id}"]`);
	if (!noteRow) return;

	const textarea = noteRow.querySelector('.note-edit-textarea');
	const newText = textarea.value.trim();

	if (!newText) {
		alert('Note text is required');
		return;
	}

	// Update data
	const jobIndex = jobsData.findIndex(j => j.id === job.id);
	const noteIndex = jobsData[jobIndex].notes.findIndex(n => n.id === note.id);

	jobsData[jobIndex].notes[noteIndex].text = newText;

	// Save and refresh in place (no flicker!)
	saveToLocalStorage();
	refreshNotesModal(job);
	refreshInterface();
};

const cancelNoteEdits = (note, job) => {
	// Refresh modal to restore original content (no flicker!)
	refreshNotesModal(job);
};

// Create notes content for modal
const createNotesContent = (job, sortedActiveNotes, sortedArchivedNotes) => {
	return h(
		"div",
		{},
		// Active notes table
		sortedActiveNotes.length > 0
			? h(
					"div",
					{ className: "notes-table-container" },
					h(
						"table",
						{ className: "notes-table" },
						h(
							"thead",
							{},
							h(
								"tr",
								{},
								h("th", {}, "Phase"),
								h("th", {}, "Date"),
								h("th", {}, "Note"),
								h("th", {}, "Actions")
							)
						),
						h(
							"tbody",
							{},
							...sortedActiveNotes.map((note) =>
								h(
									"tr",
									{ key: note.id, "data-note-id": note.id },
									h("td", { className: "note-phase-cell" }, getPhaseText(note.phase)),
									h("td", { className: "note-date-cell" }, formatDate(note.date)),
									h("td", { className: "note-text-cell" }, note.text),
									h(
										"td",
										{ className: "notes-table-actions" },
										h("button", {
											className: "action-btn edit-note-btn icon-btn-transparent",
											title: I18n.t("modals.notes.editTitle"),
											innerHTML: '<span class="material-symbols-outlined icon-14">edit</span>',
											onclick: () => enableNoteEditing(note, job),
										}),
										h("button", {
											className: "action-btn archive-btn icon-btn-transparent",
											title: I18n.t("modals.notes.archiveTitle"),
											innerHTML: '<span class="material-symbols-outlined icon-14">archive</span>',
											onclick: () => archiveNote(note, job),
										})
									)
								)
							)
						)
					)
				)
			: h("p", { className: "modal-empty-message" }, I18n.t("modals.notes.emptyState")),

		// Archived notes section
		sortedArchivedNotes.length > 0
			? h(
					"div",
					{ className: "archived-notes-section" },
					h(
						"h4",
						{
							className: "notes-archived-header",
							onclick: () => {
								const archivedTable = document.getElementById("archived-notes-table");
								const expandIcon = document.getElementById("archived-notes-icon");
								if (archivedTable.style.display === "none") {
									archivedTable.style.display = "table";
									expandIcon.textContent = "expand_less";
								} else {
									archivedTable.style.display = "none";
									expandIcon.textContent = "expand_more";
								}
							},
						},
						h(
							"span",
							{
								className: "material-symbols-outlined expand-icon",
								id: "archived-notes-icon",
							},
							"expand_more"
						),
						I18n.t("modals.notes.archivedSection", { count: sortedArchivedNotes.length })
					),
					h(
						"table",
						{
							id: "archived-notes-table",
							className: "notes-table archived",
							style: "display: none",
						},
						h(
							"thead",
							{},
							h(
								"tr",
								{},
								h("th", {}, "Phase"),
								h("th", {}, "Date"),
								h("th", {}, "Note"),
								h("th", {}, "Actions")
							)
						),
						h(
							"tbody",
							{},
							...sortedArchivedNotes.map((note) =>
								h(
									"tr",
									{ key: note.id },
									h("td", {}, getPhaseText(note.phase)),
									h("td", {}, formatDate(note.date)),
									h("td", {}, note.text),
									h(
										"td",
										{ className: "notes-table-actions" },
										h("button", {
											className: "action-btn archive-btn icon-btn-transparent",
											title: I18n.t("modals.notes.unarchiveTitle"),
											innerHTML:
												'<span class="material-symbols-outlined icon-14">unarchive</span>',
											onclick: () => archiveNote(note, job),
										})
									)
								)
							)
						)
					)
				)
			: null,

		// Add note form
		h(
			"div",
			{ className: "add-note-row" },
			h("h4", { className: "add-note-title" }, I18n.t("modals.notes.addSection")),
			h(
				"form",
				{
					className: "add-note-form",
					onsubmit: (e) => {
						e.preventDefault();
						handleAddNote();
					}
				},
				h("textarea", {
					className: "add-note-textarea",
					placeholder: I18n.t("modals.notes.placeholder"),
					rows: 2,
					onkeydown: (e) => {
						if (e.key === "Enter" && e.shiftKey) {
							e.preventDefault();
							handleAddNote();
						}
					},
				}),
				h(
					"div",
					{ className: "add-note-form-actions" },
					h(
						"button",
						{
							type: "submit",
							className: "action-btn primary-btn",
						},
						I18n.t("modals.notes.addButton")
					)
				)
			)
		)
	);
};

// Refresh notes modal content
const refreshNotesModal = (job) => {
	const modalBody = document.querySelector(".modal-body");
	if (!modalBody) return;

	// Get updated data
	const jobIndex = jobsData.findIndex((j) => j.id === job.id);
	if (jobIndex === -1) return;

	job.notes = jobsData[jobIndex].notes || [];
	const notes = job.notes;
	const activeNotes = notes.filter((note) => !note.archived);
	const archivedNotes = notes.filter((note) => note.archived);
	const sortedActiveNotes = [...activeNotes].sort((a, b) => new Date(a.date) - new Date(b.date));
	const sortedArchivedNotes = [...archivedNotes].sort(
		(a, b) => new Date(a.date) - new Date(b.date)
	);

	// Recreate modal body content  
	modalBody.innerHTML = "";
	modalBody.appendChild(createNotesContent(job, sortedActiveNotes, sortedArchivedNotes));
};

// Open unified notes modal (for both viewing and adding notes)
const openNotesModal = (job) => {
	const modal = NotesModal({
		job,
		onClose: closeModal,
	});

	document.body.appendChild(modal);

	// Scroll to bottom to show the add note form
	setTimeout(() => {
		const modalBody = modal.querySelector(".modal-body");
		if (modalBody) {
			modalBody.scrollTop = modalBody.scrollHeight;
		}
	}, 50);
};

// Alias for backward compatibility
const openAddNoteModal = openNotesModal;

// Make note components and functions available globally
window.NotesCount = NotesCount;
window.NoteItem = NoteItem;
window.NotesModal = NotesModal;
window.openNotesModal = openNotesModal;
window.openAddNoteModal = openAddNoteModal;
window.enableNoteEditing = enableNoteEditing;
window.saveNoteEdits = saveNoteEdits;
window.cancelNoteEdits = cancelNoteEdits;
window.createNotesContent = createNotesContent;
window.refreshNotesModal = refreshNotesModal;


// ============================================================================
// SRC/COMPONENTS/TASKS.JS
// ============================================================================

// ============================================================================
// TASKS SYSTEM COMPONENTS
// ============================================================================

// Tasks count display component with colored counters
const TasksCount = ({ tasks = [], onClick }) => {
	const activeTasks = tasks.filter((task) => !task.archived);
	const todoCount = activeTasks.filter((task) => task.status === "todo").length;
	const inProgressCount = activeTasks.filter((task) => task.status === "in-progress").length;
	const doneCount = activeTasks.filter((task) => task.status === "done").length;
	const totalActiveCount = activeTasks.length;
	const archivedCount = tasks.length - totalActiveCount;

	const className = totalActiveCount === 0 ? "tasks-count zero" : "tasks-count";

	return h(
		"span",
		{
			className,
			onclick: onClick, // Always allow clicks to open modal
			title: `${totalActiveCount} active task${totalActiveCount !== 1 ? "s" : ""} (${todoCount} todo, ${inProgressCount} in progress, ${doneCount} done)${archivedCount > 0 ? ` + ${archivedCount} archived` : ""}`,
		},
		h("span", { className: "task-count-todo" }, todoCount.toString()),
		h("span", { className: "task-count-separator" }, "/"),
		h("span", { className: "task-count-in-progress" }, inProgressCount.toString()),
		h("span", { className: "task-count-separator" }, "/"),
		h("span", { className: "task-count-done" }, doneCount.toString())
	);
};

// Individual task item component
const TaskItem = ({ task, job }) => {
	const isArchived = task.archived || false;

	const handleArchiveToggle = () => {
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		const taskIndex = jobsData[jobIndex].tasks.findIndex((t) => t.id === task.id);
		if (taskIndex === -1) return;

		jobsData[jobIndex].tasks[taskIndex].archived = !isArchived;
		saveToLocalStorage();

		// Update the task element in place
		const taskElement = document.querySelector(`[data-task-id="${task.id}"]`);
		if (taskElement) {
			const newArchiveStatus = !isArchived;
			taskElement.style.opacity = newArchiveStatus ? "0.6" : "1";
			taskElement.style.filter = newArchiveStatus ? "grayscale(0.5)" : "none";
			taskElement.className = `task-item ${newArchiveStatus ? "archived" : ""}`;

			// Update archive button
			const archiveBtn = taskElement.querySelector(".archive-btn");
			if (archiveBtn) {
				archiveBtn.innerHTML = `<span class="material-symbols-outlined icon-14">${newArchiveStatus ? "unarchive" : "archive"}</span>`;
			}
		}

		// Update interface
		refreshInterface();
	};

	const handleStatusChange = (newStatus) => {
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		const taskIndex = jobsData[jobIndex].tasks.findIndex((t) => t.id === task.id);
		if (taskIndex === -1) return;

		jobsData[jobIndex].tasks[taskIndex].status = newStatus;
		saveToLocalStorage();

		// Update status element in place
		const statusElement = document.querySelector(`[data-task-id="${task.id}"] .task-status`);
		if (statusElement) {
			statusElement.className = `task-status status-${newStatus}`;
			statusElement.textContent = getTaskStatusText(newStatus);
		}

		// Update interface
		refreshInterface();
	};

	const handlePriorityChange = (newPriority) => {
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		const taskIndex = jobsData[jobIndex].tasks.findIndex((t) => t.id === task.id);
		if (taskIndex === -1) return;

		jobsData[jobIndex].tasks[taskIndex].priority = newPriority;
		saveToLocalStorage();

		// Update priority element in place
		const priorityElement = document.querySelector(`[data-task-id="${task.id}"] .task-priority`);
		if (priorityElement) {
			priorityElement.className = `task-priority priority-${newPriority}`;
			priorityElement.textContent = getPriorityText(newPriority);
		}

		// Update interface
		refreshInterface();
	};

	const handleDueDateChange = (newDueDate) => {
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		const taskIndex = jobsData[jobIndex].tasks.findIndex((t) => t.id === task.id);
		if (taskIndex === -1) return;

		jobsData[jobIndex].tasks[taskIndex].dueDate = newDueDate;
		saveToLocalStorage();

		// Update due date element in place
		const dueDateElement = document.querySelector(`[data-task-id="${task.id}"] .task-due-date`);
		if (dueDateElement) {
			dueDateElement.textContent = newDueDate ? formatDate(newDueDate) : "No due date";
		}

		// Update interface
		refreshInterface();
	};

	const handleEdit = () => {
		const taskTextElement = document.querySelector(`[data-task-id="${task.id}"] .task-text`);
		if (!taskTextElement) return;

		const currentText = task.text;
		const textarea = h("textarea", {
			className: "task-edit-textarea",
			textContent: currentText,
		});

		const saveBtn = h("button", {
			className: "action-btn edit-btn edit-save-btn",
			textContent: I18n.t("modals.common.save"),
			onclick: () => {
				const newText = textarea.value.trim();
				if (!newText) return;

				const jobIndex = jobsData.findIndex((j) => j.id === job.id);
				if (jobIndex === -1) return;

				const taskIndex = jobsData[jobIndex].tasks.findIndex((t) => t.id === task.id);
				if (taskIndex === -1) return;

				jobsData[jobIndex].tasks[taskIndex].text = newText;
				saveToLocalStorage();

				// Update in place - replace textarea with new text
				taskTextElement.innerHTML = "";
				taskTextElement.textContent = newText;

				// Update interface
				refreshInterface();
			},
		});

		const cancelBtn = h("button", {
			className: "action-btn cancel-btn edit-cancel-btn",
			textContent: I18n.t("modals.common.cancel"),
			onclick: () => {
				// Cancel editing - restore original text
				taskTextElement.innerHTML = "";
				taskTextElement.textContent = task.text;
			},
		});

		taskTextElement.innerHTML = "";
		taskTextElement.appendChild(textarea);
		taskTextElement.appendChild(h("div", {}, saveBtn, cancelBtn));
		textarea.focus();
	};

	return h(
		"div",
		{
			className: `task-item ${isArchived ? "archived" : ""}`,
			"data-task-id": task.id,
		},
		h(
			"div",
			{
				className: "task-header task-header-layout",
			},
			h(
				"div",
				{ className: "task-controls-row" },
				h(
					"select",
					{
						className: "task-status inline-select",
						value: task.status,
						onchange: (e) => handleStatusChange(e.target.value),
					},
					h("option", { value: "todo" }, I18n.t("modals.tasks.statusTodo")),
					h("option", { value: "in-progress" }, I18n.t("modals.tasks.statusInProgress")),
					h("option", { value: "done" }, I18n.t("modals.tasks.statusDone"))
				),
				h(
					"select",
					{
						className: "task-priority inline-select",
						value: task.priority,
						onchange: (e) => handlePriorityChange(e.target.value),
					},
					h("option", { value: "low" }, I18n.t("modals.tasks.priorityLow")),
					h("option", { value: "medium" }, I18n.t("modals.tasks.priorityMedium")),
					h("option", { value: "high" }, I18n.t("modals.tasks.priorityHigh"))
				),
				h("input", {
					type: "date",
					className: "task-due-date inline-input",
					value: task.dueDate ? task.dueDate.split("T")[0] : "",
					onchange: (e) =>
						handleDueDateChange(e.target.value ? `${e.target.value}T00:00:00.000Z` : null),
				})
			),
			h(
				"div",
				{ className: "task-actions modal-actions-row" },
				h("button", {
					className: "action-btn edit-task-btn icon-btn-transparent",
					title: I18n.t("modals.tasks.editTitle"),
					innerHTML: '<span class="material-symbols-outlined icon-14">edit</span>',
					onclick: handleEdit,
				}),
				h("button", {
					className: "action-btn archive-btn icon-btn-transparent",
					title: isArchived
						? I18n.t("modals.tasks.unarchiveTitle")
						: I18n.t("modals.tasks.archiveTitle"),
					innerHTML: `<span class="material-symbols-outlined icon-14">${isArchived ? "unarchive" : "archive"}</span>`,
					onclick: handleArchiveToggle,
				})
			)
		),
		h(
			"div",
			{
				className: "task-text",
			},
			task.text
		)
	);
};

// Unified modal component for viewing and adding tasks
const TasksModal = ({ job, onClose }) => {
	const tasks = job.tasks || [];
	const activeTasks = tasks.filter((task) => !task.archived);
	const archivedTasks = tasks.filter((task) => task.archived);
	const sortedActiveTasks = [...activeTasks].sort(
		(a, b) => new Date(a.createdDate || a.date) - new Date(b.createdDate || b.date)
	);
	const sortedArchivedTasks = [...archivedTasks].sort(
		(a, b) => new Date(a.createdDate || a.date) - new Date(b.createdDate || b.date)
	);

	const handleAddTask = () => {
		const textarea = document.querySelector(".add-task-textarea");
		const statusSelect = document.querySelector(".add-task-status");
		const prioritySelect = document.querySelector(".add-task-priority");
		const dueDateInput = document.querySelector(".add-task-due-date");
		const durationSelect = document.querySelector(".add-task-duration");
		const taskText = textarea.value.trim();

		if (!taskText) {
			// Show error message instead of alert
			showValidationError(textarea, "Task text is required");
			return;
		}

		const newTask = {
			id: Date.now(),
			createdDate: new Date().toISOString(),
			text: taskText,
			status: statusSelect.value || "todo",
			priority: prioritySelect.value || "medium",
			dueDate: dueDateInput.value ? `${dueDateInput.value}T00:00:00.000Z` : null,
			duration: durationSelect.value || null,
		};

		// Add task to job data
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		if (!jobsData[jobIndex].tasks) {
			jobsData[jobIndex].tasks = [];
		}

		jobsData[jobIndex].tasks.push(newTask);
		saveToLocalStorage();

		// Update the job object for this modal
		job.tasks = jobsData[jobIndex].tasks;

		// Refresh modal without flicker
		refreshTasksModal(job);

		// Clear the form
		textarea.value = "";
		statusSelect.value = "todo";
		prioritySelect.value = "medium";
		dueDateInput.value = "";
		durationSelect.value = "";

		// Focus back to the first field (status select)
		statusSelect.focus();

		// Update the tasks count in the table (refresh interface for count update)
		refreshInterface();
	};

	const enableTaskEditing = (task, job) => {
		const taskElement = document.querySelector(`[data-task-id="${task.id}"]`);
		if (!taskElement) return;

		const taskRow = taskElement.closest("tr");
		if (!taskRow) return;

		// Store original state
		taskRow.dataset.editing = "true";

		// Replace status display with select
		const statusDisplay = taskRow.querySelector(".task-status-display");
		const statusSelect = h(
			"select",
			{
				className: "task-status-edit",
				value: task.status,
			},
			h("option", { value: "todo" }, I18n.t("modals.tasks.statusTodo")),
			h("option", { value: "in-progress" }, I18n.t("modals.tasks.statusInProgress")),
			h("option", { value: "done" }, I18n.t("modals.tasks.statusDone"))
		);
		statusDisplay.parentNode.replaceChild(statusSelect, statusDisplay);

		// Replace priority display with select
		const priorityDisplay = taskRow.querySelector(".task-priority-display");
		const prioritySelect = h(
			"select",
			{
				className: "task-priority-edit",
				value: task.priority,
			},
			h("option", { value: "low" }, I18n.t("modals.tasks.priorityLow")),
			h("option", { value: "medium" }, I18n.t("modals.tasks.priorityMedium")),
			h("option", { value: "high" }, I18n.t("modals.tasks.priorityHigh"))
		);
		priorityDisplay.parentNode.replaceChild(prioritySelect, priorityDisplay);

		// Replace due date display with input
		const dueDateDisplay = taskRow.querySelector(".task-due-date-display");
		const currentDate = task.dueDate ? task.dueDate.split("T")[0] : "";
		const dateInput = h("input", {
			type: "date",
			value: currentDate,
			className: "task-due-date-edit",
		});
		dueDateDisplay.parentNode.replaceChild(dateInput, dueDateDisplay);

		// Replace duration display with select
		const durationDisplay = taskRow.querySelector(".task-duration-display");
		const durationSelect = h(
			"select",
			{
				className: "task-duration-edit",
			},
			h("option", { value: "", selected: !task.duration }, "â€”"),
			h("option", { value: "15min", selected: task.duration === "15min" }, "15 min"),
			h("option", { value: "30min", selected: task.duration === "30min" }, "30 min"),
			h("option", { value: "1h", selected: task.duration === "1h" }, "1h"),
			h("option", { value: "1h30", selected: task.duration === "1h30" }, "1:30"),
			h("option", { value: "2h", selected: task.duration === "2h" }, "2h"),
			h("option", { value: "3h", selected: task.duration === "3h" }, "3h")
		);
		durationDisplay.parentNode.replaceChild(durationSelect, durationDisplay);

		// Update edit button to save and add cancel button
		const editBtn = taskRow.querySelector(".edit-task-btn");
		editBtn.innerHTML = '<span class="material-symbols-outlined icon-14">check</span>';
		editBtn.title = I18n.t("modals.common.save");
		editBtn.onclick = () => saveTaskChanges(task, job);
		
		// Add cancel button next to save button
		const actionsCell = taskRow.querySelector(".tasks-table-actions");
		const cancelBtn = h("button", {
			className: "action-btn cancel-btn icon-btn-transparent",
			title: I18n.t("modals.common.cancel"),
			innerHTML: '<span class="material-symbols-outlined icon-14">close</span>',
			onclick: () => disableTaskEditing(task, job)
		});
		actionsCell.appendChild(cancelBtn);

		// Make task text editable
		const taskTextRow = taskRow.nextElementSibling;
		const taskTextCell = taskTextRow?.querySelector(".task-text-cell");
		if (taskTextCell) {
			const currentText = task.text || "";
			const textarea = document.createElement("textarea");
			textarea.value = currentText;
			textarea.className = "task-text-edit";
			textarea.rows = 2;
			textarea.style.width = "100%";
			textarea.style.resize = "vertical";
			
			// Add better event handling
			textarea.addEventListener("input", (e) => {
				// Store the current value in a data attribute for later retrieval
				textarea.dataset.currentValue = e.target.value;
			});
			
			// Add keyboard shortcuts
			textarea.addEventListener("keydown", (e) => {
				if (e.key === "Enter" && e.ctrlKey) {
					e.preventDefault();
					saveTaskChanges(task, job);
				} else if (e.key === "Escape") {
					e.preventDefault();
					disableTaskEditing(task, job);
				}
			});
			
			taskTextCell.innerHTML = "";
			taskTextCell.appendChild(textarea);
			textarea.focus();
			textarea.select(); // Select all text for easy editing

			// Store reference to textarea for saving
			taskRow.dataset.textarea = "true";
			taskTextRow.dataset.textEditing = "true";
		}
	};

	const saveTaskChanges = (task, job) => {
		// Get all form values before refreshing the modal
		const taskElement = document.querySelector(`[data-task-id="${task.id}"]`);
		if (!taskElement) return;

		const taskRow = taskElement.closest("tr");
		const textRow = taskRow?.nextElementSibling;
		
		// Get all the form values
		const statusSelect = taskRow?.querySelector(".task-status-edit");
		const prioritySelect = taskRow?.querySelector(".task-priority-edit");
		const dueDateInput = taskRow?.querySelector(".task-due-date-edit");
		const durationSelect = taskRow?.querySelector(".task-duration-edit");
		const textarea = textRow?.querySelector(".task-text-edit");
		
		// Validate task text
		if (textarea) {
			const newText = textarea.value.trim();
			if (!newText) {
				showValidationError(textarea, "Task description is required");
				return; // Don't refresh modal yet, let user fix the error
			}
		}
		
		// Update all fields in the data
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		const taskIndex = jobsData[jobIndex].tasks.findIndex((t) => t.id === task.id);
		if (taskIndex === -1) return;

		// Update each field if the input exists
		if (statusSelect) {
			jobsData[jobIndex].tasks[taskIndex].status = statusSelect.value;
		}
		if (prioritySelect) {
			jobsData[jobIndex].tasks[taskIndex].priority = prioritySelect.value;
		}
		if (dueDateInput) {
			jobsData[jobIndex].tasks[taskIndex].dueDate = dueDateInput.value || null;
		}
		if (durationSelect) {
			jobsData[jobIndex].tasks[taskIndex].duration = durationSelect.value || null;
		}
		if (textarea) {
			jobsData[jobIndex].tasks[taskIndex].text = textarea.value.trim();
		}

		// Save to localStorage
		saveToLocalStorage();

		// Refresh the modal to restore display state
		refreshTasksModal(job);
		
		// Update interface
		refreshInterface();
	};

	const disableTaskEditing = (task, job) => {
		// Just refresh the modal to restore display state
		// No need to find the taskRow since refreshTasksModal will recreate everything
		refreshTasksModal(job);
	};

	const saveTaskText = (task, job, newText, cell) => {
		const trimmedText = newText.trim();

		if (!trimmedText) {
			showValidationError(cell, "Task text is required");
			return;
		}

		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		const taskIndex = jobsData[jobIndex].tasks.findIndex((t) => t.id === task.id);
		if (taskIndex === -1) return;

		// Update the data
		jobsData[jobIndex].tasks[taskIndex].text = trimmedText;
		saveToLocalStorage();

		// Update the cell display
		restoreTaskCell(jobsData[jobIndex].tasks[taskIndex], cell);

		// Update interface
		refreshInterface();
	};

	const updateTaskText = (task, job, newText) => {
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		const taskIndex = jobsData[jobIndex].tasks.findIndex((t) => t.id === task.id);
		if (taskIndex === -1) return;

		// Update the data (newText is already trimmed from calling function)
		jobsData[jobIndex].tasks[taskIndex].text = newText;
		saveToLocalStorage();

		// Update interface
		refreshInterface();
	};

	const updateTaskDueDate = (task, job, newDate) => {
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		const taskIndex = jobsData[jobIndex].tasks.findIndex((t) => t.id === task.id);
		if (taskIndex === -1) return;

		// Update the data
		jobsData[jobIndex].tasks[taskIndex].dueDate = newDate ? `${newDate}T00:00:00.000Z` : null;
		saveToLocalStorage();

		// Update interface
		refreshInterface();
	};

	const updateTaskDuration = (task, job, newDuration) => {
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		const taskIndex = jobsData[jobIndex].tasks.findIndex((t) => t.id === task.id);
		if (taskIndex === -1) return;

		// Update the data
		jobsData[jobIndex].tasks[taskIndex].duration = newDuration || null;
		saveToLocalStorage();

		// Update interface
		refreshInterface();
	};

	const formatDuration = (duration) => {
		if (!duration) return "â€”";

		// Map duration values to display text
		const durationMap = {
			"15min": "15 min",
			"30min": "30 min",
			"1h": "1h",
			"1h30": "1:30",
			"2h": "2h",
			"3h": "3h",
		};

		return durationMap[duration] || duration;
	};

	const archiveTask = (task, job) => {
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		const taskIndex = jobsData[jobIndex].tasks.findIndex((t) => t.id === task.id);
		if (taskIndex === -1) return;

		// Store archived section state before refresh
		const archivedTable = document.getElementById("archived-tasks-table");
		const wasExpanded = archivedTable && archivedTable.style.display === "table";

		jobsData[jobIndex].tasks[taskIndex].archived = !task.archived;
		saveToLocalStorage();

		// Refresh modal without flicker
		refreshTasksModal(job);

		// Restore archived section state after refresh
		if (wasExpanded) {
			setTimeout(() => {
				const newArchivedTable = document.getElementById("archived-tasks-table");
				const expandIcon = document.getElementById("archived-tasks-icon");
				if (newArchivedTable) {
					newArchivedTable.style.display = "table";
					if (expandIcon) expandIcon.textContent = "expand_less";
				}
			}, 0);
		}

		// Update interface
		refreshInterface();
	};

	const updateTaskStatus = (task, job, newStatus) => {
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		const taskIndex = jobsData[jobIndex].tasks.findIndex((t) => t.id === task.id);
		if (taskIndex === -1) return;

		jobsData[jobIndex].tasks[taskIndex].status = newStatus;
		saveToLocalStorage();

		// Refresh modal without flicker
		refreshTasksModal(job);

		// Update interface
		refreshInterface();
	};

	const updateTaskPriority = (task, job, newPriority) => {
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		const taskIndex = jobsData[jobIndex].tasks.findIndex((t) => t.id === task.id);
		if (taskIndex === -1) return;

		jobsData[jobIndex].tasks[taskIndex].priority = newPriority;
		saveToLocalStorage();

		// Refresh modal without flicker
		refreshTasksModal(job);

		// Update interface
		refreshInterface();
	};

	const refreshTasksModal = (job) => {
		const modalBody = document.querySelector(".modal-body");
		if (!modalBody) return;

		// Get updated data
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		job.tasks = jobsData[jobIndex].tasks || [];
		const tasks = job.tasks;
		const activeTasks = tasks.filter((task) => !task.archived);
		const archivedTasks = tasks.filter((task) => task.archived);
		const sortedActiveTasks = [...activeTasks].sort(
			(a, b) => new Date(a.createdDate || a.date) - new Date(b.createdDate || b.date)
		);
		const sortedArchivedTasks = [...archivedTasks].sort(
			(a, b) => new Date(a.createdDate || a.date) - new Date(b.createdDate || b.date)
		);

		// Recreate modal body content
		modalBody.innerHTML = "";
		modalBody.appendChild(createTasksContent(job, sortedActiveTasks, sortedArchivedTasks));
	};

	const createTasksContent = (job, sortedActiveTasks, sortedArchivedTasks) => {
		return h(
			"div",
			{},
			// Active tasks table
			sortedActiveTasks.length > 0
				? h(
						"div",
						{ className: "tasks-table-container" },
						h(
							"table",
							{ className: "tasks-table" },
							h(
								"thead",
								{},
								h(
									"tr",
									{},
									h("th", {}, "Status"),
									h("th", {}, "Priority"),
									h("th", {}, "Due Date"),
									h("th", {}, "Duration"),
									h("th", {}, "Actions")
								)
							),
							h(
								"tbody",
								{},
								...sortedActiveTasks.flatMap((task) => [
									h(
										"tr",
										{ key: task.id, className: "task-info-row" },
										h(
											"td",
											{ className: "task-status-cell" },
											h(
												"span",
												{
													className: "task-status-display",
													"data-task-id": task.id,
													"data-field": "status",
												},
												getTaskStatusText(task.status)
											)
										),
										h(
											"td",
											{ className: "task-priority-cell" },
											h(
												"span",
												{
													className: "task-priority-display",
													"data-task-id": task.id,
													"data-field": "priority",
												},
												getPriorityText(task.priority)
											)
										),
										h(
											"td",
											{ className: "task-due-date-cell" },
											h(
												"span",
												{
													className: "task-due-date-display",
													"data-task-id": task.id,
													"data-field": "dueDate",
												},
												task.dueDate ? formatDate(task.dueDate) : "â€”"
											)
										),
										h(
											"td",
											{ className: "task-duration-cell" },
											h(
												"span",
												{
													className: "task-duration-display",
													"data-task-id": task.id,
													"data-field": "duration",
												},
												formatDuration(task.duration)
											)
										),
										h(
											"td",
											{ className: "tasks-table-actions" },
											h("button", {
												className: "action-btn edit-task-btn icon-btn-transparent",
												title: I18n.t("modals.tasks.editTitle"),
												innerHTML: '<span class="material-symbols-outlined icon-14">edit</span>',
												onclick: () => enableTaskEditing(task, job),
											}),
											h("button", {
												className: "action-btn archive-btn icon-btn-transparent",
												title: I18n.t("modals.tasks.archiveTitle"),
												innerHTML: '<span class="material-symbols-outlined icon-14">archive</span>',
												onclick: () => archiveTask(task, job),
											})
										)
									),
									h(
										"tr",
										{ key: `${task.id}-text`, className: "task-text-row" },
										h(
											"td",
											{
												colspan: 5,
												className: "task-text-cell",
											},
											task.text
										)
									),
								])
							)
						)
					)
				: h("p", { className: "modal-empty-message" }, I18n.t("modals.tasks.emptyState")),

			// Archived tasks section
			sortedArchivedTasks.length > 0
				? h(
						"div",
						{ className: "archived-tasks-section" },
						h(
							"h4",
							{
								className: "tasks-archived-header",
								onclick: () => {
									const archivedTable = document.getElementById("archived-tasks-table");
									const expandIcon = document.getElementById("archived-tasks-icon");
									if (archivedTable.style.display === "none") {
										archivedTable.style.display = "table";
										expandIcon.textContent = "expand_less";
									} else {
										archivedTable.style.display = "none";
										expandIcon.textContent = "expand_more";
									}
								},
							},
							h(
								"span",
								{ className: "material-symbols-outlined expand-icon", id: "archived-tasks-icon" },
								"expand_more"
							),
							I18n.t("modals.tasks.archivedSection", { count: sortedArchivedTasks.length })
						),
						h(
							"table",
							{
								id: "archived-tasks-table",
								className: "tasks-table archived",
								style: "display: none",
							},
							h(
								"thead",
								{},
								h(
									"tr",
									{},
									h("th", {}, "Status"),
									h("th", {}, "Priority"),
									h("th", {}, "Task"),
									h("th", {}, "Due Date"),
									h("th", {}, "Actions")
								)
							),
							h(
								"tbody",
								{},
								...sortedArchivedTasks.map((task) =>
									h(
										"tr",
										{ key: task.id },
										h("td", {}, getTaskStatusText(task.status)),
										h("td", {}, getPriorityText(task.priority)),
										h("td", { className: "archived-task-text-cell" }, task.text),
										h("td", {}, task.dueDate ? formatDate(task.dueDate) : "â€”"),
										h(
											"td",
											{ className: "tasks-table-actions" },
											h("button", {
												className: "action-btn archive-btn icon-btn-transparent",
												title: I18n.t("modals.tasks.unarchiveTitle"),
												innerHTML:
													'<span class="material-symbols-outlined icon-14">unarchive</span>',
												onclick: () => archiveTask(task, job),
											})
										)
									)
								)
							)
						)
					)
				: null,

			// Add task form section
			h(
				"div",
				{ className: "add-task-section" },
				h("h4", { className: "add-task-title" }, I18n.t("modals.tasks.addSection")),
				h(
					"form",
					{ 
						className: "add-task-form",
						onsubmit: (e) => {
							e.preventDefault();
							handleAddTask();
						}
					},
					h(
						"div",
						{ className: "add-task-form-row" },
						h(
							"div",
							{ className: "add-task-field" },
							h("label", {}, I18n.t("modals.tasks.status")),
							h(
								"select",
								{
									className: "add-task-status",
									value: "todo",
								},
								h("option", { value: "todo" }, I18n.t("modals.tasks.statusTodo")),
								h("option", { value: "in-progress" }, I18n.t("modals.tasks.statusInProgress")),
								h("option", { value: "done" }, I18n.t("modals.tasks.statusDone"))
							)
						),
						h(
							"div",
							{ className: "add-task-field" },
							h("label", {}, I18n.t("modals.tasks.priority")),
							h(
								"select",
								{
									className: "add-task-priority",
									value: "medium",
								},
								h("option", { value: "low" }, I18n.t("modals.tasks.priorityLow")),
								h("option", { value: "medium" }, I18n.t("modals.tasks.priorityMedium")),
								h("option", { value: "high" }, I18n.t("modals.tasks.priorityHigh"))
							)
						),
						h(
							"div",
							{ className: "add-task-field" },
							h("label", {}, I18n.t("modals.tasks.dueDate")),
							h("input", {
								type: "date",
								className: "add-task-due-date",
							})
						),
						h(
							"div",
							{ className: "add-task-field" },
							h("label", {}, I18n.t("modals.tasks.duration")),
							h(
								"select",
								{
									className: "add-task-duration",
								},
								h("option", { value: "" }, "â€”"),
								h("option", { value: "15min" }, "15 min"),
								h("option", { value: "30min" }, "30 min"),
								h("option", { value: "1h" }, "1h"),
								h("option", { value: "1h30" }, "1:30"),
								h("option", { value: "2h" }, "2h"),
								h("option", { value: "3h" }, "3h")
							)
						)
					),
					h("textarea", {
						className: "add-task-textarea",
						placeholder: I18n.t("modals.tasks.placeholder"),
						rows: 2,
						onkeydown: (e) => {
							if (e.key === "Enter" && e.shiftKey) {
								e.preventDefault();
								handleAddTask();
							}
						},
					}),
					h(
						"div",
						{ className: "add-task-form-actions" },
						h(
							"button",
							{
								type: "submit",
								className: "action-btn primary-btn",
							},
							I18n.t("modals.tasks.addButton")
						)
					)
				)
			)
		);
	};

	const showValidationError = (element, message) => {
		// Remove existing error
		const existingError = element.parentNode.querySelector(".validation-error");
		if (existingError) {
			existingError.remove();
		}

		// Add error message
		const errorElement = h(
			"div",
			{
				className: "validation-error",
			},
			message
		);

		element.parentNode.appendChild(errorElement);
		element.focus();

		// Remove error after 3 seconds
		setTimeout(() => {
			if (errorElement.parentNode) {
				errorElement.remove();
			}
		}, 3000);
	};

	return h(
		"div",
		{
			className: "modal-overlay",
			onclick: (e) => e.target === e.currentTarget && onClose(),
		},
		h(
			"div",
			{ className: "modal" },
			h(
				"div",
				{ className: "modal-header" },
				h(
					"h3",
					{ className: "modal-title" },
					I18n.t("modals.tasks.title", { position: job.position, company: job.company })
				),
				h("button", { className: "modal-close", onclick: onClose }, "Ã—")
			),
			h(
				"div",
				{ className: "modal-body" },
				createTasksContent(job, sortedActiveTasks, sortedArchivedTasks)
			)
		)
	);
};

// Simple task editing system
const enableTaskEditing = (task, job) => {
	const taskRow = document.querySelector(`[data-task-id="${task.id}"]`);
	if (!taskRow) return;

	// Replace entire row with editing structure
	taskRow.innerHTML = `
		<td class="task-status-cell">
			<select class="task-edit-input" data-field="status">
				<option value="todo" ${task.status === 'todo' ? 'selected' : ''}>${I18n.t('modals.tasks.statusTodo')}</option>
				<option value="in-progress" ${task.status === 'in-progress' ? 'selected' : ''}>${I18n.t('modals.tasks.statusInProgress')}</option>
				<option value="done" ${task.status === 'done' ? 'selected' : ''}>${I18n.t('modals.tasks.statusDone')}</option>
			</select>
		</td>
		<td class="task-priority-cell">
			<select class="task-edit-input" data-field="priority">
				<option value="low" ${task.priority === 'low' ? 'selected' : ''}>${I18n.t('modals.tasks.priorityLow')}</option>
				<option value="medium" ${task.priority === 'medium' ? 'selected' : ''}>${I18n.t('modals.tasks.priorityMedium')}</option>
				<option value="high" ${task.priority === 'high' ? 'selected' : ''}>${I18n.t('modals.tasks.priorityHigh')}</option>
			</select>
		</td>
		<td class="task-due-date-cell">
			<input type="date" class="task-edit-input" data-field="dueDate" value="${task.dueDate ? task.dueDate.split('T')[0] : ''}" />
		</td>
		<td class="task-duration-cell">
			<select class="task-edit-input" data-field="duration">
				<option value="" ${!task.duration ? 'selected' : ''}>â€”</option>
				<option value="15min" ${task.duration === '15min' ? 'selected' : ''}>15 min</option>
				<option value="30min" ${task.duration === '30min' ? 'selected' : ''}>30 min</option>
				<option value="1h" ${task.duration === '1h' ? 'selected' : ''}>1h</option>
				<option value="1h30" ${task.duration === '1h30' ? 'selected' : ''}>1:30</option>
				<option value="2h" ${task.duration === '2h' ? 'selected' : ''}>2h</option>
				<option value="3h" ${task.duration === '3h' ? 'selected' : ''}>3h</option>
			</select>
		</td>
		<td class="tasks-table-actions">
			<button class="action-btn save-task-btn icon-btn-transparent" title="${I18n.t('modals.common.save')}">
				<span class="material-symbols-outlined icon-14">check</span>
			</button>
			<button class="action-btn cancel-task-btn icon-btn-transparent" title="${I18n.t('modals.common.cancel')}">
				<span class="material-symbols-outlined icon-14">close</span>
			</button>
		</td>
	`;

	// Find the task text row (next sibling)
	const taskTextRow = taskRow.nextElementSibling;
	if (taskTextRow && taskTextRow.classList.contains('task-text-row')) {
		taskTextRow.innerHTML = `
			<td colspan="5" class="task-text-cell">
				<textarea class="task-text-edit" rows="2" placeholder="${I18n.t('modals.tasks.placeholder')}">${task.text || ''}</textarea>
			</td>
		`;

		// Add Shift+Enter support for textarea
		const textarea = taskTextRow.querySelector('.task-text-edit');
		textarea.onkeydown = (e) => {
			if (e.key === "Enter" && e.shiftKey) {
				e.preventDefault();
				saveTaskEdits(task, job);
			}
		};
	}

	// Add event listeners to buttons
	const saveBtn = taskRow.querySelector('.save-task-btn');
	const cancelBtn = taskRow.querySelector('.cancel-task-btn');

	saveBtn.onclick = () => saveTaskEdits(task, job);
	cancelBtn.onclick = () => cancelTaskEdits(task, job);

	// Focus first input
	const firstInput = taskRow.querySelector('.task-edit-input');
	if (firstInput) firstInput.focus();
};

const saveTaskEdits = (task, job) => {
	const taskRow = document.querySelector(`[data-task-id="${task.id}"]`);
	if (!taskRow) return;

	// Get all input values
	const inputs = taskRow.querySelectorAll('.task-edit-input');
	const newData = {};
	
	inputs.forEach(input => {
		newData[input.dataset.field] = input.value.trim();
	});

	// Get textarea value from task text row
	const taskTextRow = taskRow.nextElementSibling;
	const textarea = taskTextRow?.querySelector('.task-text-edit');
	if (textarea) {
		newData.text = textarea.value.trim();
	}

	// Validation
	if (!newData.text) {
		alert('Task text is required');
		return;
	}

	// Update data
	const jobIndex = jobsData.findIndex(j => j.id === job.id);
	const taskIndex = jobsData[jobIndex].tasks.findIndex(t => t.id === task.id);

	jobsData[jobIndex].tasks[taskIndex].status = newData.status;
	jobsData[jobIndex].tasks[taskIndex].priority = newData.priority;
	jobsData[jobIndex].tasks[taskIndex].dueDate = newData.dueDate ? `${newData.dueDate}T23:59:59.999Z` : null;
	jobsData[jobIndex].tasks[taskIndex].duration = newData.duration || null;
	jobsData[jobIndex].tasks[taskIndex].text = newData.text;

	// Save and refresh in place (no flicker!)
	saveToLocalStorage();
	refreshTasksModal(job);
	refreshInterface();
};

const cancelTaskEdits = (task, job) => {
	// Refresh modal to restore original content (no flicker!)
	refreshTasksModal(job);
};

// Refresh tasks modal content
const refreshTasksModal = (job) => {
	const modalBody = document.querySelector(".modal-body");
	if (!modalBody) return;

	// Get updated data
	const jobIndex = jobsData.findIndex((j) => j.id === job.id);
	if (jobIndex === -1) return;

	job.tasks = jobsData[jobIndex].tasks || [];
	const tasks = job.tasks;
	const activeTasks = tasks.filter((task) => !task.archived);
	const archivedTasks = tasks.filter((task) => task.archived);
	const sortedActiveTasks = [...activeTasks].sort(
		(a, b) => new Date(a.createdDate || a.date) - new Date(b.createdDate || b.date)
	);
	const sortedArchivedTasks = [...archivedTasks].sort(
		(a, b) => new Date(a.createdDate || a.date) - new Date(b.createdDate || b.date)
	);

	// Recreate modal body content
	modalBody.innerHTML = "";
	modalBody.appendChild(createTasksContent(job, sortedActiveTasks, sortedArchivedTasks));
};

// Create tasks content for modal (extracted to fix scope issue)
const createTasksContent = (job, sortedActiveTasks, sortedArchivedTasks) => {
	return h(
		"div",
		{},
		// Active tasks table
		sortedActiveTasks.length > 0
			? h(
					"div",
					{ className: "tasks-table-container" },
					h(
						"table",
						{ className: "tasks-table" },
						h(
							"thead",
							{},
							h(
								"tr",
								{},
								h("th", { className: "status-col" }, I18n.t("modals.tasks.statusHeader")),
								h("th", { className: "priority-col" }, I18n.t("modals.tasks.priorityHeader")),
								h("th", { className: "due-date-col" }, I18n.t("modals.tasks.dueDateHeader")),
								h("th", { className: "duration-col" }, I18n.t("modals.tasks.durationHeader")),
								h("th", { className: "actions-col" }, I18n.t("modals.tasks.actionsHeader"))
							)
						),
						h(
							"tbody",
							{},
							...sortedActiveTasks.flatMap((task) => [
								// Task header row
								h(
									"tr",
									{ key: `${task.id}-header`, "data-task-id": task.id },
									h(
										"td",
										{ className: "task-status-cell" },
										h("span", { className: "task-status-display" }, getTaskStatusText(task.status))
									),
									h(
										"td",
										{ className: "task-priority-cell" },
										h("span", { className: "task-priority-display" }, I18n.t(`modals.tasks.priority${task.priority.charAt(0).toUpperCase() + task.priority.slice(1)}`))
									),
									h(
										"td",
										{ className: "task-due-date-cell" },
										h("span", { className: "task-due-date-display" }, task.dueDate ? formatDate(task.dueDate) : "â€”")
									),
									h(
										"td",
										{ className: "task-duration-cell" },
										h("span", { className: "task-duration-display" }, task.duration || "â€”")
									),
									h(
										"td",
										{ className: "tasks-table-actions" },
										h("button", {
											className: "action-btn edit-task-btn icon-btn-transparent",
											title: I18n.t("modals.tasks.editTitle"),
											innerHTML: '<span class="material-symbols-outlined icon-14">edit</span>',
											onclick: () => enableTaskEditing(task, job),
										}),
										h("button", {
											className: "action-btn archive-btn icon-btn-transparent",
											title: I18n.t("modals.tasks.archiveTitle"),
											innerHTML: '<span class="material-symbols-outlined icon-14">archive</span>',
											onclick: () => archiveTask(task, job),
										})
									)
								),
								// Task text row
								h(
									"tr",
									{ key: `${task.id}-text`, className: "task-text-row" },
									h("td", { colspan: 5, className: "task-text-cell" }, task.text)
								),
							])
						)
					)
				)
			: h("p", { className: "modal-empty-message" }, I18n.t("modals.tasks.emptyState")),

		// Archived tasks section
		sortedArchivedTasks.length > 0
			? h(
					"div",
					{ className: "archived-tasks-section" },
					h(
						"h4",
						{
							className: "tasks-archived-header",
							onclick: () => {
								const archivedTable = document.getElementById("archived-tasks-table");
								const expandIcon = document.getElementById("archived-tasks-icon");
								if (archivedTable.style.display === "none") {
									archivedTable.style.display = "table";
									expandIcon.textContent = "expand_less";
								} else {
									archivedTable.style.display = "none";
									expandIcon.textContent = "expand_more";
								}
							},
						},
						h(
							"span",
							{
								className: "material-symbols-outlined expand-icon",
								id: "archived-tasks-icon",
							},
							"expand_more"
						),
						I18n.t("modals.tasks.archivedSection", { count: sortedArchivedTasks.length })
					),
					h(
						"table",
						{
							id: "archived-tasks-table",
							className: "tasks-table archived",
							style: "display: none",
						},
						h(
							"thead",
							{},
							h(
								"tr",
								{},
								h("th", { className: "status-col" }, I18n.t("modals.tasks.statusHeader")),
								h("th", { className: "priority-col" }, I18n.t("modals.tasks.priorityHeader")),
								h("th", { className: "due-date-col" }, I18n.t("modals.tasks.dueDateHeader")),
								h("th", { className: "duration-col" }, I18n.t("modals.tasks.durationHeader")),
								h("th", { className: "actions-col" }, I18n.t("modals.tasks.actionsHeader"))
							)
						),
						h(
							"tbody",
							{},
							...sortedArchivedTasks.flatMap((task) => [
								h(
									"tr",
									{ key: `${task.id}-header` },
									h("td", {}, getTaskStatusText(task.status)),
									h("td", {}, I18n.t(`modals.tasks.priority${task.priority.charAt(0).toUpperCase() + task.priority.slice(1)}`)),
									h("td", {}, task.dueDate ? formatDate(task.dueDate) : "â€”"),
									h("td", {}, task.duration || "â€”"),
									h(
										"td",
										{ className: "tasks-table-actions" },
										h("button", {
											className: "action-btn archive-btn icon-btn-transparent",
											title: I18n.t("modals.tasks.unarchiveTitle"),
											innerHTML: '<span class="material-symbols-outlined icon-14">unarchive</span>',
											onclick: () => archiveTask(task, job),
										})
									)
								),
								h(
									"tr",
									{ key: `${task.id}-text`, className: "task-text-row" },
									h("td", { colspan: 5 }, task.text)
								),
							])
						)
					)
				)
			: null,

		// Add task form
		h(
			"div",
			{ className: "add-task-row" },
			h("h4", { className: "add-task-title" }, I18n.t("modals.tasks.addSection")),
			h(
				"form",
				{
					className: "add-task-form",
					onsubmit: (e) => {
						e.preventDefault();
						handleAddTask();
					}
				},
				h(
					"div",
					{ className: "task-form-grid" },
					h(
						"select",
						{
							className: "add-task-status",
							title: I18n.t("modals.tasks.statusHeader"),
						},
						h("option", { value: "todo" }, I18n.t("modals.tasks.statusTodo")),
						h("option", { value: "in-progress" }, I18n.t("modals.tasks.statusInProgress")),
						h("option", { value: "done" }, I18n.t("modals.tasks.statusDone"))
					),
					h(
						"select",
						{
							className: "add-task-priority",
							title: I18n.t("modals.tasks.priorityHeader"),
						},
						h("option", { value: "low" }, I18n.t("modals.tasks.priorityLow")),
						h("option", { value: "medium", selected: true }, I18n.t("modals.tasks.priorityMedium")),
						h("option", { value: "high" }, I18n.t("modals.tasks.priorityHigh"))
					),
					h("input", {
						type: "date",
						className: "add-task-due-date",
						title: I18n.t("modals.tasks.dueDateHeader"),
					}),
					h(
						"select",
						{
							className: "add-task-duration",
							title: I18n.t("modals.tasks.durationHeader"),
						},
						h("option", { value: "" }, "â€”"),
						h("option", { value: "15min" }, "15 min"),
						h("option", { value: "30min" }, "30 min"),
						h("option", { value: "1h" }, "1h"),
						h("option", { value: "1h30" }, "1:30"),
						h("option", { value: "2h" }, "2h"),
						h("option", { value: "3h" }, "3h")
					)
				),
				h("textarea", {
					className: "add-task-textarea",
					placeholder: I18n.t("modals.tasks.placeholder"),
					rows: 2,
					onkeydown: (e) => {
						if (e.key === "Enter" && e.shiftKey) {
							e.preventDefault();
							handleAddTask();
						}
					},
				}),
				h(
					"div",
					{ className: "add-task-form-actions" },
					h(
						"button",
						{
							type: "submit",
							className: "action-btn primary-btn",
						},
						I18n.t("modals.tasks.addButton")
					)
				)
			)
		)
	);
};

// Open unified tasks modal
const openTasksModal = (job) => {
	const modal = TasksModal({
		job,
		onClose: closeModal,
	});
	document.body.appendChild(modal);
};

// Alias for backward compatibility
const openAddTaskModal = openTasksModal;

// Make task components and functions available globally
window.TasksCount = TasksCount;
window.TaskItem = TaskItem;
window.TasksModal = TasksModal;
window.openTasksModal = openTasksModal;
window.openAddTaskModal = openAddTaskModal;
window.enableTaskEditing = enableTaskEditing;
window.saveTaskEdits = saveTaskEdits;
window.cancelTaskEdits = cancelTaskEdits;
window.refreshTasksModal = refreshTasksModal;
window.createTasksContent = createTasksContent;


// ============================================================================
// SRC/COMPONENTS/CONTACTS.JS
// ============================================================================

// ============================================================================
// CONTACTS SYSTEM COMPONENTS
// ============================================================================

// Contacts count display component
const ContactsCount = ({ contacts = [], onClick }) => {
	const activeContacts = contacts.filter((contact) => !contact.archived);
	const count = activeContacts.length;
	const className = count === 0 ? "contacts-count zero" : "contacts-count";

	return h("span", {
		className,
		onclick: onClick, // Always allow clicks to open modal
		textContent: count.toString(),
		title: `${count} contact${count !== 1 ? "s" : ""}${contacts.length !== count ? ` (${contacts.length - count} archived)` : ""}`,
	});
};

// Individual contact item component
const ContactItem = ({ contact, job }) => {
	const isArchived = contact.archived || false;

	const handleArchiveToggle = () => {
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		const contactIndex = jobsData[jobIndex].contacts.findIndex((c) => c.id === contact.id);
		if (contactIndex === -1) return;

		jobsData[jobIndex].contacts[contactIndex].archived = !isArchived;
		saveToLocalStorage();

		// Update the contact element in place
		const contactElement = document.querySelector(`[data-contact-id="${contact.id}"]`);
		if (contactElement) {
			const newArchiveStatus = !isArchived;
			contactElement.style.opacity = newArchiveStatus ? "0.6" : "1";
			contactElement.style.filter = newArchiveStatus ? "grayscale(0.5)" : "none";
			contactElement.className = `contact-item ${newArchiveStatus ? "archived" : ""}`;

			// Update archive button
			const archiveBtn = contactElement.querySelector(".archive-btn");
			if (archiveBtn) {
				archiveBtn.innerHTML = `<span class="material-symbols-outlined icon-14">${newArchiveStatus ? "unarchive" : "archive"}</span>`;
			}
		}

		// Update interface
		refreshInterface();
	};

	const handleEdit = () => {
		const contactInfoElement = document.querySelector(
			`[data-contact-id="${contact.id}"] .contact-info`
		);
		if (!contactInfoElement) return;

		// Create form fields
		const nameInput = h("input", {
			type: "text",
			className: "contact-edit-input",
			value: contact.name || "",
			placeholder: "Name",
		});

		const emailInput = h("input", {
			type: "email",
			className: "contact-edit-input",
			value: contact.email || "",
			placeholder: "Email",
		});

		const phoneInput = h("input", {
			type: "tel",
			className: "contact-edit-input",
			value: contact.phone || "",
			placeholder: "Phone",
		});

		const companyInput = h("input", {
			type: "text",
			className: "contact-edit-input",
			value: contact.company || "",
			placeholder: "Company",
		});

		const saveBtn = h("button", {
			className: "action-btn edit-btn edit-save-btn",
			textContent: I18n.t("modals.common.save"),
			onclick: () => {
				const newName = nameInput.value.trim();
				const newEmail = emailInput.value.trim();
				const newPhone = phoneInput.value.trim();
				const newCompany = companyInput.value.trim();

				if (!newName && !newEmail && !newPhone) return;

				const jobIndex = jobsData.findIndex((j) => j.id === job.id);
				if (jobIndex === -1) return;

				const contactIndex = jobsData[jobIndex].contacts.findIndex((c) => c.id === contact.id);
				if (contactIndex === -1) return;

				jobsData[jobIndex].contacts[contactIndex].name = newName;
				jobsData[jobIndex].contacts[contactIndex].email = newEmail;
				jobsData[jobIndex].contacts[contactIndex].phone = newPhone;
				jobsData[jobIndex].contacts[contactIndex].company = newCompany;
				saveToLocalStorage();

				// Update in place - replace form with new data
				contactInfoElement.innerHTML = "";
				contactInfoElement.appendChild(
					createContactDisplay(jobsData[jobIndex].contacts[contactIndex])
				);

				// Update interface
				refreshInterface();
			},
		});

		const cancelBtn = h("button", {
			className: "action-btn cancel-btn edit-cancel-btn",
			textContent: I18n.t("modals.common.cancel"),
			onclick: () => {
				// Cancel editing - restore original display
				contactInfoElement.innerHTML = "";
				contactInfoElement.appendChild(createContactDisplay(contact));
			},
		});

		const form = h(
			"div",
			{ className: "contact-edit-form" },
			h("div", { className: "contact-form-row" }, nameInput, emailInput),
			h("div", { className: "contact-form-row" }, phoneInput, companyInput),
			h("div", { className: "contact-form-actions" }, saveBtn, cancelBtn)
		);

		contactInfoElement.innerHTML = "";
		contactInfoElement.appendChild(form);
		nameInput.focus();
	};

	const createContactDisplay = (contact) => {
		return h(
			"div",
			{ className: "contact-display" },
			contact.name ? h("div", { className: "contact-name" }, contact.name) : null,
			contact.email
				? h(
						"div",
						{ className: "contact-email" },
						h("a", { href: `mailto:${contact.email}`, className: "contact-link" }, contact.email)
					)
				: null,
			contact.phone
				? h(
						"div",
						{ className: "contact-phone" },
						h("a", { href: `tel:${contact.phone}`, className: "contact-link" }, contact.phone)
					)
				: null,
			contact.company ? h("div", { className: "contact-company" }, contact.company) : null
		);
	};

	return h(
		"div",
		{
			className: `contact-item ${isArchived ? "archived" : ""}`,
			"data-contact-id": contact.id,
		},
		h(
			"div",
			{
				className: "contact-header",
			},
			h(
				"div",
				{ className: "modal-header-content" },
				h("span", { className: "contact-date" }, formatDate(contact.date))
			),
			h(
				"div",
				{ className: "contact-actions modal-actions-row" },
				h("button", {
					className: "action-btn edit-contact-btn icon-btn-transparent",
					title: I18n.t("modals.contacts.editTitle"),
					innerHTML: '<span class="material-symbols-outlined icon-14">edit</span>',
					onclick: handleEdit,
				}),
				h("button", {
					className: "action-btn archive-btn icon-btn-transparent",
					title: isArchived
						? I18n.t("modals.contacts.unarchiveTitle")
						: I18n.t("modals.contacts.archiveTitle"),
					innerHTML: `<span class="material-symbols-outlined icon-14">${isArchived ? "unarchive" : "archive"}</span>`,
					onclick: handleArchiveToggle,
				})
			)
		),
		h(
			"div",
			{
				className: "contact-info",
			},
			createContactDisplay(contact)
		)
	);
};

// Unified modal component for viewing and adding contacts
const ContactsModal = ({ job, onClose }) => {
	const contacts = job.contacts || [];
	const activeContacts = contacts.filter((contact) => !contact.archived);
	const archivedContacts = contacts.filter((contact) => contact.archived);
	const sortedActiveContacts = [...activeContacts].sort(
		(a, b) => new Date(a.date) - new Date(b.date)
	);
	const sortedArchivedContacts = [...archivedContacts].sort(
		(a, b) => new Date(a.date) - new Date(b.date)
	);

	const handleAddContact = () => {
		const nameInput = document.querySelector(".add-contact-name");
		const emailInput = document.querySelector(".add-contact-email");
		const phoneInput = document.querySelector(".add-contact-phone");
		const companyInput = document.querySelector(".add-contact-company");

		const name = nameInput.value.trim();
		const email = emailInput.value.trim();
		const phone = phoneInput.value.trim();
		const company = companyInput.value.trim();

		if (!name) {
			showValidationError(nameInput, "Name is required for a contact");
			return;
		}

		if (email && !email.includes("@")) {
			showValidationError(emailInput, "Please enter a valid email address");
			return;
		}

		const newContact = {
			id: Date.now(),
			date: new Date().toISOString(),
			name: name,
			email: email,
			phone: phone,
			company: company,
		};

		// Add contact to job data
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		if (!jobsData[jobIndex].contacts) {
			jobsData[jobIndex].contacts = [];
		}

		jobsData[jobIndex].contacts.push(newContact);
		saveToLocalStorage();

		// Update the job object for this modal
		job.contacts = jobsData[jobIndex].contacts;

		// Refresh the table without flicker
		refreshContactsModal(job);

		// Update the contacts count in the table (refresh interface for count update)
		refreshInterface();
	};

	const handleArchiveContact = (contact) => {
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		const contactIndex = jobsData[jobIndex].contacts.findIndex((c) => c.id === contact.id);
		if (contactIndex === -1) return;

		jobsData[jobIndex].contacts[contactIndex].archived = !contact.archived;
		
		saveToLocalStorage();

		// Refresh the table without flicker
		refreshContactsModal(job);

		// Update interface
		refreshInterface();
	};



	const disableContactEditing = (contact, job) => {
		// Just refresh the modal to restore display state
		refreshContactsModal(job);
	};

	// Legacy function - kept for backward compatibility
	const editContactField = (contact, field) => {
		const cell = event.target.closest("td");
		const currentValue = contact[field] || "";

		// Create input element
		const input = h("input", {
			type: field === "email" ? "email" : field === "phone" ? "tel" : "text",
			value: currentValue,
			className: "inline-edit-input",
			onblur: () => saveContactField(contact, field, input.value, cell),
			onkeydown: (e) => {
				if (e.key === "Enter") {
					e.preventDefault();
					saveContactField(contact, field, input.value, cell);
				} else if (e.key === "Escape") {
					e.preventDefault();
					restoreContactCell(contact, field, cell);
				}
			},
		});

		// Replace cell content with input
		cell.innerHTML = "";
		cell.appendChild(input);
		input.focus();
		input.select();
	};

	const saveContactField = (contact, field, newValue, cell) => {
		const trimmedValue = newValue.trim();

		// Validation - name is required
		if (field === "name" && !trimmedValue) {
			showValidationError(cell, "Name is required for a contact");
			return;
		}

		// Email validation
		if (field === "email" && trimmedValue && !trimmedValue.includes("@")) {
			showValidationError(cell, "Please enter a valid email address");
			return;
		}

		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		const contactIndex = jobsData[jobIndex].contacts.findIndex((c) => c.id === contact.id);
		if (contactIndex === -1) return;

		// Update the data
		jobsData[jobIndex].contacts[contactIndex][field] = trimmedValue;
		saveToLocalStorage();

		// Update the cell display
		restoreContactCell(jobsData[jobIndex].contacts[contactIndex], field, cell);

		// Update interface
		refreshInterface();
	};

	const restoreContactCell = (contact, field, cell) => {
		const value = contact[field] || "â€”";
		cell.innerHTML = "";

		if (field === "email" && contact[field]) {
			const link = h(
				"a",
				{
					href: `mailto:${contact[field]}`,
					className: "contact-link",
					onclick: (e) => e.stopPropagation(),
				},
				contact[field]
			);
			cell.appendChild(link);
		} else if (field === "phone" && contact[field]) {
			const link = h(
				"a",
				{
					href: `tel:${contact[field]}`,
					className: "contact-link",
					onclick: (e) => e.stopPropagation(),
				},
				contact[field]
			);
			cell.appendChild(link);
		} else {
			cell.textContent = value;
		}

		// Re-add click handler for editing
		cell.onclick = () => editContactField(contact, field);
	};

	const refreshContactsModal = (job) => {
		const modalBody = document.querySelector(".modal-body");
		if (!modalBody) return;

		// Get updated data
		const jobIndex = jobsData.findIndex((j) => j.id === job.id);
		if (jobIndex === -1) return;

		job.contacts = jobsData[jobIndex].contacts || [];
		const contacts = job.contacts;
		const activeContacts = contacts.filter((contact) => !contact.archived);
		const archivedContacts = contacts.filter((contact) => contact.archived);
		const sortedActiveContacts = [...activeContacts].sort(
			(a, b) => new Date(a.date) - new Date(b.date)
		);
		const sortedArchivedContacts = [...archivedContacts].sort(
			(a, b) => new Date(a.date) - new Date(b.date)
		);

		// Recreate modal body content
		modalBody.innerHTML = "";
		modalBody.appendChild(createContactsContent(job, sortedActiveContacts, sortedArchivedContacts));
	};

	const createContactsContent = (job, sortedActiveContacts, sortedArchivedContacts) => {
		return h(
			"div",
			{ className: "contacts-table-container" },
			// Active contacts table
			sortedActiveContacts.length > 0
				? h(
						"table",
						{ className: "contacts-table" },
						h(
							"thead",
							{},
							h(
								"tr",
								{},
								h("th", {}, I18n.t("modals.contacts.placeholderName")),
								h("th", {}, I18n.t("modals.contacts.placeholderEmail")),
								h("th", {}, I18n.t("modals.contacts.placeholderPhone")),
								h("th", {}, I18n.t("modals.contacts.placeholderCompany")),
								h("th", {}, "Actions")
							)
						),
						h(
							"tbody",
							{},
							...sortedActiveContacts.map((contact) =>
								h(
									"tr",
									{ key: contact.id, "data-contact-id": contact.id },
									h(
										"td",
										{ className: "contact-name-cell" },
										contact.name || "â€”"
									),
									h(
										"td",
										{ className: "contact-email-cell" },
										contact.email
											? h(
													"a",
													{
														href: `mailto:${contact.email}`,
														className: "contact-link",
													},
													contact.email
												)
											: "â€”"
									),
									h(
										"td",
										{ className: "contact-phone-cell" },
										contact.phone
											? h(
													"a",
													{
														href: `tel:${contact.phone}`,
														className: "contact-link",
													},
													contact.phone
												)
											: "â€”"
									),
									h(
										"td",
										{ className: "contact-company-cell" },
										contact.company || "â€”"
									),
									h(
										"td",
										{ className: "contacts-table-actions" },
										h("button", {
											className: "action-btn edit-contact-btn icon-btn-transparent",
											title: I18n.t("modals.contacts.editTitle"),
											innerHTML: '<span class="material-symbols-outlined icon-14">edit</span>',
											onclick: () => enableContactEditing(contact, job),
										}),
										h("button", {
											className: "action-btn archive-btn icon-btn-transparent",
											title: I18n.t("modals.contacts.archiveTitle"),
											innerHTML: '<span class="material-symbols-outlined icon-14">archive</span>',
											onclick: () => handleArchiveContact(contact),
										})
									)
								)
							)
						)
					)
				: h("p", { className: "modal-empty-message" }, I18n.t("modals.contacts.emptyState")),

			// Archived contacts section
			sortedArchivedContacts.length > 0
				? h(
						"div",
						{ className: "archived-contacts-section" },
						h(
							"h4",
							{
								className: "contacts-archived-header",
								onclick: () => {
									const archivedTable = document.getElementById("archived-contacts-table");
									const expandIcon = document.getElementById("archived-contacts-icon");
									if (archivedTable.style.display === "none") {
										archivedTable.style.display = "table";
										expandIcon.textContent = "expand_less";
									} else {
										archivedTable.style.display = "none";
										expandIcon.textContent = "expand_more";
									}
								},
							},
							h(
								"span",
								{
									className: "material-symbols-outlined expand-icon",
									id: "archived-contacts-icon",
								},
								"expand_more"
							),
							I18n.t("modals.contacts.archivedSection", { count: sortedArchivedContacts.length })
						),
						h(
							"table",
							{
								id: "archived-contacts-table",
								className: "contacts-table archived",
								style: "display: none",
							},
							h(
								"thead",
								{},
								h(
									"tr",
									{},
									h("th", {}, I18n.t("modals.contacts.placeholderName")),
									h("th", {}, I18n.t("modals.contacts.placeholderEmail")),
									h("th", {}, I18n.t("modals.contacts.placeholderPhone")),
									h("th", {}, I18n.t("modals.contacts.placeholderCompany")),
									h("th", {}, "Actions")
								)
							),
							h(
								"tbody",
								{},
								...sortedArchivedContacts.map((contact) =>
									h(
										"tr",
										{ key: contact.id },
										h("td", {}, contact.name || "â€”"),
										h(
											"td",
											{},
											contact.email
												? h(
														"a",
														{ href: `mailto:${contact.email}`, className: "contact-link" },
														contact.email
													)
												: "â€”"
										),
										h(
											"td",
											{},
											contact.phone
												? h(
														"a",
														{ href: `tel:${contact.phone}`, className: "contact-link" },
														contact.phone
													)
												: "â€”"
										),
										h("td", {}, contact.company || "â€”"),
										h(
											"td",
											{ className: "contacts-table-actions" },
											h("button", {
												className: "action-btn archive-btn icon-btn-transparent",
												title: I18n.t("modals.contacts.unarchiveTitle"),
												innerHTML:
													'<span class="material-symbols-outlined icon-14">unarchive</span>',
												onclick: () => handleArchiveContact(contact),
											})
										)
									)
								)
							)
						)
					)
				: null,

			// Add contact form (like a new table row)
			h(
				"div",
				{ className: "add-contact-row" },
				h("h4", { className: "add-contact-title" }, I18n.t("modals.contacts.addSection")),
				h(
					"form",
					{
						className: "add-contact-form",
						onsubmit: (e) => {
							e.preventDefault();
							const modal = e.target.closest(".modal");
							if (!modal) return;

							const nameInput = modal.querySelector(".add-contact-name");
							const emailInput = modal.querySelector(".add-contact-email");
							const phoneInput = modal.querySelector(".add-contact-phone");
							const companyInput = modal.querySelector(".add-contact-company");

							const name = nameInput.value.trim();
							const email = emailInput.value.trim();
							const phone = phoneInput.value.trim();
							const company = companyInput.value.trim();

							if (!name) {
								showValidationError(nameInput, I18n.t("modals.contacts.validation.nameRequired"));
								return;
							}

							const newContact = {
								id: Date.now(),
								date: new Date().toISOString(),
								name,
								email,
								phone,
								company,
								isActive: true,
								lastContactDate: null,
								notes: "",
							};

							if (!job.contacts) job.contacts = [];
							job.contacts.push(newContact);

							// Clear inputs
							nameInput.value = "";
							emailInput.value = "";
							phoneInput.value = "";
							companyInput.value = "";

							// Focus back to the first field (name input)
							setTimeout(() => {
								const newNameInput = modal.querySelector(".add-contact-name");
								if (newNameInput) newNameInput.focus();
							}, 100);

							// Save and refresh
							saveToLocalStorage();
							refreshContactsModal(job);
							refreshInterface();
						}
					},
					h(
						"div",
						{ className: "contact-form-row" },
						h("input", {
							type: "text",
							className: "add-contact-name",
							placeholder: I18n.t("modals.contacts.placeholderName"),
							onkeydown: (e) => {
								if (e.key === "Enter" && e.ctrlKey) {
									e.preventDefault();
									e.target.closest("form").dispatchEvent(new Event("submit"));
								}
							}
						}),
						h("input", {
							type: "email",
							className: "add-contact-email",
							placeholder: I18n.t("modals.contacts.placeholderEmail"),
							onkeydown: (e) => {
								if (e.key === "Enter" && e.ctrlKey) {
									e.preventDefault();
									e.target.closest("form").dispatchEvent(new Event("submit"));
								}
							}
						}),
						h("input", {
							type: "tel",
							className: "add-contact-phone",
							placeholder: I18n.t("modals.contacts.placeholderPhone"),
							onkeydown: (e) => {
								if (e.key === "Enter" && e.ctrlKey) {
									e.preventDefault();
									e.target.closest("form").dispatchEvent(new Event("submit"));
								}
							}
						}),
						h("input", {
							type: "text",
							className: "add-contact-company",
							placeholder: I18n.t("modals.contacts.placeholderCompany"),
							onkeydown: (e) => {
								if (e.key === "Enter" && e.ctrlKey) {
									e.preventDefault();
									e.target.closest("form").dispatchEvent(new Event("submit"));
								}
							}
						})
					),
					h(
						"div",
						{ className: "add-contact-form-actions" },
						h(
							"button",
							{
								type: "submit",
								className: "action-btn primary-btn",
							},
							I18n.t("modals.contacts.addButton")
						)
					)
				)
			)
		);
	};

	const showValidationError = (element, message) => {
		// Remove existing error
		const existingError = element.parentNode.querySelector(".validation-error");
		if (existingError) {
			existingError.remove();
		}

		// Add error message
		const errorElement = h(
			"div",
			{
				className: "validation-error",
			},
			message
		);

		element.parentNode.appendChild(errorElement);
		element.focus();

		// Remove error after 3 seconds
		setTimeout(() => {
			if (errorElement.parentNode) {
				errorElement.remove();
			}
		}, 3000);
	};

	return h(
		"div",
		{
			className: "modal-overlay",
			onclick: (e) => e.target === e.currentTarget && onClose(),
		},
		h(
			"div",
			{ className: "modal contacts-modal" },
			h(
				"div",
				{ className: "modal-header" },
				h(
					"h3",
					{ className: "modal-title" },
					I18n.t("modals.contacts.title", { position: job.position, company: job.company })
				),
				h("button", { className: "modal-close", onclick: onClose }, "Ã—")
			),
			h(
				"div",
				{ className: "modal-body" },
				createContactsContent(job, sortedActiveContacts, sortedArchivedContacts)
			)
		)
	);
};

// ============================================================================
// CONTACTS MANAGEMENT FUNCTIONS
// ============================================================================

// Simple contact editing system
const enableContactEditing = (contact, job) => {
	const contactRow = document.querySelector(`[data-contact-id="${contact.id}"]`);
	if (!contactRow) return;

	// Store original values for cancel
	contactRow._originalContact = { ...contact };

	// Replace display with simple inline inputs
	contactRow.innerHTML = `
		<td class="contact-name-cell">
			<input type="text" value="${contact.name || ''}" class="contact-edit-input" data-field="name" placeholder="${I18n.t('modals.contacts.placeholderName')}">
		</td>
		<td class="contact-email-cell">
			<input type="email" value="${contact.email || ''}" class="contact-edit-input" data-field="email" placeholder="${I18n.t('modals.contacts.placeholderEmail')}">
		</td>
		<td class="contact-phone-cell">
			<input type="tel" value="${contact.phone || ''}" class="contact-edit-input" data-field="phone" placeholder="${I18n.t('modals.contacts.placeholderPhone')}">
		</td>
		<td class="contact-company-cell">
			<input type="text" value="${contact.company || ''}" class="contact-edit-input" data-field="company" placeholder="${I18n.t('modals.contacts.placeholderCompany')}">
		</td>
		<td class="contacts-table-actions">
			<button class="action-btn save-contact-btn icon-btn-transparent" title="${I18n.t('modals.common.save')}">
				<span class="material-symbols-outlined icon-14">check</span>
			</button>
			<button class="action-btn cancel-contact-btn icon-btn-transparent" title="${I18n.t('modals.common.cancel')}">
				<span class="material-symbols-outlined icon-14">close</span>
			</button>
		</td>
	`;

	// Add event listeners
	const saveBtn = contactRow.querySelector('.save-contact-btn');
	const cancelBtn = contactRow.querySelector('.cancel-contact-btn');

	saveBtn.onclick = () => saveContactEdits(contact, job);
	cancelBtn.onclick = () => cancelContactEdits(contact, job);

	// Focus first input
	const firstInput = contactRow.querySelector('input[data-field="name"]');
	if (firstInput) {
		firstInput.focus();
		firstInput.select();
	}
};

const saveContactEdits = (contact, job) => {
	const contactRow = document.querySelector(`[data-contact-id="${contact.id}"]`);
	if (!contactRow) return;

	// Get all values directly from inputs
	const inputs = contactRow.querySelectorAll('.contact-edit-input');
	const newData = {};
	
	inputs.forEach(input => {
		newData[input.dataset.field] = input.value.trim();
	});

	console.log('Saving contact with data:', newData);

	// Validation
	if (!newData.name) {
		alert('Name is required');
		return;
	}

	if (newData.email && !newData.email.includes('@')) {
		alert('Please enter a valid email');
		return;
	}

	// Update data
	const jobIndex = jobsData.findIndex(j => j.id === job.id);
	const contactIndex = jobsData[jobIndex].contacts.findIndex(c => c.id === contact.id);

	jobsData[jobIndex].contacts[contactIndex].name = newData.name;
	jobsData[jobIndex].contacts[contactIndex].email = newData.email;
	jobsData[jobIndex].contacts[contactIndex].phone = newData.phone;
	jobsData[jobIndex].contacts[contactIndex].company = newData.company;

	// Save and refresh modal
	saveToLocalStorage();
	refreshContactsModal(job);
	refreshInterface();
};

const cancelContactEdits = (contact, job) => {
	refreshContactsModal(job);
};

// Refresh contacts modal content
const refreshContactsModal = (job) => {
	const modalBody = document.querySelector(".modal-body");
	if (!modalBody) return;

	// Get updated data
	const jobIndex = jobsData.findIndex((j) => j.id === job.id);
	if (jobIndex === -1) return;

	job.contacts = jobsData[jobIndex].contacts || [];
	const contacts = job.contacts;
	const activeContacts = contacts.filter((contact) => !contact.archived);
	const archivedContacts = contacts.filter((contact) => contact.archived);
	const sortedActiveContacts = [...activeContacts].sort(
		(a, b) => new Date(a.date) - new Date(b.date)
	);
	const sortedArchivedContacts = [...archivedContacts].sort(
		(a, b) => new Date(a.date) - new Date(b.date)
	);

	// Recreate modal body content
	modalBody.innerHTML = "";
	modalBody.appendChild(createContactsContent(job, sortedActiveContacts, sortedArchivedContacts));
};

// Create contacts content for modal (extracted to fix scope issue)
const createContactsContent = (job, sortedActiveContacts, sortedArchivedContacts) => {
	return h(
		"div",
		{ className: "contacts-table-container" },
		// Active contacts table
		sortedActiveContacts.length > 0
			? h(
					"table",
					{ className: "contacts-table" },
					h(
						"thead",
						{},
						h(
							"tr",
							{},
							h("th", {}, I18n.t("modals.contacts.placeholderName")),
							h("th", {}, I18n.t("modals.contacts.placeholderEmail")),
							h("th", {}, I18n.t("modals.contacts.placeholderPhone")),
							h("th", {}, I18n.t("modals.contacts.placeholderCompany")),
							h("th", {}, "Actions")
						)
					),
					h(
						"tbody",
						{},
						...sortedActiveContacts.map((contact) =>
							h(
								"tr",
								{ key: contact.id, "data-contact-id": contact.id },
								h(
									"td",
									{ className: "contact-name-cell" },
									contact.name || "â€”"
								),
								h(
									"td",
									{ className: "contact-email-cell" },
									contact.email
										? h(
												"a",
												{
													href: `mailto:${contact.email}`,
													className: "contact-link",
												},
												contact.email
											)
										: "â€”"
								),
								h(
									"td",
									{ className: "contact-phone-cell" },
									contact.phone
										? h(
												"a",
												{
													href: `tel:${contact.phone}`,
													className: "contact-link",
												},
												contact.phone
											)
										: "â€”"
								),
								h(
									"td",
									{ className: "contact-company-cell" },
									contact.company || "â€”"
								),
								h(
									"td",
									{ className: "contacts-table-actions" },
									h("button", {
										className: "action-btn edit-contact-btn icon-btn-transparent",
										title: I18n.t("modals.contacts.editTitle"),
										innerHTML: '<span class="material-symbols-outlined icon-14">edit</span>',
										onclick: () => enableContactEditing(contact, job),
									}),
									h("button", {
										className: "action-btn archive-btn icon-btn-transparent",
										title: I18n.t("modals.contacts.archiveTitle"),
										innerHTML: '<span class="material-symbols-outlined icon-14">archive</span>',
										onclick: () => handleArchiveContact(contact),
									})
								)
							)
						)
					)
				)
			: h("p", { className: "modal-empty-message" }, I18n.t("modals.contacts.emptyState")),

		// Archived contacts section
		sortedArchivedContacts.length > 0
			? h(
					"div",
					{ className: "archived-contacts-section" },
					h(
						"h4",
						{
							className: "contacts-archived-header",
							onclick: () => {
								const archivedTable = document.getElementById("archived-contacts-table");
								const expandIcon = document.getElementById("archived-contacts-icon");
								if (archivedTable.style.display === "none") {
									archivedTable.style.display = "table";
									expandIcon.textContent = "expand_less";
								} else {
									archivedTable.style.display = "none";
									expandIcon.textContent = "expand_more";
								}
							},
						},
						h(
							"span",
							{
								className: "material-symbols-outlined expand-icon",
								id: "archived-contacts-icon",
							},
							"expand_more"
						),
						I18n.t("modals.contacts.archivedSection", { count: sortedArchivedContacts.length })
					),
					h(
						"table",
						{
							id: "archived-contacts-table",
							className: "contacts-table archived",
							style: "display: none",
						},
						h(
							"thead",
							{},
							h(
								"tr",
								{},
								h("th", {}, I18n.t("modals.contacts.placeholderName")),
								h("th", {}, I18n.t("modals.contacts.placeholderEmail")),
								h("th", {}, I18n.t("modals.contacts.placeholderPhone")),
								h("th", {}, I18n.t("modals.contacts.placeholderCompany")),
								h("th", {}, "Actions")
							)
						),
						h(
							"tbody",
							{},
							...sortedArchivedContacts.map((contact) =>
								h(
									"tr",
									{ key: contact.id },
									h("td", {}, contact.name || "â€”"),
									h(
										"td",
										{},
										contact.email
											? h(
													"a",
													{ href: `mailto:${contact.email}`, className: "contact-link" },
													contact.email
												)
											: "â€”"
									),
									h(
										"td",
										{},
										contact.phone
											? h(
													"a",
													{ href: `tel:${contact.phone}`, className: "contact-link" },
													contact.phone
												)
											: "â€”"
									),
									h("td", {}, contact.company || "â€”"),
									h(
										"td",
										{ className: "contacts-table-actions" },
										h("button", {
											className: "action-btn archive-btn icon-btn-transparent",
											title: I18n.t("modals.contacts.unarchiveTitle"),
											innerHTML:
												'<span class="material-symbols-outlined icon-14">unarchive</span>',
											onclick: () => handleArchiveContact(contact),
										})
									)
								)
							)
						)
					)
				)
			: null,

		// Add contact form (like a new table row)
		h(
			"div",
			{ className: "add-contact-row" },
			h("h4", { className: "add-contact-title" }, I18n.t("modals.contacts.addSection")),
			h(
				"form",
				{
					className: "add-contact-form",
					onsubmit: (e) => {
						e.preventDefault();
						const modal = e.target.closest(".modal");
						if (!modal) return;

						const nameInput = modal.querySelector(".add-contact-name");
						const emailInput = modal.querySelector(".add-contact-email");
						const phoneInput = modal.querySelector(".add-contact-phone");
						const companyInput = modal.querySelector(".add-contact-company");

						const name = nameInput.value.trim();
						const email = emailInput.value.trim();
						const phone = phoneInput.value.trim();
						const company = companyInput.value.trim();

						if (!name) {
							showValidationError(nameInput, I18n.t("modals.contacts.validation.nameRequired"));
							return;
						}

						const newContact = {
							id: Date.now(),
							date: new Date().toISOString(),
							name,
							email,
							phone,
							company,
							isActive: true,
							lastContactDate: null,
							notes: "",
						};

						if (!job.contacts) job.contacts = [];
						job.contacts.push(newContact);

						// Clear inputs
						nameInput.value = "";
						emailInput.value = "";
						phoneInput.value = "";
						companyInput.value = "";

						// Focus back to the first field (name input)
						setTimeout(() => {
							const newNameInput = modal.querySelector(".add-contact-name");
							if (newNameInput) newNameInput.focus();
						}, 100);

						// Save and refresh
						saveToLocalStorage();
						refreshContactsModal(job);
						refreshInterface();
					}
				},
				h(
					"div",
					{ className: "contact-form-row" },
					h("input", {
						type: "text",
						className: "add-contact-name",
						placeholder: I18n.t("modals.contacts.placeholderName"),
						onkeydown: (e) => {
							if (e.key === "Enter" && e.ctrlKey) {
								e.preventDefault();
								e.target.closest("form").dispatchEvent(new Event("submit"));
							}
						}
					}),
					h("input", {
						type: "email",
						className: "add-contact-email",
						placeholder: I18n.t("modals.contacts.placeholderEmail"),
						onkeydown: (e) => {
							if (e.key === "Enter" && e.ctrlKey) {
								e.preventDefault();
								e.target.closest("form").dispatchEvent(new Event("submit"));
							}
						}
					}),
					h("input", {
						type: "tel",
						className: "add-contact-phone",
						placeholder: I18n.t("modals.contacts.placeholderPhone"),
						onkeydown: (e) => {
							if (e.key === "Enter" && e.ctrlKey) {
								e.preventDefault();
								e.target.closest("form").dispatchEvent(new Event("submit"));
							}
						}
					}),
					h("input", {
						type: "text",
						className: "add-contact-company",
						placeholder: I18n.t("modals.contacts.placeholderCompany"),
						onkeydown: (e) => {
							if (e.key === "Enter" && e.ctrlKey) {
								e.preventDefault();
								e.target.closest("form").dispatchEvent(new Event("submit"));
							}
						}
					})
				),
				h(
					"div",
					{ className: "add-contact-form-actions" },
					h(
						"button",
						{
							type: "submit",
							className: "action-btn primary-btn",
						},
						I18n.t("modals.contacts.addButton")
					)
				)
			)
		)
	);
};

// Update contact row display after editing
const updateContactRowDisplay = (contactRow, contact, job) => {
	// Remove editing state
	contactRow.dataset.editing = "false";
	
	// Update each cell with new values
	const nameCell = contactRow.querySelector(".contact-name-cell");
	nameCell.innerHTML = "";
	nameCell.textContent = contact.name || "â€”";
	
	const emailCell = contactRow.querySelector(".contact-email-cell");
	emailCell.innerHTML = "";
	if (contact.email) {
		const emailLink = document.createElement("a");
		emailLink.href = `mailto:${contact.email}`;
		emailLink.className = "contact-link";
		emailLink.textContent = contact.email;
		emailCell.appendChild(emailLink);
	} else {
		emailCell.textContent = "â€”";
	}
	
	const phoneCell = contactRow.querySelector(".contact-phone-cell");
	phoneCell.innerHTML = "";
	if (contact.phone) {
		const phoneLink = document.createElement("a");
		phoneLink.href = `tel:${contact.phone}`;
		phoneLink.className = "contact-link";
		phoneLink.textContent = contact.phone;
		phoneCell.appendChild(phoneLink);
	} else {
		phoneCell.textContent = "â€”";
	}
	
	const companyCell = contactRow.querySelector(".contact-company-cell");
	companyCell.innerHTML = "";
	companyCell.textContent = contact.company || "â€”";
	
	// Restore action buttons
	const actionsCell = contactRow.querySelector(".contacts-table-actions");
	actionsCell.innerHTML = "";
	
	// Add edit button
	const editBtn = document.createElement("button");
	editBtn.className = "action-btn edit-contact-btn icon-btn-transparent";
	editBtn.title = I18n.t("modals.contacts.editTitle");
	editBtn.innerHTML = '<span class="material-symbols-outlined icon-14">edit</span>';
	editBtn.onclick = () => enableContactEditing(contact, job);
	actionsCell.appendChild(editBtn);
	
	// Add archive button
	const archiveBtn = document.createElement("button");
	archiveBtn.className = "action-btn archive-btn icon-btn-transparent";
	archiveBtn.title = I18n.t("modals.contacts.archiveTitle");
	archiveBtn.innerHTML = '<span class="material-symbols-outlined icon-14">archive</span>';
	archiveBtn.onclick = () => handleArchiveContact(contact);
	actionsCell.appendChild(archiveBtn);
};

// Open unified contacts modal (for both viewing and adding contacts)
const openContactsModal = (job) => {
	const modal = ContactsModal({
		job,
		onClose: closeModal,
	});

	document.body.appendChild(modal);

	// Scroll to bottom to show the add contact form
	setTimeout(() => {
		const modalBody = modal.querySelector(".modal-body");
		if (modalBody) {
			modalBody.scrollTop = modalBody.scrollHeight;
		}
	}, 50);
};

// Legacy sync function removed - contactPerson and contactEmail fields are deprecated

// Get the latest contact for display in table
const getLatestContact = (contacts = []) => {
	const activeContacts = contacts.filter((contact) => !contact.archived);
	if (activeContacts.length === 0) return null;

	// Sort by date and get the most recent
	const sorted = [...activeContacts].sort((a, b) => new Date(b.date || b.id) - new Date(a.date || a.id));
	return sorted[0];
};

// Format contact for table display
const formatContactForTable = (contact) => {
	if (!contact) return I18n.t("modals.contacts.noContacts");

	const parts = [];
	if (contact.name) parts.push(contact.name);
	if (contact.email) parts.push(contact.email);

	return parts.join("<br>") || I18n.t("modals.contacts.defaultContact");
};

// Make contact components and functions available globally for Vite
window.ContactsCount = ContactsCount;
window.ContactItem = ContactItem;
window.ContactsModal = ContactsModal;
window.openContactsModal = openContactsModal;
window.enableContactEditing = enableContactEditing;
window.saveContactEdits = saveContactEdits;
window.cancelContactEdits = cancelContactEdits;
window.refreshContactsModal = refreshContactsModal;
window.createContactsContent = createContactsContent;
window.updateContactRowDisplay = updateContactRowDisplay;
window.getLatestContact = getLatestContact;
window.formatContactForTable = formatContactForTable;


// ============================================================================
// SRC/COMPONENTS/FORM-FIELDS.JS
// ============================================================================

// ============================================================================
// FORM FIELD COMPONENTS FOR INLINE EDITING
// ============================================================================

// Input field component
const InputField = ({
	value = "",
	type = "text",
	className = "editable",
	placeholder = "",
	list = null,
}) => {
	const props = {
		className,
		type,
		value,
		placeholder,
	};
	if (list) props.list = list;
	return h("input", props);
};

// Textarea field component
const TextareaField = ({ value = "", className = "editable", placeholder = "", rows = null }) => {
	const props = {
		className,
		placeholder,
		textContent: value,
	};
	if (rows) props.rows = rows;
	return h("textarea", props);
};


// Priority select component
const createPrioritySelect = (selectedPriority = "medium", disabled = false, className = "") => {
	const props = {
		className: className,
	};

	// Only add disabled property if it's actually true
	if (disabled === true) {
		props.disabled = true;
	}

	return h(
		"select",
		props,
		h(
			"option",
			{
				value: "high",
				selected: selectedPriority === "high",
			},
			I18n.t("priorities.high")
		),
		h(
			"option",
			{
				value: "medium",
				selected: selectedPriority === "medium",
			},
			I18n.t("priorities.medium")
		),
		h(
			"option",
			{
				value: "low",
				selected: selectedPriority === "low",
			},
			I18n.t("priorities.low")
		)
	);
};

// Phase select component
const createPhaseSelect = (selectedPhase = "wishlist", disabled = false, className = "") => {
	const props = {
		className: className,
	};

	// Only add disabled property if it's actually true
	if (disabled === true) {
		props.disabled = true;
	}

	return h(
		"select",
		props,
		h(
			"option",
			{
				value: "wishlist",
				selected: selectedPhase === "wishlist",
			},
			I18n.t("phases.wishlist")
		),
		h(
			"option",
			{
				value: "applied",
				selected: selectedPhase === "applied",
			},
			I18n.t("phases.applied")
		),
		h(
			"option",
			{
				value: "interview",
				selected: selectedPhase === "interview",
			},
			I18n.t("phases.interview")
		),
		h(
			"option",
			{
				value: "offer",
				selected: selectedPhase === "offer",
			},
			I18n.t("phases.offer")
		),
		h(
			"option",
			{
				value: "rejected_withdrawn",
				selected: selectedPhase === "rejected_withdrawn",
			},
			I18n.t("phases.rejected_withdrawn")
		)
	);
};

// Edit actions cell component
const EditActionsCell = ({ jobId, onSave, onCancel }) => {
	return h(
		"div",
		{ className: "edit-actions" },
		h(
			"button",
			{
				className: "action-btn edit-btn",
				onclick: (e) => onSave(e.target.closest("button")),
				title: I18n.t("forms.saveChangesTitle"),
			},
			h("span", { className: "material-symbols-outlined" }, "save")
		),
		h(
			"button",
			{
				className: "action-btn cancel-btn",
				onclick: (e) => onCancel(e.target.closest("button")),
				title: I18n.t("forms.cancelEditingTitle"),
			},
			h("span", { className: "material-symbols-outlined" }, "close")
		)
	);
};

// Make form field components available globally for Vite
window.InputField = InputField;
window.TextareaField = TextareaField;
window.createPrioritySelect = createPrioritySelect;
window.createPhaseSelect = createPhaseSelect;
window.EditActionsCell = EditActionsCell;


// ============================================================================
// SRC/COMPONENTS/LANGUAGE-SWITCHER.JS
// ============================================================================

// ============================================================================
// LANGUAGE SWITCHER COMPONENT
// ============================================================================

const LanguageSwitcher = {
	// Create the language switcher HTML
	create: () => {
		// Get current language info
		const currentLang =
			CONFIG.languages.find((lang) => lang.code === I18n.currentLanguage) || CONFIG.languages[0];

		// Create button using simple DOM creation instead of h() function
		const button = document.createElement("button");
		button.className = "language-button";
		button.id = "languageButton";

		// Create flag span
		const flagSpan = document.createElement("span");
		flagSpan.className = "language-flag";
		flagSpan.id = "currentLanguageFlag";
		flagSpan.textContent = currentLang.flag;

		// Create name span
		const nameSpan = document.createElement("span");
		nameSpan.className = "language-name";
		nameSpan.id = "currentLanguageName";
		nameSpan.textContent = currentLang.name;

		// Create arrow span
		const arrowSpan = document.createElement("span");
		arrowSpan.className = "language-arrow material-symbols-outlined";
		arrowSpan.textContent = "expand_more";

		// Append to button
		button.appendChild(flagSpan);
		button.appendChild(nameSpan);
		button.appendChild(arrowSpan);

		// Create dropdown
		const dropdown = document.createElement("div");
		dropdown.className = "language-dropdown";
		dropdown.id = "languageDropdown";
		dropdown.style.display = "none";

		// Create dropdown options
		CONFIG.languages.forEach((lang) => {
			const option = document.createElement("div");
			option.className = "language-option";

			const optionFlag = document.createElement("span");
			optionFlag.className = "language-flag";
			optionFlag.textContent = lang.flag;

			const optionName = document.createElement("span");
			optionName.className = "language-name";
			optionName.textContent = lang.name;

			option.appendChild(optionFlag);
			option.appendChild(optionName);

			// Add click event listener
			option.addEventListener("click", () => LanguageSwitcher.selectLanguage(lang.code));

			dropdown.appendChild(option);
		});

		// Create selector container
		const selector = document.createElement("div");
		selector.className = "language-selector";
		selector.appendChild(button);
		selector.appendChild(dropdown);

		// Create main container
		const container = document.createElement("div");
		container.className = "language-switcher";
		container.appendChild(selector);

		// Add click event listener to button
		button.addEventListener("click", () => LanguageSwitcher.toggle());

		return container;
	},

	// Toggle the dropdown visibility
	toggle: () => {
		const dropdown = document.getElementById("languageDropdown");
		if (!dropdown) return;

		const isVisible = dropdown.style.display !== "none";
		dropdown.style.display = isVisible ? "none" : "block";

		// Close dropdown when clicking outside
		if (!isVisible) {
			document.addEventListener("click", LanguageSwitcher.handleClickOutside);
		}
	},

	// Handle clicks outside the dropdown to close it
	handleClickOutside: (event) => {
		const languageSwitcher = document.querySelector(".language-switcher");
		if (languageSwitcher && !languageSwitcher.contains(event.target)) {
			const dropdown = document.getElementById("languageDropdown");
			if (dropdown) {
				dropdown.style.display = "none";
			}
			document.removeEventListener("click", LanguageSwitcher.handleClickOutside);
		}
	},

	// Select a language
	selectLanguage: (langCode) => {
		if (I18n.setLanguage(langCode)) {
			LanguageSwitcher.updateUI();
			LanguageSwitcher.toggle(); // Close dropdown

			// Re-render the app with new language
			if (typeof updateUILanguage === "function") {
				updateUILanguage();
			}
		}
	},

	// Update the switcher UI to reflect current language
	updateUI: () => {
		const currentLang = CONFIG.languages.find((lang) => lang.code === I18n.currentLanguage);
		if (currentLang) {
			const flagElement = document.getElementById("currentLanguageFlag");
			const nameElement = document.getElementById("currentLanguageName");

			if (flagElement) flagElement.textContent = currentLang.flag;
			if (nameElement) nameElement.textContent = currentLang.name;
		}
	},

	// Initialize the language switcher
	init: () => {
		LanguageSwitcher.updateUI();
	},
};


// ============================================================================
// SRC/COMPONENTS/TABS.JS
// ============================================================================

// ============================================================================
// TAB NAVIGATION COMPONENT
// ============================================================================

const TabNavigation = {
	// Current active tab
	activeTab: CONFIG.defaultTab,

	// Available tabs configuration
	tabs: [
		{ id: "jobs", key: "tabs.jobs", icon: "work" },
		{ id: "applications", key: "tabs.applications", icon: "dashboard" },
		{ id: "tasks", key: "tabs.tasks", icon: "task_alt" },
		{ id: "calendar", key: "tabs.calendar", icon: "calendar_month" },
		{ id: "contacts", key: "tabs.contacts", icon: "contacts" },
	],

	// Get tab from URL parameter
	getTabFromURL: () => {
		const urlParams = new URLSearchParams(window.location.search);
		const tabParam = urlParams.get("tab");
		// Validate tab exists
		if (tabParam && TabNavigation.tabs.some((t) => t.id === tabParam)) {
			return tabParam;
		}
		return null;
	},

	// Set tab in URL parameter
	setTabInURL: (tabId) => {
		const url = new URL(window.location);
		if (tabId) {
			url.searchParams.set("tab", tabId);
		} else {
			url.searchParams.delete("tab");
		}

		// If switching away from calendar, clean up calendar-specific params
		if (tabId !== "calendar") {
			url.searchParams.delete("view");
			url.searchParams.delete("date");
		}

		window.history.replaceState({}, "", url);
	},

	// Create the tab navigation HTML
	create: () => {
		// Get initial tab from URL before creating buttons
		const urlTab = TabNavigation.getTabFromURL();
		if (urlTab) {
			TabNavigation.activeTab = urlTab;
		}

		// Create tab navigation container
		const tabNav = document.createElement("div");
		tabNav.className = "tab-navigation";

		// Create tab buttons
		TabNavigation.tabs.forEach((tab) => {
			const button = document.createElement("button");
			button.className = `tab-button ${tab.id === TabNavigation.activeTab ? "active" : ""}`;
			button.dataset.tab = tab.id;

			// Create icon span with Material Icon
			const icon = document.createElement("span");
			icon.className = "material-symbols-outlined tab-icon";
			icon.textContent = tab.icon;

			// Create text span
			const text = document.createElement("span");
			text.className = "tab-text";
			text.textContent = I18n.t(tab.key);

			button.appendChild(icon);
			button.appendChild(text);

			// Add click event listener
			button.addEventListener("click", () => TabNavigation.switchTo(tab.id));

			tabNav.appendChild(button);
		});

		return tabNav;
	},

	// Switch to a specific tab
	switchTo: (tabId, force = false) => {
		if (!force && TabNavigation.activeTab === tabId) return;

		// Update active tab
		TabNavigation.activeTab = tabId;

		// Update URL
		TabNavigation.setTabInURL(tabId);

		// Update button states
		document.querySelectorAll(".tab-button").forEach((btn) => {
			btn.classList.toggle("active", btn.dataset.tab === tabId);
		});

		// Update content visibility
		document.querySelectorAll(".tab-content").forEach((content) => {
			content.classList.toggle("active", content.dataset.tab === tabId);
		});

		// Handle tab-specific logic
		TabNavigation.handleTabSwitch(tabId);
	},

	// Handle tab-specific initialization and updates
	handleTabSwitch: (tabId) => {
		switch (tabId) {
			case "jobs":
				// Refresh jobs table if needed
				if (typeof refreshInterface === "function") {
					refreshInterface();
				}
				break;
			case "applications":
				// Initialize applications board if needed
				TabNavigation.initializeApplicationsBoard();
				break;
			case "tasks":
				// Initialize tasks board if needed
				TabNavigation.initializeTasksBoard();
				break;
			case "calendar":
				// Initialize calendar view if needed
				TabNavigation.initializeCalendarView();
				break;
			case "contacts":
				// Initialize contacts view if needed
				TabNavigation.initializeContactsView();
				break;
		}
	},

	// Initialize applications board with kanban
	initializeApplicationsBoard: () => {
		if (typeof KanbanBoard !== "undefined") {
			KanbanBoard.init();
		}
	},

	// Initialize tasks board with task kanban
	initializeTasksBoard: () => {
		if (typeof TasksBoard !== "undefined") {
			TasksBoard.init();
		}
	},

	// Initialize calendar view
	initializeCalendarView: () => {
		if (typeof CalendarView !== "undefined") {
			CalendarView.init();
		}
	},

	// Initialize contacts view
	initializeContactsView: () => {
		if (typeof ContactsView !== "undefined") {
			ContactsView.init();
		}
	},

	// Update tab texts when language changes
	updateLanguage: () => {
		document.querySelectorAll(".tab-button").forEach((btn) => {
			const tabId = btn.dataset.tab;
			const tab = TabNavigation.tabs.find((t) => t.id === tabId);
			if (tab) {
				const textElement = btn.querySelector(".tab-text");
				if (textElement) {
					textElement.textContent = I18n.t(tab.key);
				}
			}
		});
	},

	// Initialize tab navigation
	init: () => {
		// Get tab from URL or use default
		const urlTab = TabNavigation.getTabFromURL();
		const initialTab = urlTab || CONFIG.defaultTab;

		// Force switch to show the correct tab on init
		TabNavigation.switchTo(initialTab, true);

		// Mark tabs as initialized to enable smooth transitions after a brief delay
		setTimeout(() => {
			const tabContainer = document.querySelector(".tab-content-container");
			if (tabContainer) {
				tabContainer.classList.add("tabs-initialized");
			}
		}, 50);
	},
};


// ============================================================================
// SRC/COMPONENTS/KANBAN.JS
// ============================================================================

// ============================================================================
// KANBAN BOARD COMPONENT
// ============================================================================

const KanbanBoard = {
	// Create the kanban board
	create: () => {
		const boardContainer = h("div", { className: "kanban-board" });

		// Create columns for each phase
		PHASES.forEach((phase) => {
			const column = KanbanBoard.createColumn(phase);
			boardContainer.appendChild(column);
		});

		return boardContainer;
	},

	// Create a column for a specific phase
	createColumn: (phase) => {
		const phaseJobs = jobsData.filter((job) => job.currentPhase === phase);
		const columnTitle = getPhaseText(phase);

		const column = h("div", {
			className: "kanban-column",
			"data-phase": phase,
		});

		// Column header with title and count
		const header = h(
			"div",
			{ className: "kanban-column-header" },
			h(
				"div",
				{ className: "kanban-column-title" },
				h("span", { className: "kanban-column-name" }, columnTitle),
				h(
					"div",
					{ className: "kanban-column-actions" },
					// Add "Add Job" button for wishlist column (left of counter)
					phase === "wishlist" && h(
						"button",
						{
							className: "kanban-add-job-btn",
							onclick: () => KanbanBoard.openAddJobModal(),
						},
						h("span", { className: "material-symbols-outlined" }, "add"),
						I18n.t("kanban.addJob") || "Add Job"
					),
					h("span", { className: "kanban-column-count" }, phaseJobs.length.toString())
				)
			)
		);

		// Column body with job cards
		const body = h("div", { className: "kanban-column-body" });

		phaseJobs.forEach((job) => {
			const card = KanbanBoard.createJobCard(job);
			body.appendChild(card);
		});

		// Add drop zone styling
		body.addEventListener("dragover", KanbanBoard.handleDragOver);
		body.addEventListener("drop", (e) => KanbanBoard.handleDrop(e, phase));

		column.appendChild(header);
		column.appendChild(body);

		return column;
	},

	// Create a job card
	createJobCard: (job) => {
		const card = h("div", {
			className: "kanban-job-card",
			draggable: true,
			"data-job-id": job.id,
		});

		// Add drag event listeners
		card.addEventListener("dragstart", (e) => KanbanBoard.handleDragStart(e, job));
		card.addEventListener("dragend", KanbanBoard.handleDragEnd);

		// Priority indicator
		const priorityDot = h("div", {
			className: `kanban-priority-dot priority-${job.priority}`,
		});

		// Company and position header with icon
		const header = h(
			"div",
			{ className: "kanban-job-header" },
			h("span", { className: "material-symbols-outlined kanban-job-icon" }, "business"),
			h(
				"div",
				{ className: "kanban-job-title" },
				h("div", { className: "kanban-job-company" }, job.company),
				h("div", { className: "kanban-job-position" }, job.position)
			)
		);

		// Current phase with substeps progression
		const phaseSection = KanbanBoard.createPhaseSection(job);

		// Job metadata (salary, location)
		const metadata = [];
		if (job.salaryRange) {
			metadata.push(
				h(
					"div",
					{ className: "kanban-metadata-item" },
					h("span", { className: "material-symbols-outlined kanban-metadata-icon" }, "payments"),
					h("span", { className: "kanban-metadata-text" }, job.salaryRange)
				)
			);
		}
		if (job.location) {
			metadata.push(
				h(
					"div",
					{ className: "kanban-metadata-item" },
					h("span", { className: "material-symbols-outlined kanban-metadata-icon" }, "location_on"),
					h("span", { className: "kanban-metadata-text" }, job.location)
				)
			);
		}

		const metadataRow =
			metadata.length > 0 ? h("div", { className: "kanban-job-metadata" }, ...metadata) : null;

		// Action icons with counts (notes, tasks, contacts)
		const notesCount = job.notes ? job.notes.length : 0;
		const tasksCount = job.tasks ? job.tasks.length : 0;
		const contactsCount = job.contacts ? job.contacts.length : 0;

		const actionIcons = h(
			"div",
			{ className: "kanban-action-icons" },
			// Source link icon if sourceUrl exists (first position)
			job.sourceUrl && h(
				"a",
				{
					className: "kanban-icon-btn kanban-source-link",
					href: job.sourceUrl,
					target: "_blank",
					rel: "noopener noreferrer",
					title: "View job posting",
					onclick: (e) => e.stopPropagation(),
				},
				h("span", { className: "material-symbols-outlined" }, "link")
			),
			
			h(
				"button",
				{
					className: "kanban-icon-btn",
					title: `Notes (${notesCount})`,
					onclick: (e) => {
						e.stopPropagation();
						openNotesModal(job);
					},
				},
				h("span", { className: "material-symbols-outlined" }, "note"),
				notesCount > 0 && h("span", { className: "kanban-count-badge" }, notesCount.toString())
			),

			h(
				"button",
				{
					className: "kanban-icon-btn",
					title: `Tasks (${tasksCount})`,
					onclick: (e) => {
						e.stopPropagation();
						openTasksModal(job);
					},
				},
				h("span", { className: "material-symbols-outlined" }, "task_alt"),
				tasksCount > 0 && h("span", { className: "kanban-count-badge" }, tasksCount.toString())
			),

			h(
				"button",
				{
					className: "kanban-icon-btn",
					title: `Contacts (${contactsCount})`,
					onclick: (e) => {
						e.stopPropagation();
						openContactsModal(job);
					},
				},
				h("span", { className: "material-symbols-outlined" }, "person"),
				contactsCount > 0 &&
					h("span", { className: "kanban-count-badge" }, contactsCount.toString())
			)
		);

		// Card click handler to view/edit job
		card.addEventListener("click", (e) => {
			// Don't trigger if clicking on action buttons
			if (e.target.closest(".kanban-icon-btn")) {
				return;
			}
			// Handle card click to edit job in modal
			KanbanBoard.openJobEditModal(job);
		});

		// Assemble card
		card.appendChild(priorityDot);
		card.appendChild(header);
		if (phaseSection) card.appendChild(phaseSection);
		if (metadataRow) card.appendChild(metadataRow);
		card.appendChild(actionIcons);

		return card;
	},

	// Create phase section with substep progression
	createPhaseSection: (job) => {
		const currentPhase = job.currentPhase;

		// Don't show phase section for wishlist and rejected_withdrawn items
		if (currentPhase === "wishlist" || currentPhase === "rejected_withdrawn") {
			return null;
		}

		const currentSubstep = job.currentSubstep || currentPhase;
		const completedSubsteps = job.completedSubsteps || [];
		const availableSubsteps = getSubstepsForPhase(currentPhase);

		const phaseHeader = h(
			"div",
			{ className: "kanban-phase-header" },
			h("span", { className: "material-symbols-outlined kanban-phase-icon" }, "schedule"),
			h("span", { className: "kanban-phase-text" }, `${getPhaseText(currentPhase)} Stage:`)
		);

		const substepsList = h("div", { className: "kanban-substeps-list" });

		if (availableSubsteps.length > 0) {
			// Show progression through substeps
			availableSubsteps.forEach((substep) => {
				const isCompleted = completedSubsteps.includes(substep);
				const isCurrent = substep === currentSubstep;
				const isPending = !isCompleted && !isCurrent;

				let icon = "radio_button_unchecked"; // Pending
				let className = "kanban-substep-item pending";

				if (isCompleted) {
					icon = "check_circle";
					className = "kanban-substep-item completed";
				} else if (isCurrent) {
					icon = "radio_button_checked";
					className = "kanban-substep-item current";
				}

				const substepItem = h(
					"div",
					{ className },
					h("span", { className: "material-symbols-outlined kanban-substep-icon" }, icon),
					h("span", { className: "kanban-substep-text" }, getSubstepText(substep))
				);

				substepsList.appendChild(substepItem);
			});
		} else {
			// No substeps, just show the phase
			const phaseItem = h(
				"div",
				{ className: "kanban-substep-item current" },
				h(
					"span",
					{ className: "material-symbols-outlined kanban-substep-icon" },
					"radio_button_checked"
				),
				h("span", { className: "kanban-substep-text" }, getPhaseText(currentPhase))
			);
			substepsList.appendChild(phaseItem);
		}

		return h("div", { className: "kanban-phase-section" }, phaseHeader, substepsList);
	},

	// Drag and drop handlers
	handleDragStart: (e, job) => {
		e.dataTransfer.setData("text/plain", job.id.toString());
		e.target.classList.add("dragging");
		document.querySelectorAll(".kanban-column").forEach((col) => {
			col.classList.add("drag-active");
		});
	},

	handleDragEnd: (e) => {
		e.target.classList.remove("dragging");
		document.querySelectorAll(".kanban-column").forEach((col) => {
			col.classList.remove("drag-active", "drag-over");
		});
	},

	handleDragOver: (e) => {
		e.preventDefault();
		const column = e.currentTarget.closest(".kanban-column");
		column.classList.add("drag-over");
	},

	handleDrop: (e, targetPhase) => {
		e.preventDefault();
		const jobId = Number.parseInt(e.dataTransfer.getData("text/plain"));
		const job = jobsData.find((j) => j.id === jobId);

		if (job && job.currentPhase !== targetPhase) {
			// Update job phase
			job.currentPhase = targetPhase;

			// Track when job moves to applied status
			if (targetPhase === "applied" && !job.appliedDate) {
				job.appliedDate = new Date().toISOString();
			}

			// Clear substep if moving to a different phase that doesn't support it
			if (!getSubstepsForPhase(targetPhase).includes(job.currentSubstep)) {
				job.currentSubstep = targetPhase;
			}

			// Save changes
			saveToLocalStorage();

			// Refresh the kanban board
			KanbanBoard.refresh();

			// Also refresh the main table if it's visible
			if (typeof refreshInterface === "function") {
				refreshInterface();
			}
		}

		// Clean up drag styling
		document.querySelectorAll(".kanban-column").forEach((col) => {
			col.classList.remove("drag-active", "drag-over");
		});
	},

	// Refresh the kanban board
	refresh: () => {
		const boardContainer = document.querySelector(".kanban-board");
		if (boardContainer) {
			// Clear existing content
			boardContainer.innerHTML = "";

			// Recreate columns
			PHASES.forEach((phase) => {
				const column = KanbanBoard.createColumn(phase);
				boardContainer.appendChild(column);
			});
		}
	},

	// Open job editing modal
	openJobEditModal: (job) => {
		const modal = KanbanBoard.createJobEditModal(job);
		document.body.appendChild(modal);
	},

	// Open add job modal
	openAddJobModal: () => {
		// Create a new job object with default values
		const newJob = {
			id: Date.now(),
			priority: "medium",
			company: "",
			position: "",
			appliedDate: new Date().toISOString(),
			currentPhase: "wishlist",
			currentSubstep: "wishlist",
			completedSubsteps: [],
			salaryRange: "",
			location: "",
			sourceUrl: "",
			notes: [],
			tasks: [],
			contacts: [],
		};

		// Add to jobsData temporarily
		jobsData.push(newJob);

		// Open the edit modal for the new job
		const modal = KanbanBoard.createJobEditModal(newJob);
		modal.classList.add("add-job-modal");
		
		// Modify the modal title
		const title = modal.querySelector(".modal-title");
		if (title) {
			title.textContent = I18n.t("kanban.addJob") || "Add Job";
		}

		document.body.appendChild(modal);
	},

	// Create job editing modal
	createJobEditModal: (job) => {
		const handleSave = async () => {
			const modal = document.querySelector(".kanban-job-edit-modal");
			const form = modal.querySelector("form");

			// Get form values manually
			const updatedJob = {
				...job,
				priority: form.priority.value,
				company: form.company.value.trim(),
				position: form.position.value.trim(),
				currentPhase: form.phase.value,
				currentSubstep: form.substep.value,
				salaryRange: form.salaryRange.value.trim(),
				location: form.location.value.trim(),
				sourceUrl: form.sourceUrl.value.trim(),
			};

			// Validation
			if (!updatedJob.company || !updatedJob.position) {
				await alert(
					I18n.t("validation.companyPositionRequired") || "Company and position are required"
				);
				return;
			}

			// Update job in data
			const jobIndex = jobsData.findIndex((j) => j.id === job.id);
			if (jobIndex !== -1) {
				// Track when job moves to applied status
				if (
					updatedJob.currentPhase === "applied" &&
					jobsData[jobIndex].currentPhase !== "applied" &&
					!jobsData[jobIndex].appliedDate
				) {
					updatedJob.appliedDate = new Date().toISOString();
				}

				Object.assign(jobsData[jobIndex], updatedJob);
				saveToLocalStorage();

				// Refresh kanban board
				KanbanBoard.refresh();

				// Also refresh main table if visible
				if (typeof refreshInterface === "function") {
					refreshInterface();
				}
			}

			// Close modal
			KanbanBoard.closeJobEditModal();
		};

		const handleClose = () => {
			KanbanBoard.closeJobEditModal();
		};

		// Get unique values for autocomplete
		const companies = [...new Set(jobsData.map((j) => j.company).filter(Boolean))];
		const positions = [...new Set(jobsData.map((j) => j.position).filter(Boolean))];
		const locations = [...new Set(jobsData.map((j) => j.location).filter(Boolean))];

		const modal = h(
			"div",
			{
				className: "modal-overlay kanban-job-edit-modal",
				onclick: (e) => e.target === e.currentTarget && handleClose(),
			},
			h(
				"div",
				{ className: "modal job-edit-modal" },
				h(
					"div",
					{ className: "modal-header" },
					h("h3", { className: "modal-title" }, I18n.t("kanban.editJob") || "Edit Job"),
					h("button", { className: "modal-close", onclick: handleClose }, "Ã—")
				),
				h(
					"div",
					{ className: "modal-body" },
					h(
						"form",
						{ className: "job-edit-form" },
						// Priority row
						h(
							"div",
							{ className: "form-row" },
							h(
								"div",
								{ className: "form-field full-width" },
								h("label", {}, I18n.t("table.headers.priority") || "Priority"),
								h(
									"select",
									{ name: "priority" },
									h("option", { value: "high" }, I18n.t("priorities.high") || "High"),
									h("option", { value: "medium" }, I18n.t("priorities.medium") || "Medium"),
									h("option", { value: "low" }, I18n.t("priorities.low") || "Low")
								)
							)
						),

						// Phase and Substep row
						h(
							"div",
							{ className: "form-row" },
							h(
								"div",
								{ className: "form-field" },
								h("label", {}, I18n.t("table.headers.currentPhase") || "Phase"),
								h(
									"select",
									{
										name: "phase",
										onchange: (e) => {
											const substepSelect = e.target.form.substep;
											const selectedPhase = e.target.value;
											const substeps = getSubstepsForPhase(selectedPhase);

											// Update substep options
											substepSelect.innerHTML = "";
											const mainOption = h(
												"option",
												{ value: selectedPhase },
												getPhaseText(selectedPhase)
											);
											substepSelect.appendChild(mainOption);
											substeps.forEach((substep) => {
												const option = h("option", { value: substep }, getSubstepText(substep));
												substepSelect.appendChild(option);
											});
											substepSelect.value = selectedPhase;

											// Update job phase immediately for real-time kanban update
											const jobIndex = jobsData.findIndex((j) => j.id === job.id);
											if (jobIndex !== -1) {
												jobsData[jobIndex].currentPhase = selectedPhase;
												jobsData[jobIndex].currentSubstep = selectedPhase;
												saveToLocalStorage();
												KanbanBoard.refresh();
											}
										},
									},
									...PHASES.map((phase) => h("option", { value: phase }, getPhaseText(phase)))
								)
							),
							h(
								"div",
								{ className: "form-field" },
								h("label", {}, I18n.t("table.headers.substep") || "Substep"),
								h(
									"select",
									{
										name: "substep",
										onchange: (e) => {
											const selectedSubstep = e.target.value;

											// Update job substep immediately for real-time kanban update
											const jobIndex = jobsData.findIndex((j) => j.id === job.id);
											if (jobIndex !== -1) {
												jobsData[jobIndex].currentSubstep = selectedSubstep;
												saveToLocalStorage();
												KanbanBoard.refresh();
											}
										},
									},
									h("option", { value: job.currentPhase }, getPhaseText(job.currentPhase)),
									...getSubstepsForPhase(job.currentPhase).map((substep) =>
										h("option", { value: substep }, getSubstepText(substep))
									)
								)
							)
						),

						// Company and Position row
						h(
							"div",
							{ className: "form-row" },
							h(
								"div",
								{ className: "form-field" },
								h("label", {}, I18n.t("table.headers.company") || "Company"),
								h("input", {
									type: "text",
									name: "company",
									required: true,
									list: "companies-list",
								}),
								h(
									"datalist",
									{ id: "companies-list" },
									...companies.map((company) => h("option", { value: company }))
								)
							),
							h(
								"div",
								{ className: "form-field" },
								h("label", {}, I18n.t("table.headers.position") || "Position"),
								h("input", {
									type: "text",
									name: "position",
									required: true,
									list: "positions-list",
								}),
								h(
									"datalist",
									{ id: "positions-list" },
									...positions.map((position) => h("option", { value: position }))
								)
							)
						),

						// Salary and Location row
						h(
							"div",
							{ className: "form-row" },
							h(
								"div",
								{ className: "form-field" },
								h("label", {}, I18n.t("table.headers.salaryRange") || "Salary Range"),
								h("input", {
									type: "text",
									name: "salaryRange",
									placeholder: "e.g. $50k - $70k",
								})
							),
							h(
								"div",
								{ className: "form-field" },
								h("label", {}, I18n.t("table.headers.location") || "Location"),
								h("input", {
									type: "text",
									name: "location",
									list: "locations-list",
								}),
								h(
									"datalist",
									{ id: "locations-list" },
									...locations.map((location) => h("option", { value: location }))
								)
							)
						),

						// Source URL
						h(
							"div",
							{ className: "form-row" },
							h(
								"div",
								{ className: "form-field full-width" },
								h("label", {}, I18n.t("table.headers.sourceUrl") || "Source URL"),
								h("input", {
									type: "url",
									name: "sourceUrl",
									placeholder: "https://",
								})
							)
						)
					)
				),
				h(
					"div",
					{ className: "modal-footer" },
					h(
						"button",
						{
							type: "button",
							className: "btn-secondary",
							onclick: handleClose,
						},
						I18n.t("modals.common.cancel") || "Cancel"
					),
					h(
						"button",
						{
							type: "button",
							className: "btn-primary",
							onclick: handleSave,
						},
						I18n.t("modals.common.save") || "Save"
					)
				)
			)
		);

		// Set form values after modal is created
		setTimeout(() => {
			const form = modal.querySelector("form");
			if (form) {
				form.priority.value = job.priority;
				form.phase.value = job.currentPhase;
				form.company.value = job.company;
				form.position.value = job.position;
				form.substep.value = job.currentSubstep || job.currentPhase;
				form.salaryRange.value = job.salaryRange || "";
				form.location.value = job.location || "";
				form.sourceUrl.value = job.sourceUrl || "";
			}
		}, 0);

		return modal;
	},

	// Close job editing modal
	closeJobEditModal: () => {
		const modal = document.querySelector(".kanban-job-edit-modal");
		if (modal) {
			// If this is an add job modal, check if the job should be removed
			if (modal.classList.contains("add-job-modal")) {
				// Find the job that was being added
				const form = modal.querySelector("form");
				if (form) {
					const company = form.company?.value?.trim() || "";
					const position = form.position?.value?.trim() || "";
					
					// If both company and position are empty, remove the job
					if (!company && !position) {
						// Find the job in jobsData by looking for recent entries with empty fields
						const jobToRemove = jobsData.find(job => 
							!job.company && !job.position && job.currentPhase === "wishlist"
						);
						if (jobToRemove) {
							const index = jobsData.findIndex(j => j.id === jobToRemove.id);
							if (index !== -1) {
								jobsData.splice(index, 1);
								saveToLocalStorage();
								KanbanBoard.refresh();
							}
						}
					}
				}
			}
			modal.remove();
		}
	},

	// Initialize the kanban board in the applications tab
	init: () => {
		const applicationsTab = document.querySelector('.tab-content[data-tab="applications"]');
		if (applicationsTab) {
			// Only clear and initialize if not already initialized
			if (!applicationsTab.querySelector(".kanban-container")) {
				// Clear existing content
				applicationsTab.innerHTML = "";

				// Create board header
				const header = h(
					"div",
					{ className: "tab-header" },
					h("h2", { className: "tab-title" }, I18n.t("kanban.title")),
					h(
						"div",
						{ className: "kanban-stats" },
						h(
							"span",
							{ className: "kanban-total-jobs" },
							I18n.t("kanban.totalJobs", { count: jobsData.length })
						)
					)
				);

				// Create the kanban board
				const board = KanbanBoard.create();

				// Add to container
				const container = h("div", { className: "kanban-container" });
				container.appendChild(header);
				container.appendChild(board);

				applicationsTab.appendChild(container);
			} else {
				// Just refresh the existing board
				KanbanBoard.refresh();
			}
		}
	},
};

// Make kanban board available globally
window.KanbanBoard = KanbanBoard;


// ============================================================================
// SRC/COMPONENTS/TASKS-BOARD.JS
// ============================================================================

// ============================================================================
// TASKS BOARD COMPONENT
// ============================================================================

const TasksBoard = {
	// Create the tasks board
	create: () => {
		const boardContainer = h("div", { className: "tasks-board" });

		// Create columns for each task status
		TASK_STATUSES.forEach((status) => {
			const column = TasksBoard.createColumn(status);
			boardContainer.appendChild(column);
		});

		return boardContainer;
	},

	// Create a column for a specific task status
	createColumn: (status) => {
		// Get all tasks from all jobs
		const allTasks = [];
		jobsData.forEach((job) => {
			if (job.tasks && job.tasks.length > 0) {
				job.tasks.forEach((task) => {
					// Add job context to task
					allTasks.push({
						...task,
						jobId: job.id,
						jobCompany: job.company,
						jobPosition: job.position,
						jobPhase: job.currentPhase,
					});
				});
			}
		});

		const statusTasks = allTasks.filter((task) => task.status === status);
		const columnTitle = getTaskStatusText(status);

		const column = h("div", {
			className: "tasks-column",
			"data-status": status,
		});

		// Column header with title and count
		const header = h(
			"div",
			{ className: "tasks-column-header" },
			h(
				"div",
				{ className: "tasks-column-title" },
				h("span", { className: "tasks-column-name" }, columnTitle),
				h("span", { className: "tasks-column-count" }, statusTasks.length.toString())
			)
		);

		// Column body with task cards
		const body = h("div", { className: "tasks-column-body" });

		statusTasks.forEach((task) => {
			const card = TasksBoard.createTaskCard(task);
			body.appendChild(card);
		});

		// Add drop zone event listeners to both column and body
		const dragOverHandler = (e) => TasksBoard.handleDragOver(e);
		const dragLeaveHandler = (e) => TasksBoard.handleDragLeave(e);
		const dropHandler = (e) => TasksBoard.handleDrop(e, status);

		column.addEventListener("dragover", dragOverHandler);
		column.addEventListener("dragleave", dragLeaveHandler);
		column.addEventListener("drop", dropHandler);

		body.addEventListener("dragover", dragOverHandler);
		body.addEventListener("dragleave", dragLeaveHandler);
		body.addEventListener("drop", dropHandler);

		column.appendChild(header);
		column.appendChild(body);

		return column;
	},

	// Create a task card
	createTaskCard: (task) => {
		const card = h("div", {
			className: "tasks-task-card",
			draggable: true,
			"data-task-id": task.id,
			"data-job-id": task.jobId,
		});

		// Add drag event listeners
		card.addEventListener("dragstart", (e) => TasksBoard.handleDragStart(e, task));
		card.addEventListener("dragend", TasksBoard.handleDragEnd);

		// Priority indicator
		const priorityDot = h("div", {
			className: `tasks-priority-dot priority-${task.priority}`,
		});

		// Task content
		const content = h(
			"div",
			{ className: "tasks-task-content" },
			h("div", { className: "tasks-task-text" }, task.task || task.description)
		);

		// Job context information
		const jobContext = h(
			"div",
			{ className: "tasks-job-context" },
			h(
				"div",
				{ className: "tasks-job-info" },
				h("span", { className: "material-symbols-outlined tasks-job-icon" }, "business"),
				h("span", { className: "tasks-job-text" }, `${task.jobCompany} â€” ${task.jobPosition}`)
			),
			h(
				"div",
				{ className: "tasks-job-phase" },
				h("span", { className: "material-symbols-outlined tasks-phase-icon" }, "schedule"),
				h("span", { className: "tasks-phase-text" }, getPhaseText(task.jobPhase))
			)
		);

		// Action icons
		const actionIcons = h(
			"div",
			{ className: "tasks-action-icons" },
			h(
				"button",
				{
					className: "tasks-icon-btn",
					title: "Edit Task",
					onclick: (e) => {
						e.stopPropagation();
						TasksBoard.openTaskEditModal(task);
					},
				},
				h("span", { className: "material-symbols-outlined" }, "edit")
			),

			h(
				"button",
				{
					className: "tasks-icon-btn",
					title: "View Job",
					onclick: (e) => {
						e.stopPropagation();
						TasksBoard.openJobModal(task);
					},
				},
				h("span", { className: "material-symbols-outlined" }, "work")
			)
		);

		// Assemble card
		card.appendChild(priorityDot);
		card.appendChild(content);
		card.appendChild(jobContext);
		card.appendChild(actionIcons);

		return card;
	},

	// Drag and drop handlers
	handleDragStart: (e, task) => {
		e.dataTransfer.effectAllowed = "move";
		e.dataTransfer.setData("text/plain", JSON.stringify({ taskId: task.id, jobId: task.jobId }));
		e.target.classList.add("dragging");
		document.querySelectorAll(".tasks-column").forEach((col) => {
			col.classList.add("drag-active");
		});
	},

	handleDragEnd: (e) => {
		e.target.classList.remove("dragging");
		document.querySelectorAll(".tasks-column").forEach((col) => {
			col.classList.remove("drag-active", "drag-over");
		});
	},

	handleDragOver: (e) => {
		e.preventDefault();
		e.dataTransfer.dropEffect = "move";
		const column = e.currentTarget.closest(".tasks-column");
		column.classList.add("drag-over");
	},

	handleDragLeave: (e) => {
		// Only remove drag-over if we're leaving the column entirely
		if (!e.currentTarget.contains(e.relatedTarget)) {
			const column = e.currentTarget.closest(".tasks-column");
			column.classList.remove("drag-over");
		}
	},

	handleDrop: (e, targetStatus) => {
		e.preventDefault();

		try {
			const dragData = JSON.parse(e.dataTransfer.getData("text/plain"));
			const { taskId, jobId } = dragData;

			// Find the job and task
			const jobIndex = jobsData.findIndex((j) => j.id === Number.parseInt(jobId));
			if (jobIndex === -1) return;

			const taskIndex = jobsData[jobIndex].tasks.findIndex(
				(t) => t.id.toString() === taskId.toString()
			);
			if (taskIndex === -1) return;

			const task = jobsData[jobIndex].tasks[taskIndex];

			if (task && task.status !== targetStatus) {
				// Update task status
				jobsData[jobIndex].tasks[taskIndex].status = targetStatus;

				// Save changes
				saveToLocalStorage();

				// Refresh the tasks board
				TasksBoard.refresh();

				// Also refresh the main table if it's visible
				if (typeof refreshInterface === "function") {
					refreshInterface();
				}
			}
		} catch (error) {
			console.error("Error in drop handler:", error);
		}

		// Clean up drag styling
		document.querySelectorAll(".tasks-column").forEach((col) => {
			col.classList.remove("drag-active", "drag-over");
		});
	},

	// Refresh the tasks board
	refresh: () => {
		const boardContainer = document.querySelector(".tasks-board");
		if (boardContainer) {
			// Clear existing content
			boardContainer.innerHTML = "";

			// Recreate columns
			TASK_STATUSES.forEach((status) => {
				const column = TasksBoard.createColumn(status);
				boardContainer.appendChild(column);
			});
		}
	},

	// Open task edit modal (reuse existing task modal functionality)
	openTaskEditModal: (task) => {
		// Find the job for this task
		const job = jobsData.find((j) => j.id === task.jobId);
		if (job) {
			openTasksModal(job);
		}
	},

	// Open job modal to show job details
	openJobModal: (task) => {
		// Find the job for this task
		const job = jobsData.find((j) => j.id === task.jobId);
		if (job) {
			// You could open the job edit modal or create a job view modal
			// For now, let's open the job edit modal from kanban
			if (typeof KanbanBoard !== "undefined" && KanbanBoard.openJobEditModal) {
				KanbanBoard.openJobEditModal(job);
			}
		}
	},

	// Initialize the tasks board in the tasks tab
	init: () => {
		const tasksTab = document.querySelector('.tab-content[data-tab="tasks"]');

		if (tasksTab) {
			// Only clear and initialize if not already initialized
			if (!tasksTab.querySelector(".tasks-container")) {
				// Clear existing content
				tasksTab.innerHTML = "";

				// Get total task count
				let totalTasks = 0;
				jobsData.forEach((job) => {
					if (job.tasks) {
						totalTasks += job.tasks.length;
					}
				});

				// Create board header
				const header = h(
					"div",
					{ className: "tab-header" },
					h("h2", { className: "tab-title" }, I18n.t("tabs.tasks")),
					h(
						"div",
						{ className: "tasks-stats" },
						h("span", { className: "tasks-total-count" }, `${totalTasks} total tasks`)
					)
				);

				// Create the tasks board
				const board = TasksBoard.create();

				// Add to container
				const container = h("div", { className: "tasks-container" });
				container.appendChild(header);
				container.appendChild(board);

				tasksTab.appendChild(container);
			} else {
				// Just refresh the existing board
				TasksBoard.refresh();
			}
		}
	},
};

// Make tasks board available globally
window.TasksBoard = TasksBoard;


// ============================================================================
// SRC/COMPONENTS/CALENDAR-VIEW.JS
// ============================================================================

// ============================================================================
// CALENDAR VIEW COMPONENT
// ============================================================================

const CalendarView = {
	// Current view settings
	currentView: "month", // month, week, day
	currentDate: new Date(),
	selectedDate: null,
	events: [],

	// Get calendar state from URL
	getStateFromURL: () => {
		const urlParams = new URLSearchParams(window.location.search);
		const view = urlParams.get("view");
		const date = urlParams.get("date");

		return {
			view: ["month", "week", "day"].includes(view) ? view : "month",
			date: date ? new Date(date) : new Date(),
		};
	},

	// Set calendar state in URL
	setStateInURL: () => {
		const url = new URL(window.location);
		const currentTab = url.searchParams.get("tab");

		// Only update URL if we're on calendar tab
		if (currentTab === "calendar") {
			url.searchParams.set("view", CalendarView.currentView);
			url.searchParams.set("date", CalendarView.currentDate.toISOString().split("T")[0]);
		}

		window.history.replaceState({}, "", url);
	},

	// Initialize calendar view
	init: () => {
		const calendarTab = document.querySelector('.tab-content[data-tab="calendar"]');

		if (calendarTab) {
			// Load state from URL
			const urlState = CalendarView.getStateFromURL();
			CalendarView.currentView = urlState.view;
			CalendarView.currentDate = urlState.date;

			// Always reload events to get latest data
			CalendarView.loadEvents();

			// Only clear and initialize if not already initialized
			if (!calendarTab.querySelector(".calendar-container")) {
				// Clear existing content
				calendarTab.innerHTML = "";

				// Create calendar container
				const container = CalendarView.create();
				calendarTab.appendChild(container);
			} else {
				// If already initialized, just update the view
				CalendarView.updateView();
			}

			// Update URL with current state
			CalendarView.setStateInURL();
		}
	},

	// Create the main calendar structure
	create: () => {
		const container = h(
			"div",
			{ className: "calendar-container" },
			// Header with title and controls
			h(
				"div",
				{ className: "tab-header" },
				h("h2", { className: "tab-title" }, I18n.t("calendar.title")),

				// View selector
				h(
					"div",
					{ className: "calendar-controls" },
					h(
						"div",
						{ className: "calendar-view-selector" },
						h(
							"button",
							{
								className: `view-btn ${CalendarView.currentView === "month" ? "active" : ""}`,
								onclick: () => CalendarView.switchView("month"),
							},
							I18n.t("calendar.month")
						),
						h(
							"button",
							{
								className: `view-btn ${CalendarView.currentView === "week" ? "active" : ""}`,
								onclick: () => CalendarView.switchView("week"),
							},
							I18n.t("calendar.week")
						),
						h(
							"button",
							{
								className: `view-btn ${CalendarView.currentView === "day" ? "active" : ""}`,
								onclick: () => CalendarView.switchView("day"),
							},
							I18n.t("calendar.day")
						)
					),

					// Navigation controls
					h(
						"div",
						{ className: "calendar-nav" },
						h(
							"button",
							{
								className: "nav-btn",
								onclick: () => CalendarView.navigate("prev"),
								title: I18n.t("calendar.previous"),
							},
							h("span", { className: "material-symbols-outlined" }, "chevron_left")
						),

						h(
							"button",
							{
								className: "nav-btn today-btn",
								onclick: () => CalendarView.navigateToday(),
							},
							I18n.t("calendar.today")
						),

						h(
							"button",
							{
								className: "nav-btn",
								onclick: () => CalendarView.navigate("next"),
								title: I18n.t("calendar.next"),
							},
							h("span", { className: "material-symbols-outlined" }, "chevron_right")
						)
					)
				)
			),

			// Current period display
			h(
				"div",
				{ className: "calendar-period" },
				h("h3", { className: "calendar-period-text" }, CalendarView.getCurrentPeriodText())
			),

			// Calendar body
			h("div", { className: "calendar-body", id: "calendarBody" }, CalendarView.renderCurrentView())
		);

		return container;
	},

	// Switch between views
	switchView: (view) => {
		CalendarView.currentView = view;
		CalendarView.updateView();
		CalendarView.setStateInURL();
	},

	// Navigate calendar
	navigate: (direction) => {
		const date = new Date(CalendarView.currentDate);

		switch (CalendarView.currentView) {
			case "month":
				if (direction === "prev") {
					date.setMonth(date.getMonth() - 1);
				} else {
					date.setMonth(date.getMonth() + 1);
				}
				break;
			case "week":
				if (direction === "prev") {
					date.setDate(date.getDate() - 7);
				} else {
					date.setDate(date.getDate() + 7);
				}
				break;
			case "day":
				if (direction === "prev") {
					date.setDate(date.getDate() - 1);
				} else {
					date.setDate(date.getDate() + 1);
				}
				break;
		}

		CalendarView.currentDate = date;
		CalendarView.updateView();
		CalendarView.setStateInURL();
	},

	// Navigate to today
	navigateToday: () => {
		CalendarView.currentDate = new Date();
		CalendarView.updateView();
		CalendarView.setStateInURL();
	},

	// Update calendar view
	updateView: () => {
		// Update view selector buttons
		document.querySelectorAll(".view-btn").forEach((btn) => {
			btn.classList.toggle("active", btn.textContent.toLowerCase() === CalendarView.currentView);
		});

		// Update period text
		const periodText = document.querySelector(".calendar-period-text");
		if (periodText) {
			periodText.textContent = CalendarView.getCurrentPeriodText();
		}

		// Update calendar body
		const calendarBody = document.getElementById("calendarBody");
		if (calendarBody) {
			calendarBody.innerHTML = "";
			calendarBody.appendChild(CalendarView.renderCurrentView());
		}
	},

	// Get current period text
	getCurrentPeriodText: () => {
		const date = CalendarView.currentDate;
		const months = I18n.t("calendar.months");

		switch (CalendarView.currentView) {
			case "month":
				return `${months[date.getMonth()]} ${date.getFullYear()}`;
			case "week": {
				const weekStart = CalendarView.getWeekStart(date);
				const weekEnd = CalendarView.getWeekEnd(date);
				if (weekStart.getMonth() === weekEnd.getMonth()) {
					return `${weekStart.getDate()}-${weekEnd.getDate()} ${months[weekStart.getMonth()]} ${weekStart.getFullYear()}`;
				}
				if (weekStart.getFullYear() === weekEnd.getFullYear()) {
					return `${weekStart.getDate()} ${months[weekStart.getMonth()]} - ${weekEnd.getDate()} ${months[weekEnd.getMonth()]} ${weekStart.getFullYear()}`;
				}
				return `${weekStart.getDate()} ${months[weekStart.getMonth()]} ${weekStart.getFullYear()} - ${weekEnd.getDate()} ${months[weekEnd.getMonth()]} ${weekEnd.getFullYear()}`;
			}
			case "day": {
				const weekdays = I18n.t("calendar.weekdaysFull");
				return `${weekdays[date.getDay()]}, ${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
			}
		}
	},

	// Render current view
	renderCurrentView: () => {
		switch (CalendarView.currentView) {
			case "month":
				return CalendarView.renderMonthView();
			case "week":
				return CalendarView.renderWeekView();
			case "day":
				return CalendarView.renderDayView();
		}
	},

	// Render month view
	renderMonthView: () => {
		const year = CalendarView.currentDate.getFullYear();
		const month = CalendarView.currentDate.getMonth();
		const firstDay = new Date(year, month, 1);
		const lastDay = new Date(year, month + 1, 0);
		const startDate = new Date(firstDay);
		startDate.setDate(startDate.getDate() - firstDay.getDay());

		const weekdays = I18n.t("calendar.weekdays");

		const monthGrid = h(
			"div",
			{ className: "calendar-month" },
			// Weekday headers
			h(
				"div",
				{ className: "calendar-weekdays" },
				...weekdays.map((day) => h("div", { className: "calendar-weekday" }, day))
			),

			// Days grid
			h(
				"div",
				{ className: "calendar-days" },
				...CalendarView.generateMonthDays(startDate, firstDay, lastDay)
			)
		);

		return monthGrid;
	},

	// Generate month days
	generateMonthDays: (startDate, firstDay, lastDay) => {
		const days = [];
		const today = new Date();
		today.setHours(0, 0, 0, 0);

		const current = new Date(startDate);

		// Generate 6 weeks of days
		for (let week = 0; week < 6; week++) {
			for (let day = 0; day < 7; day++) {
				const date = new Date(current);
				const isCurrentMonth = date.getMonth() === firstDay.getMonth();
				const isToday = date.getTime() === today.getTime();
				const dayEvents = CalendarView.getEventsForDate(date);

				const dayContent = [h("div", { className: "calendar-day-number" }, date.getDate())];

				if (dayEvents.length > 0) {
					dayContent.push(
						h(
							"div",
							{ className: "calendar-day-events" },
							...CalendarView.renderDayEventCards(dayEvents)
						)
					);
				}

				days.push(
					h(
						"div",
						{
							className: `calendar-day ${!isCurrentMonth ? "other-month" : ""} ${isToday ? "today" : ""} ${dayEvents.length > 0 ? "has-events" : ""}`,
							onclick: () => CalendarView.selectDate(date),
							ondragover: (e) => CalendarView.handleDragOver(e),
							ondragleave: (e) => CalendarView.handleDragLeave(e),
							ondrop: (e) => CalendarView.handleDrop(e, date),
							"data-date": CalendarView.formatDateKey(date),
						},
						...dayContent
					)
				);

				current.setDate(current.getDate() + 1);
			}
		}

		return days;
	},

	// Render week view
	renderWeekView: () => {
		const weekStart = CalendarView.getWeekStart(CalendarView.currentDate);
		const weekdays = I18n.t("calendar.weekdays");
		const weekdaysFull = I18n.t("calendar.weekdaysFull");

		const weekGrid = h(
			"div",
			{ className: "calendar-week" },
			// Time column
			h(
				"div",
				{ className: "calendar-week-times" },
				h("div", { className: "calendar-week-time-header" }, ""),
				...CalendarView.generateTimeSlots()
			),

			// Days columns
			...Array.from({ length: 7 }, (_, i) => {
				const date = new Date(weekStart);
				date.setDate(date.getDate() + i);
				const dayEvents = CalendarView.getEventsForDate(date);
				const isToday = CalendarView.isToday(date);

				return h(
					"div",
					{ className: `calendar-week-day ${isToday ? "today" : ""}` },
					h(
						"div",
						{ className: "calendar-week-day-header" },
						h("div", { className: "calendar-week-day-name" }, weekdays[i]),
						h("div", { className: "calendar-week-day-number" }, date.getDate())
					),
					h(
						"div",
						{
							className: "calendar-week-day-events",
							ondragover: (e) => CalendarView.handleDragOver(e),
							ondragleave: (e) => CalendarView.handleDragLeave(e),
							ondrop: (e) => CalendarView.handleDrop(e, date),
							"data-date": CalendarView.formatDateKey(date),
						},
						...CalendarView.renderWeekEvents(dayEvents)
					)
				);
			})
		);

		return weekGrid;
	},

	// Render day view
	renderDayView: () => {
		const date = CalendarView.currentDate;
		const dayEvents = CalendarView.getEventsForDate(date);

		const dayView = h(
			"div",
			{ className: "calendar-day-view" },
			// Time slots
			h("div", { className: "calendar-day-times" }, ...CalendarView.generateTimeSlots()),

			// Events column
			h(
				"div",
				{ className: "calendar-day-events-column" },
				...(dayEvents.length === 0
					? [h("div", { className: "calendar-no-events" }, I18n.t("calendar.noEvents"))]
					: CalendarView.renderDayEvents(dayEvents))
			)
		);

		return dayView;
	},

	// Generate time slots
	generateTimeSlots: () => {
		const slots = [];
		for (let hour = 0; hour < 24; hour++) {
			const time =
				hour === 0 ? "12 AM" : hour < 12 ? `${hour} AM` : hour === 12 ? "12 PM" : `${hour - 12} PM`;
			slots.push(h("div", { className: "calendar-time-slot" }, time));
		}
		return slots;
	},

	// Load events from jobs data
	loadEvents: () => {
		const events = [];

		jobsData.forEach((job) => {
			// Add application date event
			if (job.appliedDate) {
				events.push({
					id: `applied-${job.id}`,
					type: "applied",
					date: new Date(job.appliedDate),
					title: `${I18n.t("calendar.applied")}: ${job.company}`,
					job: job,
					color: "green",
				});
			}

			// Add tasks with due dates
			if (job.tasks) {
				job.tasks.forEach((task) => {
					if (task.dueDate && task.status !== "done" && !task.archived) {
						events.push({
							id: `task-${job.id}-${task.id}`,
							type: "task",
							date: new Date(task.dueDate),
							title: task.text,
							job: job,
							task: task,
							priority: task.priority,
							color: "blue",
						});
					}
				});
			}

			// Add interview events based on substeps
			const interviewSubsteps = [
				"hr_phone_screen",
				"phone_screening",
				"technical_phone_screen",
				"technical_interview",
				"behavioral_interview",
				"team_interview",
				"hiring_manager_interview",
				"panel_interview",
				"final_round",
			];

			if (interviewSubsteps.includes(job.currentSubstep)) {
				// For demo purposes, set interview date to near future
				const interviewDate = new Date();
				interviewDate.setDate(interviewDate.getDate() + Math.floor(Math.random() * 7) + 1);

				events.push({
					id: `interview-${job.id}`,
					type: "interview",
					date: interviewDate,
					title: `${I18n.t("calendar.interview")}: ${job.company} - ${job.position}`,
					job: job,
					color: "orange",
				});
			}

			// Add follow-up reminders
			if (job.currentPhase === "applied" && job.appliedDate) {
				const followUpDate = new Date(job.appliedDate);
				followUpDate.setDate(followUpDate.getDate() + 7); // Follow up after 1 week

				if (followUpDate > new Date()) {
					events.push({
						id: `followup-${job.id}`,
						type: "followup",
						date: followUpDate,
						title: `${I18n.t("calendar.followUp")}: ${job.company}`,
						job: job,
						color: "purple",
					});
				}
			}
		});

		CalendarView.events = events;
	},

	// Get events for a specific date
	getEventsForDate: (date) => {
		const dateStr = CalendarView.formatDateKey(date);
		return CalendarView.events.filter(
			(event) => CalendarView.formatDateKey(event.date) === dateStr
		);
	},

	// Format date as key
	formatDateKey: (date) => {
		return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, "0")}-${String(date.getDate()).padStart(2, "0")}`;
	},

	// Check if date is today
	isToday: (date) => {
		const today = new Date();
		return (
			date.getFullYear() === today.getFullYear() &&
			date.getMonth() === today.getMonth() &&
			date.getDate() === today.getDate()
		);
	},

	// Get week start
	getWeekStart: (date) => {
		const d = new Date(date);
		const day = d.getDay();
		const diff = d.getDate() - day;
		return new Date(d.setDate(diff));
	},

	// Get week end
	getWeekEnd: (date) => {
		const d = new Date(date);
		const day = d.getDay();
		const diff = d.getDate() - day + 6;
		return new Date(d.setDate(diff));
	},

	// Select a date
	selectDate: (date) => {
		CalendarView.selectedDate = date;
		const events = CalendarView.getEventsForDate(date);

		if (events.length > 0) {
			CalendarView.showDateEvents(date, events);
		}
	},

	// Render day event cards (mini cards with text)
	renderDayEventCards: (events) => {
		// Limit to first 3 events to avoid overflow
		const displayEvents = events.slice(0, 3);
		const cards = [];

		displayEvents.forEach((event) => {
			const color = CalendarView.getEventColor(event.type);
			let eventText = "";

			// Format event text based on type
			switch (event.type) {
				case "task":
					eventText = event.task.text;
					break;
				case "applied":
					eventText = `Applied: ${event.job.company}`;
					break;
				case "interview":
					eventText = `Interview: ${event.job.position}`;
					break;
				case "followup":
					eventText = `Follow up: ${event.job.company}`;
					break;
			}

			cards.push(
				h(
					"div",
					{
						className: `calendar-day-event-mini calendar-event-${event.type}`,
						style: `background-color: var(--${color}-100); border-left: 2px solid var(--${color}-500);`,
						draggable: event.type === "task", // Only tasks can be dragged
						onclick: (e) => {
							e.stopPropagation();
							CalendarView.selectDate(new Date(event.date));
						},
						ondragstart: (e) => {
							if (event.type === "task") {
								CalendarView.handleDragStart(e, event);
							}
						},
						title: eventText,
					},
					h("div", { className: "calendar-event-mini-text" }, eventText)
				)
			);
		});

		// Add overflow indicator if there are more events
		if (events.length > 3) {
			cards.push(
				h(
					"div",
					{
						className: "calendar-event-more",
						onclick: (e) => {
							e.stopPropagation();
							CalendarView.selectDate(new Date(events[0].date));
						},
					},
					`+${events.length - 3} more`
				)
			);
		}

		return cards;
	},

	// Render week events
	renderWeekEvents: (events) => {
		return events.map((event) =>
			h(
				"div",
				{
					className: `calendar-week-event calendar-event-${event.type}`,
					style: `background-color: var(--${CalendarView.getEventColor(event.type)}-100); border-left: 3px solid var(--${CalendarView.getEventColor(event.type)}-500);`,
					draggable: event.type === "task", // Only tasks can be dragged
					onclick: () => CalendarView.showEventDetails(event),
					ondragstart: (e) => {
						if (event.type === "task") {
							CalendarView.handleDragStart(e, event);
						}
					},
				},
				h("div", { className: "calendar-event-time" }, CalendarView.formatEventTime(event)),
				h("div", { className: "calendar-event-title" }, event.title)
			)
		);
	},

	// Render day events
	renderDayEvents: (events) => {
		return events.map((event) =>
			h(
				"div",
				{
					className: `calendar-day-event calendar-event-${event.type}`,
					style: `background-color: var(--${CalendarView.getEventColor(event.type)}-100); border-left: 4px solid var(--${CalendarView.getEventColor(event.type)}-500);`,
					onclick: () => CalendarView.showEventDetails(event),
				},
				h(
					"div",
					{ className: "calendar-event-header" },
					h("div", { className: "calendar-event-time" }, CalendarView.formatEventTime(event)),
					event.type === "task" &&
						event.priority &&
						h("span", { className: `calendar-event-priority priority-${event.priority}` })
				),
				h("div", { className: "calendar-event-title" }, event.title),
				h(
					"div",
					{ className: "calendar-event-subtitle" },
					`${event.job.company} - ${event.job.position}`
				)
			)
		);
	},

	// Get event color
	getEventColor: (type) => {
		const colors = {
			applied: "green",
			task: "blue",
			interview: "orange",
			followup: "purple",
		};
		return colors[type] || "gray";
	},

	// Format event time
	formatEventTime: (event) => {
		// For now, just return the type icon
		const icons = {
			applied: "work",
			task: "task_alt",
			interview: "groups",
			followup: "follow_the_signs",
		};
		return h("span", { className: "material-symbols-outlined" }, icons[event.type] || "event");
	},

	// Show date events modal
	showDateEvents: (date, events) => {
		const months = I18n.t("calendar.months");
		const weekdays = I18n.t("calendar.weekdaysFull");
		const dateStr = `${weekdays[date.getDay()]}, ${date.getDate()} ${months[date.getMonth()]}`;

		const modal = h(
			"div",
			{
				className: "modal-overlay",
				onclick: (e) => {
					if (e.target.className === "modal-overlay") e.target.remove();
				},
			},
			h(
				"div",
				{ className: "modal calendar-events-modal" },
				h(
					"div",
					{ className: "modal-header" },
					h("h3", { className: "modal-title" }, dateStr),
					h(
						"button",
						{
							className: "modal-close",
							onclick: (e) => e.target.closest(".modal-overlay").remove(),
						},
						"Ã—"
					)
				),
				h(
					"div",
					{ className: "modal-body" },
					h(
						"div",
						{ className: "calendar-events-list" },
						...events.map((event) => CalendarView.renderEventCard(event))
					)
				)
			)
		);

		document.body.appendChild(modal);
	},

	// Render event card
	renderEventCard: (event) => {
		return h(
			"div",
			{
				className: `calendar-event-card calendar-event-${event.type}`,
				onclick: () => CalendarView.handleEventClick(event),
			},
			h(
				"div",
				{ className: "calendar-event-card-header" },
				h(
					"span",
					{
						className: "calendar-event-type-badge",
						style: `background-color: var(--${CalendarView.getEventColor(event.type)}-100); color: var(--${CalendarView.getEventColor(event.type)}-700);`,
					},
					I18n.t(`calendar.${event.type}`)
				),
				event.type === "task" &&
					event.priority &&
					h(
						"span",
						{ className: `priority-badge priority-${event.priority}` },
						I18n.t(
							`modals.tasks.priority${event.priority.charAt(0).toUpperCase() + event.priority.slice(1)}`
						)
					)
			),
			h("div", { className: "calendar-event-card-title" }, event.title),
			h(
				"div",
				{ className: "calendar-event-card-subtitle" },
				`${event.job.company} - ${event.job.position}`
			)
		);
	},

	// Handle event click
	handleEventClick: (event) => {
		// Close any existing modal
		const existingModal = document.querySelector(".modal-overlay");
		if (existingModal) existingModal.remove();

		// Show event details modal instead of navigating away
		CalendarView.showEventDetailsModal(event);
	},

	// Show event details modal
	showEventDetailsModal: (event) => {
		const modal = h(
			"div",
			{
				className: "modal-overlay",
				onclick: (e) => {
					if (e.target.className === "modal-overlay") e.target.remove();
				},
			},
			h(
				"div",
				{ className: "modal calendar-event-details-modal" },
				h(
					"div",
					{ className: "modal-header" },
					h("h3", { className: "modal-title" }, event.title),
					h(
						"button",
						{
							className: "modal-close",
							onclick: (e) => e.target.closest(".modal-overlay").remove(),
						},
						"Ã—"
					)
				),
				h(
					"div",
					{ className: "modal-body" },
					h(
						"div",
						{ className: "event-details" },
						h(
							"div",
							{ className: "event-detail-row" },
							h("strong", {}, "Type: "),
							h(
								"span",
								{
									className: `event-type-badge event-type-${event.type}`,
									style: `background-color: var(--${CalendarView.getEventColor(event.type)}-100); color: var(--${CalendarView.getEventColor(event.type)}-700);`,
								},
								I18n.t(`calendar.${event.type}`)
							)
						),
						h(
							"div",
							{ className: "event-detail-row" },
							h("strong", {}, "Company: "),
							h("span", {}, event.job.company)
						),
						h(
							"div",
							{ className: "event-detail-row" },
							h("strong", {}, "Position: "),
							h("span", {}, event.job.position)
						),
						h(
							"div",
							{ className: "event-detail-row" },
							h("strong", {}, "Date: "),
							h("span", {}, event.date.toLocaleDateString())
						),
						event.type === "task" &&
							event.task && [
								h(
									"div",
									{ className: "event-detail-row" },
									h("strong", {}, "Priority: "),
									h(
										"span",
										{
											className: `priority-badge priority-${event.task.priority}`,
											style: `background-color: var(--${CalendarView.getEventColor(event.task.priority === "high" ? "red" : event.task.priority === "medium" ? "orange" : "green")}-100); color: var(--${CalendarView.getEventColor(event.task.priority === "high" ? "red" : event.task.priority === "medium" ? "orange" : "green")}-700);`,
										},
										event.task.priority
									)
								),
								h(
									"div",
									{ className: "event-detail-row" },
									h("strong", {}, "Status: "),
									h("span", {}, event.task.status)
								),
							]
					)
				),
				h(
					"div",
					{ className: "modal-footer" },
					event.type === "task" &&
						h(
							"button",
							{
								className: "btn-primary",
								onclick: () => {
									modal.remove();
									openTasksModal(event.job);
								},
							},
							"Open Tasks"
						),
					h(
						"button",
						{
							className: "btn-secondary",
							onclick: () => {
								modal.remove();
								TabNavigation.switchTo("jobs");
							},
						},
						"View Job"
					),
					h(
						"button",
						{
							className: "btn-secondary",
							onclick: () => modal.remove(),
						},
						"Close"
					)
				)
			)
		);

		document.body.appendChild(modal);
	},

	// Show event details
	showEventDetails: (event) => {
		CalendarView.handleEventClick(event);
	},

	// Drag and drop handlers
	handleDragStart: (e, event) => {
		e.stopPropagation();

		// Only allow dragging tasks
		if (event.type !== "task") {
			e.preventDefault();
			return;
		}

		// Store the event data
		e.dataTransfer.setData(
			"text/plain",
			JSON.stringify({
				eventId: event.id,
				jobId: event.job.id,
				taskId: event.task.id,
				eventType: event.type,
			})
		);

		e.dataTransfer.effectAllowed = "move";

		// Add visual feedback
		e.target.classList.add("dragging");
	},

	handleDragOver: (e) => {
		e.preventDefault();
		e.dataTransfer.dropEffect = "move";

		// Add visual feedback to drop target
		const dayElement = e.currentTarget;
		dayElement.classList.add("drag-over");
	},

	handleDragLeave: (e) => {
		// Remove visual feedback
		const dayElement = e.currentTarget;
		dayElement.classList.remove("drag-over");
	},

	handleDrop: (e, targetDate) => {
		e.preventDefault();
		e.stopPropagation();

		// Remove visual feedback
		const dayElement = e.currentTarget;
		dayElement.classList.remove("drag-over");

		// Remove dragging class from all elements
		document.querySelectorAll(".dragging").forEach((el) => {
			el.classList.remove("dragging");
		});

		try {
			const dragData = JSON.parse(e.dataTransfer.getData("text/plain"));

			if (dragData.eventType === "task") {
				CalendarView.moveTaskToDate(dragData.jobId, dragData.taskId, targetDate);
			}
		} catch (error) {
			console.error("Error handling drop:", error);
		}
	},

	// Move task to new date
	moveTaskToDate: (jobId, taskId, newDate) => {
		// Find the job
		const job = jobsData.find((j) => j.id === Number.parseInt(jobId));
		if (!job || !job.tasks) return;

		// Find the task
		const task = job.tasks.find((t) => t.id === taskId);
		if (!task) return;

		// Update the task's due date
		const newDueDate = new Date(newDate);
		newDueDate.setHours(23, 59, 59, 999); // Set to end of day
		task.dueDate = newDueDate.toISOString();

		// Save changes
		saveToLocalStorage();

		// Reload events and refresh calendar
		CalendarView.loadEvents();
		CalendarView.updateView();

		// Show confirmation
		CalendarView.showMoveConfirmation(task, job, newDate);
	},

	// Show confirmation of task move
	showMoveConfirmation: (task, job, newDate) => {
		const dateStr = newDate.toLocaleDateString();

		// Create temporary notification
		const notification = h(
			"div",
			{
				className: "calendar-move-notification",
				style:
					"position: fixed; top: 20px; right: 20px; background: var(--green-100); color: var(--green-700); padding: 12px 16px; border-radius: 6px; border: 1px solid var(--green-300); z-index: 3000; box-shadow: 0 4px 12px rgba(0,0,0,0.1);",
			},
			h("div", { style: "font-weight: 600; margin-bottom: 4px;" }, "Task moved successfully!"),
			h("div", { style: "font-size: 12px;" }, `"${task.text}" moved to ${dateStr}`)
		);

		document.body.appendChild(notification);

		// Remove notification after 3 seconds
		setTimeout(() => {
			if (notification.parentNode) {
				notification.parentNode.removeChild(notification);
			}
		}, 3000);
	},
};

// Make CalendarView available globally
window.CalendarView = CalendarView;


// ============================================================================
// SRC/COMPONENTS/CONTACTS-VIEW.JS
// ============================================================================

// ============================================================================
// CONTACTS VIEW COMPONENT
// ============================================================================

const ContactsView = {
	// Initialize contacts view
	init: () => {
		const contactsTab = document.querySelector('.tab-content[data-tab="contacts"]');

		if (contactsTab) {
			// Only clear and initialize if not already initialized
			if (!contactsTab.querySelector(".contacts-container")) {
				// Clear existing content
				contactsTab.innerHTML = "";

				// Create contacts container
				const container = ContactsView.create();
				contactsTab.appendChild(container);
			} else {
				// If already initialized, just update the view
				ContactsView.updateView();
			}
		}
	},

	// Create the main contacts structure
	create: () => {
		const container = h(
			"div",
			{ className: "contacts-container" },
			// Header
			h(
				"div",
				{ className: "tab-header" },
				h("h2", { className: "tab-title" }, I18n.t("contactsView.title")),
				h(
					"div",
					{ className: "contacts-stats" },
					h("span", { className: "contacts-count" }, ContactsView.getTotalContactsText())
				)
			),

			// Contacts table
			h("div", { className: "contacts-table-container" }, ContactsView.renderContactsTable()),

			// Table actions
			h(
				"div",
				{ className: "contacts-actions" },
				h(
					"button",
					{
						onclick: () => ContactsView.showAddContactModal(),
					},
					h("span", { className: "material-symbols-outlined" }, "person_add"),
					I18n.t("contactsView.addContact")
				)
			)
		);

		return container;
	},

	// Get all contacts from all jobs
	getAllContacts: () => {
		const allContacts = [];

		jobsData.forEach((job) => {
			if (job.contacts && job.contacts.length > 0) {
				job.contacts.forEach((contact) => {
					// Skip archived contacts
					if (!contact.archived) {
						allContacts.push({
							...contact,
							jobId: job.id,
							jobCompany: job.company,
							jobPosition: job.position,
						});
					}
				});
			}
		});

		// Sort by name
		return allContacts.sort((a, b) => (a.name || "").localeCompare(b.name || ""));
	},

	// Get total contacts count text
	getTotalContactsText: () => {
		const total = ContactsView.getAllContacts().length;
		return I18n.t("contactsView.totalContacts", { count: total });
	},

	// Render contacts table
	renderContactsTable: () => {
		const contacts = ContactsView.getAllContacts();

		if (contacts.length === 0) {
			return h(
				"div",
				{ className: "contacts-empty" },
				h("p", { className: "contacts-empty-message" }, I18n.t("contactsView.emptyState"))
			);
		}

		return h(
			"table",
			{ className: "contacts-table" },
			h(
				"thead",
				{},
				h(
					"tr",
					{},
					h("th", {}, I18n.t("contactsView.nameHeader")),
					h("th", {}, I18n.t("contactsView.emailHeader")),
					h("th", {}, I18n.t("contactsView.phoneHeader")),
					h("th", {}, I18n.t("contactsView.roleHeader")),
					h("th", {}, I18n.t("contactsView.companyHeader")),
					h("th", {}, I18n.t("contactsView.jobHeader")),
					h("th", {}, I18n.t("contactsView.actionsHeader"))
				)
			),
			h("tbody", {}, ...contacts.map((contact) => ContactsView.renderContactRow(contact)))
		);
	},

	// Render contact row
	renderContactRow: (contact) => {
		return h(
			"tr",
			{
				className: "contact-row",
				"data-contact-id": contact.id,
				"data-job-id": contact.jobId,
			},
			h(
				"td",
				{ className: "contact-cell contact-name-cell" },
				h("input", {
					type: "text",
					value: contact.name || "",
					className: "contact-field-input",
					placeholder: I18n.t("contactsView.namePlaceholder"),
					onchange: (e) => ContactsView.updateContactField(contact, "name", e.target.value),
					onblur: (e) => ContactsView.validateAndSave(contact, "name", e.target.value),
				})
			),
			h(
				"td",
				{ className: "contact-cell contact-email-cell" },
				h("input", {
					type: "email",
					value: contact.email || "",
					className: "contact-field-input",
					placeholder: I18n.t("contactsView.emailPlaceholder"),
					onchange: (e) => ContactsView.updateContactField(contact, "email", e.target.value),
				})
			),
			h(
				"td",
				{ className: "contact-cell contact-phone-cell" },
				h("input", {
					type: "tel",
					value: contact.phone || "",
					className: "contact-field-input",
					placeholder: I18n.t("contactsView.phonePlaceholder"),
					onchange: (e) => ContactsView.updateContactField(contact, "phone", e.target.value),
				})
			),
			h(
				"td",
				{ className: "contact-cell contact-role-cell" },
				h("input", {
					type: "text",
					value: contact.role || "",
					className: "contact-field-input",
					placeholder: I18n.t("contactsView.rolePlaceholder"),
					onchange: (e) => ContactsView.updateContactField(contact, "role", e.target.value),
				})
			),
			h(
				"td",
				{ className: "contact-cell contact-company-cell" },
				h("span", { className: "contact-company-display" }, contact.jobCompany)
			),
			h(
				"td",
				{ className: "contact-cell contact-job-cell" },
				h("span", { className: "contact-job-display" }, contact.jobPosition)
			),
			h(
				"td",
				{ className: "contact-cell contact-actions-cell" },
				h("button", {
					className: "contact-view-job-btn action-btn",
					title: `View job: ${contact.jobPosition} at ${contact.jobCompany}`,
					onclick: () => {
						// Find the job and open edit modal
						const job = jobsData.find(j => j.id === contact.jobId);
						if (job && window.KanbanBoard) {
							window.KanbanBoard.openJobEditModal(job);
						}
					},
					innerHTML: '<span class="material-symbols-outlined icon-14">work</span>',
				}),
				h("button", {
					className: "contact-delete-btn action-btn delete-btn",
					title: I18n.t("contactsView.deleteTitle"),
					onclick: () => ContactsView.deleteContact(contact),
					innerHTML: '<span class="material-symbols-outlined icon-14">delete</span>',
				})
			)
		);
	},

	// Update contact field
	updateContactField: (contact, field, value) => {
		const jobIndex = jobsData.findIndex((j) => j.id === contact.jobId);
		if (jobIndex === -1) return;

		const contactIndex = jobsData[jobIndex].contacts.findIndex((c) => c.id === contact.id);
		if (contactIndex === -1) return;

		// Update the field
		jobsData[jobIndex].contacts[contactIndex][field] = value;

		// Save to localStorage
		saveToLocalStorage();

		// Update interface if needed
		if (typeof refreshInterface === "function") {
			refreshInterface();
		}
	},

	// Validate and save (for required fields)
	validateAndSave: (contact, field, value) => {
		if (field === "name" && !value.trim()) {
			// Show validation error
			ContactsView.showValidationError(
				contact,
				field,
				I18n.t("contactsView.validation.nameRequired")
			);
			return;
		}

		// Clear any existing validation errors
		ContactsView.clearValidationError(contact, field);
	},

	// Delete contact with confirmation
	deleteContact: async (contact) => {
		const confirmMessage = I18n.t("contactsView.deleteConfirmation", {
			name: contact.name || "this contact",
		});

		if (await confirm(confirmMessage)) {
			const jobIndex = jobsData.findIndex((j) => j.id === contact.jobId);
			if (jobIndex === -1) return;

			const contactIndex = jobsData[jobIndex].contacts.findIndex((c) => c.id === contact.id);
			if (contactIndex === -1) return;

			// Remove the contact
			jobsData[jobIndex].contacts.splice(contactIndex, 1);

			// Save to localStorage
			saveToLocalStorage();

			// Update the view
			ContactsView.updateView();

			// Update interface
			if (typeof refreshInterface === "function") {
				refreshInterface();
			}
		}
	},

	// Show validation error
	showValidationError: (contact, field, message) => {
		const contactRow = document.querySelector(
			`[data-contact-id="${contact.id}"][data-job-id="${contact.jobId}"]`
		);
		if (!contactRow) return;

		const fieldCell = contactRow.querySelector(`.contact-${field}-cell`);
		if (!fieldCell) return;

		// Remove existing error
		ContactsView.clearValidationError(contact, field);

		// Add error class and message
		fieldCell.classList.add("has-error");
		const errorElement = h("div", { className: "field-error" }, message);
		fieldCell.appendChild(errorElement);

		// Remove error after 3 seconds
		setTimeout(() => {
			ContactsView.clearValidationError(contact, field);
		}, 3000);
	},

	// Clear validation error
	clearValidationError: (contact, field) => {
		const contactRow = document.querySelector(
			`[data-contact-id="${contact.id}"][data-job-id="${contact.jobId}"]`
		);
		if (!contactRow) return;

		const fieldCell = contactRow.querySelector(`.contact-${field}-cell`);
		if (!fieldCell) return;

		fieldCell.classList.remove("has-error");
		const errorElement = fieldCell.querySelector(".field-error");
		if (errorElement) {
			errorElement.remove();
		}
	},

	// Show add contact modal
	showAddContactModal: async () => {
		// Get all jobs for the dropdown
		const jobOptions = jobsData.map((job) => ({
			id: job.id,
			text: `${job.company} - ${job.position}`,
		}));

		if (jobOptions.length === 0) {
			await alert(I18n.t("contactsView.noJobsAvailable"));
			return;
		}

		const modal = h(
			"div",
			{
				className: "modal-overlay",
				onclick: (e) => {
					if (e.target.className === "modal-overlay") e.target.remove();
				},
			},
			h(
				"div",
				{ className: "modal" },
				h(
					"div",
					{ className: "modal-header" },
					h("h3", { className: "modal-title" }, I18n.t("contactsView.addContactTitle")),
					h(
						"button",
						{
							className: "modal-close",
							onclick: (e) => e.target.closest(".modal-overlay").remove(),
						},
						"Ã—"
					)
				),
				h(
					"div",
					{ className: "modal-body" },
					h(
						"div",
						{ className: "add-contact-form" },
						h(
							"div",
							{ className: "contact-form-row" },
							h(
								"div",
								{ className: "contact-form-field" },
								h("label", {}, I18n.t("contactsView.nameHeader")),
								h("input", {
									type: "text",
									className: "add-contact-name",
									placeholder: I18n.t("contactsView.namePlaceholder"),
								})
							),
							h(
								"div",
								{ className: "contact-form-field" },
								h("label", {}, I18n.t("contactsView.emailHeader")),
								h("input", {
									type: "email",
									className: "add-contact-email",
									placeholder: I18n.t("contactsView.emailPlaceholder"),
								})
							)
						),
						h(
							"div",
							{ className: "contact-form-row" },
							h(
								"div",
								{ className: "contact-form-field" },
								h("label", {}, I18n.t("contactsView.phoneHeader")),
								h("input", {
									type: "tel",
									className: "add-contact-phone",
									placeholder: I18n.t("contactsView.phonePlaceholder"),
								})
							),
							h(
								"div",
								{ className: "contact-form-field" },
								h("label", {}, I18n.t("contactsView.roleHeader")),
								h("input", {
									type: "text",
									className: "add-contact-role",
									placeholder: I18n.t("contactsView.rolePlaceholder"),
								})
							)
						),
						h(
							"div",
							{ className: "contact-form-row" },
							h(
								"div",
								{ className: "contact-form-field full-width" },
								h("label", {}, I18n.t("contactsView.jobHeader")),
								h(
									"select",
									{ className: "add-contact-job" },
									h("option", { value: "" }, I18n.t("contactsView.selectJob")),
									...jobOptions.map((job) => h("option", { value: job.id }, job.text))
								)
							)
						)
					)
				),
				h(
					"div",
					{ className: "modal-footer" },
					h(
						"button",
						{
							className: "btn-secondary",
							onclick: (e) => e.target.closest(".modal-overlay").remove(),
						},
						I18n.t("modals.common.cancel")
					),
					h(
						"button",
						{
							className: "btn-primary",
							onclick: () => ContactsView.addContact(),
						},
						I18n.t("contactsView.addContact")
					)
				)
			)
		);

		document.body.appendChild(modal);

		// Focus the name field
		setTimeout(() => {
			const nameInput = modal.querySelector(".add-contact-name");
			if (nameInput) nameInput.focus();
		}, 100);
	},

	// Add new contact
	addContact: async () => {
		const nameInput = document.querySelector(".add-contact-name");
		const emailInput = document.querySelector(".add-contact-email");
		const phoneInput = document.querySelector(".add-contact-phone");
		const roleInput = document.querySelector(".add-contact-role");
		const jobSelect = document.querySelector(".add-contact-job");

		const name = nameInput.value.trim();
		const email = emailInput.value.trim();
		const phone = phoneInput.value.trim();
		const role = roleInput.value.trim();
		const jobId = Number.parseInt(jobSelect.value);

		// Validation
		if (!name) {
			await alert(I18n.t("contactsView.validation.nameRequired"));
			nameInput.focus();
			return;
		}

		if (!jobId) {
			await alert(I18n.t("contactsView.validation.jobRequired"));
			jobSelect.focus();
			return;
		}

		// Find the job
		const jobIndex = jobsData.findIndex((j) => j.id === jobId);
		if (jobIndex === -1) return;

		// Create new contact
		const newContact = {
			id: Date.now().toString(),
			name: name,
			email: email || null,
			phone: phone || null,
			role: role || null,
			company: jobsData[jobIndex].company,
			createdAt: new Date().toISOString(),
			archived: false,
		};

		// Add to job
		if (!jobsData[jobIndex].contacts) {
			jobsData[jobIndex].contacts = [];
		}
		jobsData[jobIndex].contacts.push(newContact);

		// Save to localStorage
		saveToLocalStorage();

		// Close modal
		document.querySelector(".modal-overlay").remove();

		// Update view
		ContactsView.updateView();

		// Update interface
		if (typeof refreshInterface === "function") {
			refreshInterface();
		}
	},

	// Update contacts view
	updateView: () => {
		const tableContainer = document.querySelector(".contacts-table-container");
		if (tableContainer) {
			tableContainer.innerHTML = "";
			tableContainer.appendChild(ContactsView.renderContactsTable());
		}

		// Update contacts count
		const statsElement = document.querySelector(".contacts-count");
		if (statsElement) {
			statsElement.textContent = ContactsView.getTotalContactsText();
		}
	},
};

// Make ContactsView available globally
window.ContactsView = ContactsView;


// ============================================================================
// SRC/COMPONENTS/TABLE.JS
// ============================================================================

// ============================================================================
// TABLE AND JOB ROW COMPONENTS
// ============================================================================

// Priority cell component
const PriorityCell = ({ priority }) => {
	return h(
		"td",
		{ className: "priority-cell" },
		h("span", { className: `priority priority-${priority}` }),
		getPriorityText(priority)
	);
};

// Job row component
const JobRow = ({ job, onEdit, onDelete }) => {
	const row = h(
		"tr",
		{ "data-job-id": job.id },
		PriorityCell({ priority: job.priority }),
		h("td", { className: "company-name", title: job.company }, job.company),
		h("td", { className: "position-name", title: job.position }, job.position),
		h(
			"td",
			{ className: "current-phase", title: `${getPhaseText(job.currentPhase)}${job.currentSubstep ? ` - ${getSubstepText(job.currentSubstep)}` : ''}` },
			h(
				"div",
				{ className: "phase-display" },
				h("span", { className: "phase-main" }, getPhaseText(job.currentPhase)),
				job.currentSubstep
					? h("span", { className: "phase-substep" }, getSubstepText(job.currentSubstep))
					: null
			)
		),
		h("td", { className: "salary", title: job.salaryRange }, job.salaryRange),
		h("td", { className: "location", title: job.location }, job.location),
		h(
			"td",
			{ className: "source-url" },
			job.sourceUrl
				? h(
						"a",
						{
							href: job.sourceUrl,
							target: "_blank",
							rel: "noopener noreferrer",
							className: "source-link",
							title: job.sourceUrl,
						},
						h("span", { className: "material-symbols-outlined" }, "link")
					)
				: ""
		),
		h(
			"td",
			{ className: "contact" },
			ContactsCount({
				contacts: job.contacts || [],
				onClick: () => openContactsModal(job),
			})
		),
		h(
			"td",
			{ className: "notes" },
			NotesCount({
				notes: job.notes || [],
				onClick: () => openNotesModal(job),
			})
		),
		h(
			"td",
			{ className: "tasks" },
			TasksCount({
				tasks: job.tasks || [],
				onClick: () => openTasksModal(job),
			})
		),
		h(
			"td",
			{ className: "actions-cell" },
			h("button", {
				className: "action-btn edit-btn",
				onclick: () => onEdit(job),
				innerHTML: '<span class="material-symbols-outlined">edit</span>',
			}),
			h("button", {
				className: "action-btn delete-btn",
				onclick: () => onDelete(job),
				innerHTML: '<span class="material-symbols-outlined">delete</span>',
			})
		)
	);

	// Double-click to edit
	row.addEventListener("dblclick", () => onEdit(job));

	return row;
};

// Modal close function
const closeModal = () => {
	const modals = document.querySelectorAll(".modal-overlay");
	modals.forEach((modal) => modal.remove());
};


// ============================================================================
// SRC/APP/STATS.JS
// ============================================================================

// ============================================================================
// STATISTICS CALCULATIONS
// ============================================================================

// Update statistics
function updateStats(filteredJobs = null) {
	const jobs = filteredJobs || jobsData;
	const total = jobs.length;
	let active = 0;
	let interviews = 0;
	let offers = 0;
	let rejections = 0;

	for (const job of jobs) {
		const phase = job.currentPhase;
		if (phase !== "rejected_withdrawn") active++;
		if (phase === "interview") interviews++;
		if (phase === "offer") offers++;
		if (phase === "rejected_withdrawn") rejections++;
	}

	$("#totalApps").text(total.toString());
	$("#activeApps").text(active.toString());
	$("#interviews").text(interviews.toString());
	$("#offers").text(offers.toString());
	$("#rejections").text(rejections.toString());
}


// ============================================================================
// SRC/APP/EVENTS.JS
// ============================================================================

// ============================================================================
// EVENT HANDLERS AND UTILITY FUNCTIONS
// ============================================================================

// Setup event listeners
function setupEventListeners() {
	// ESC key to close modals
	document.addEventListener("keydown", (e) => {
		if (e.key === "Escape") {
			closeModal();
			closeAllDropdowns();
		}
	});

	// Close dropdowns when clicking outside
	document.addEventListener("click", (e) => {
		const isDropdownIcon = e.target.closest(".filter-dropdown-icon");
		const isDropdownContent = e.target.closest(".filter-dropdown");

		if (!isDropdownIcon && !isDropdownContent) {
			closeAllDropdowns();
		}
	});
}

// Close all dropdowns
function closeAllDropdowns() {
	document.querySelectorAll(".filter-dropdown").forEach((dropdown) => {
		dropdown.style.display = "none";
	});
}

// Toggle dropdown function
function toggleDropdown(dropdownId) {
	const dropdown = document.getElementById(dropdownId);
	if (!dropdown) return;

	// Close all other dropdowns
	document.querySelectorAll(".filter-dropdown").forEach((d) => {
		if (d.id !== dropdownId) {
			d.style.display = "none";
		}
	});

	// Toggle this dropdown
	dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
}

// Tab switching function (legacy support)
function switchTab(tabName) {
	document.querySelectorAll(".tab-button").forEach((btn) => {
		btn.classList.remove("active");
	});
	document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add("active");

	document.querySelectorAll(".tab-content").forEach((content) => {
		content.classList.remove("active");
	});
	document.getElementById(`${tabName}Tab`).classList.add("active");

	if (tabName === "kanban") {
		populateKanbanBoard();
	}
}

// Kanban board population (placeholder)
function populateKanbanBoard() {
	// This would populate the kanban board
	console.log("Populating kanban board");
}


// ============================================================================
// SRC/APP/EDITING.JS
// ============================================================================

// ============================================================================
// INLINE EDITING FUNCTIONS
// ============================================================================

// Edit job function - transforms row into inline edit mode
function editJob(job) {
	const row = document.querySelector(`tr[data-job-id="${job.id}"]`);
	if (!row || row.classList.contains("editing")) return;

	// Mark row as editing
	row.classList.add("editing");

	// Store original HTML to restore on cancel
	const originalHTML = row.innerHTML;

	// Get unique values for autocomplete
	const companies = [...new Set(jobsData.map((j) => j.company).filter(Boolean))];
	const positions = [...new Set(jobsData.map((j) => j.position).filter(Boolean))];
	const locations = [...new Set(jobsData.map((j) => j.location).filter(Boolean))];

	// Build inline edit row
	row.innerHTML = `
		<td class="priority-cell">
			<select class="inline-edit priority-select" data-field="priority">
				<option value="high" ${job.priority === "high" ? "selected" : ""}>${I18n.t("priorities.high")}</option>
				<option value="medium" ${job.priority === "medium" ? "selected" : ""}>${I18n.t("priorities.medium")}</option>
				<option value="low" ${job.priority === "low" ? "selected" : ""}>${I18n.t("priorities.low")}</option>
			</select>
		</td>
		<td>
			<input type="text" class="inline-edit" data-field="company" value="${job.company || ""}" 
				list="company-list-${job.id}" placeholder="${I18n.t("table.placeholders.company")}">
			<datalist id="company-list-${job.id}">
				${companies.map((c) => `<option value="${c}">`).join("")}
			</datalist>
		</td>
		<td>
			<input type="text" class="inline-edit" data-field="position" value="${job.position || ""}" 
				list="position-list-${job.id}" placeholder="${I18n.t("table.placeholders.position")}">
			<datalist id="position-list-${job.id}">
				${positions.map((p) => `<option value="${p}">`).join("")}
			</datalist>
		</td>
		<td class="phase-cell">
			<select class="inline-edit phase-select" data-field="currentPhase" onchange="updateSubstepOptions(this, ${job.id})">
				${PHASES.map(
					(phase) =>
						`<option value="${phase}" ${job.currentPhase === phase ? "selected" : ""}>${getPhaseText(phase)}</option>`
				).join("")}
			</select>
			<select class="inline-edit substep-select" data-field="currentSubstep" id="substep-${job.id}">
				<option value="">${I18n.t("substeps.none")}</option>
				${
					job.currentPhase &&
					getSubstepsForPhase(job.currentPhase)
						.map(
							(substep) =>
								`<option value="${substep}" ${job.currentSubstep === substep ? "selected" : ""}>${getSubstepText(substep)}</option>`
						)
						.join("")
				}
			</select>
		</td>
		<td>
			<input type="text" class="inline-edit" data-field="salaryRange" value="${job.salaryRange || ""}" 
				placeholder="${I18n.t("table.placeholders.salaryRange")}">
		</td>
		<td>
			<input type="text" class="inline-edit" data-field="location" value="${job.location || ""}" 
				list="location-list-${job.id}" placeholder="${I18n.t("table.placeholders.location")}">
			<datalist id="location-list-${job.id}">
				${locations.map((l) => `<option value="${l}">`).join("")}
			</datalist>
		</td>
		<td>
			<input type="url" class="inline-edit" data-field="sourceUrl" value="${job.sourceUrl || ""}" 
				placeholder="${I18n.t("table.placeholders.sourceUrl")}">
		</td>
		<td class="contact" data-job-id="${job.id}">
			${
				ContactsCount({
					contacts: job.contacts || [],
					onClick: null, // Will be attached after rendering
				}).outerHTML
			}
		</td>
		<td class="notes" data-job-id="${job.id}">
			${
				NotesCount({
					notes: job.notes || [],
					onClick: null, // Will be attached after rendering
				}).outerHTML
			}
		</td>
		<td class="tasks" data-job-id="${job.id}">
			${
				TasksCount({
					tasks: job.tasks || [],
					onClick: null, // Will be attached after rendering
				}).outerHTML
			}
		</td>
		<td class="actions-cell">
			<button class="action-btn save-btn" onclick="saveInlineEdit(${job.id})">
				<span class="material-symbols-outlined">check</span>
			</button>
			<button class="action-btn cancel-btn" onclick="cancelInlineEdit(${job.id}, '${btoa(originalHTML)}')">
				<span class="material-symbols-outlined">close</span>
			</button>
		</td>
	`;

	// Focus first input
	const firstInput = row.querySelector('input[data-field="company"]');
	if (firstInput) firstInput.focus();

	// Attach click handlers for notes, tasks, and contacts
	const notesCell = row.querySelector(".notes .notes-count");
	const tasksCell = row.querySelector(".tasks .tasks-count");
	const contactsCell = row.querySelector(".contact .contacts-count");

	if (notesCell) {
		notesCell.addEventListener("click", () => openNotesModal(job));
	}

	if (tasksCell) {
		tasksCell.addEventListener("click", () => openTasksModal(job));
	}

	if (contactsCell) {
		contactsCell.addEventListener("click", () => openContactsModal(job));
	}

	// Handle Enter key to save, Escape to cancel
	row.addEventListener("keydown", (e) => {
		if (e.key === "Enter") {
			e.preventDefault();
			saveInlineEdit(job.id);
		} else if (e.key === "Escape") {
			e.preventDefault();
			cancelInlineEdit(job.id, btoa(originalHTML));
		}
	});
}

// Save inline edit
function saveInlineEdit(jobId) {
	const row = document.querySelector(`tr[data-job-id="${jobId}"]`);
	if (!row) return;

	const job = jobsData.find((j) => j.id === jobId);
	if (!job) return;

	// Collect all edited values
	row.querySelectorAll(".inline-edit").forEach((input) => {
		const field = input.dataset.field;
		const value = input.value.trim();
		job[field] = value;
	});

	// Save and refresh
	saveToLocalStorage();
	refreshInterface();
}

// Cancel inline edit
function cancelInlineEdit(jobId, originalHTMLBase64) {
	const row = document.querySelector(`tr[data-job-id="${jobId}"]`);
	if (!row) return;

	// Find the job
	const job = jobsData.find((j) => j.id === jobId);
	if (!job) return;

	// Check if this is an empty job (new job with no meaningful data)
	const isEmpty =
		!job.company.trim() &&
		!job.position.trim() &&
		!job.salaryRange.trim() &&
		!job.location.trim() &&
		!job.sourceUrl.trim() &&
		(!job.contacts || job.contacts.length === 0);

	if (isEmpty) {
		// Remove the empty job from data
		const index = jobsData.findIndex((j) => j.id === jobId);
		if (index !== -1) {
			jobsData.splice(index, 1);
			originalData = [...jobsData];
			saveToLocalStorage();
			refreshInterface();
		}
	} else {
		// Instead of restoring HTML (which loses event listeners),
		// we'll refresh the interface to properly recreate the row
		row.classList.remove("editing");
		refreshInterface();
	}
}

// Delete job function
async function deleteJob(job) {
	const confirmed = await confirm(
		I18n.t("messages.confirmDelete", {
			position: job.position,
			company: job.company,
		})
	);

	if (confirmed) {
		const index = jobsData.findIndex((j) => j.id === job.id);
		if (index !== -1) {
			jobsData.splice(index, 1);
			originalData = [...jobsData];
			saveToLocalStorage();
			refreshInterface();
		}
	}
}

// Global functions for HTML onclick handlers
function addRow() {
	// Create new job with unique ID
	const newJob = {
		id: Date.now(),
		priority: "medium",
		company: "",
		position: "",
		appliedDate: new Date().toISOString(),
		currentPhase: "wishlist",
		currentSubstep: "",
		completedSubsteps: [],
		salaryRange: "",
		location: "",
		sourceUrl: "",
		notes: [],
		tasks: [],
		contacts: [],
	};

	jobsData.push(newJob);
	originalData = [...jobsData];
	saveToLocalStorage();
	refreshInterface();

	// Auto-edit the new row
	setTimeout(() => editJob(newJob), 100);
}

// Function to update substep options when phase changes
function updateSubstepOptions(phaseSelect, jobId) {
	const substepSelect = document.getElementById(`substep-${jobId}`);
	if (!substepSelect) return;

	const selectedPhase = phaseSelect.value;
	const substeps = getSubstepsForPhase(selectedPhase);

	// Clear current options
	substepSelect.innerHTML = `<option value="">${I18n.t("substeps.none")}</option>`;

	// Add substeps for the selected phase
	substeps.forEach((substep) => {
		const option = document.createElement("option");
		option.value = substep;
		option.textContent = getSubstepText(substep);
		substepSelect.appendChild(option);
	});
}


// ============================================================================
// SRC/APP/INIT.JS
// ============================================================================

// ============================================================================
// APPLICATION INITIALIZATION
// ============================================================================

// Main application initialization
async function initializeApp() {
	// Initialize i18n
	I18n.init();

	// Always set up UI structure first to prevent blinking
	updateStaticTexts();
	updateMetaTags(); // Update meta tags for current language
	setupEventListeners();
	setupFilters();

	// Initialize components after a short delay to ensure DOM is ready
	setTimeout(() => {
		initializeTabNavigation();
		initializeLanguageSwitcher();
	}, 100);

	// Load data from localStorage
	const savedJobs = loadFromLocalStorage();

	if (savedJobs && savedJobs.length > 0) {
		jobsData = savedJobs;
		originalData = [...jobsData];
		refreshInterface();
	} else {
		// Show empty interface first
		refreshInterface();

		// Show welcome message for new users
		const showDemo = await confirm(I18n.t("messages.welcome"), {
			confirmText: I18n.t("messages.welcomeConfirm"),
			cancelText: I18n.t("messages.welcomeCancel"),
			focusConfirm: true,
		});
		if (showDemo) {
			jobsData = getDemoData();
			originalData = [...jobsData];
			saveToLocalStorage();
			refreshInterface();
		}
	}
}

// Setup filter dropdowns
function setupFilters() {
	// Priority filter
	const priorityDropdown = $("#priorityDropdown");
	if (priorityDropdown) {
		populatePriorityFilter();
	}

	// Phase filter
	const phaseDropdown = $("#phaseDropdown");
	if (phaseDropdown) {
		populatePhaseFilter();
	}
}

// Populate priority filter
function populatePriorityFilter() {
	const dropdown = $("#priorityDropdown").get();
	if (!dropdown) return;

	dropdown.innerHTML = "";

	// Add "All Priorities" option
	const allOption = h(
		"div",
		{
			className: "dropdown-option",
			onclick: () => {
				filterByPriority(null);
				toggleDropdown("priorityDropdown");
			},
		},
		I18n.t("table.filters.allPriorities")
	);
	dropdown.appendChild(allOption);

	// Add priority options
	for (const priority of PRIORITIES) {
		const option = h(
			"div",
			{
				className: "dropdown-option",
				onclick: () => {
					filterByPriority(priority);
					toggleDropdown("priorityDropdown");
				},
			},
			getPriorityText(priority)
		);
		dropdown.appendChild(option);
	}
}

// Populate phase filter
function populatePhaseFilter() {
	const dropdown = $("#phaseDropdown").get();
	if (!dropdown) return;

	dropdown.innerHTML = "";

	// Add "All Phases" option
	const allOption = h(
		"div",
		{
			className: "dropdown-option",
			onclick: () => {
				filterByPhase(null);
				toggleDropdown("phaseDropdown");
			},
		},
		I18n.t("table.filters.allPhases")
	);
	dropdown.appendChild(allOption);

	// Add phase options
	for (const phase of PHASES) {
		const option = h(
			"div",
			{
				className: "dropdown-option",
				onclick: () => {
					filterByPhase(phase);
					toggleDropdown("phaseDropdown");
				},
			},
			getPhaseText(phase)
		);
		dropdown.appendChild(option);
	}
}

// Filter functions
function filterByPriority(priority) {
	if (priority === null) {
		jobsData = [...originalData];
	} else {
		jobsData = originalData.filter((job) => job.priority === priority);
	}
	refreshInterface();
}

function filterByPhase(phase) {
	if (phase === null) {
		jobsData = [...originalData];
	} else {
		jobsData = originalData.filter((job) => job.currentPhase === phase);
	}
	refreshInterface();
}

// Refresh the interface
function refreshInterface() {
	updateStats();
	renderJobTable();

	// Also refresh kanban board if it exists and applications tab is active
	if (
		typeof KanbanBoard !== "undefined" &&
		TabNavigation &&
		TabNavigation.activeTab === "applications"
	) {
		KanbanBoard.refresh();
	}

	// Also refresh tasks board if it exists and tasks tab is active
	if (typeof TasksBoard !== "undefined" && TabNavigation && TabNavigation.activeTab === "tasks") {
		TasksBoard.refresh();
	}
}

// Render job table
function renderJobTable() {
	const tableBody = $("#jobTableBody");
	if (!tableBody) {
		console.warn("Table body not found - cannot render jobs");
		return;
	}

	const tbody = tableBody.get();
	tbody.innerHTML = "";

	console.log("Rendering jobs:", jobsData.length);

	for (const job of jobsData) {
		try {
			const row = JobRow({
				job,
				onEdit: editJob,
				onDelete: deleteJob,
			});
			tbody.appendChild(row);
		} catch (error) {
			console.error("Error rendering job row:", error, job);
		}
	}
}

// Initialize app when DOM is ready
if (document.readyState === "loading") {
	document.addEventListener("DOMContentLoaded", initializeApp);
} else {
	initializeApp();
}

    </script>
</body>
</html>